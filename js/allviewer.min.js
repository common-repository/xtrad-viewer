/*! xtrad-viewer 06-12-2019 */

XDTHREE.EditorControls=function(a,t){t=void 0!==t?t:document,this.enabled=!0,this.center=new XDTHREE.Vector3,this.panSpeed=.002,this.zoomSpeed=.1,this.rotationSpeed=.005;var r=this,n=new XDTHREE.Vector3,i=new XDTHREE.Vector3,o=new XDTHREE.Box3,s={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},d=s.NONE,l=this.center,u=new XDTHREE.Matrix3,c=new XDTHREE.Vector2,h=new XDTHREE.Vector2,p=new XDTHREE.Spherical,m=new XDTHREE.Sphere,g={type:"change"};function e(e){!1!==r.enabled&&(0===e.button?d=s.ROTATE:1===e.button?d=s.ZOOM:2===e.button&&(d=s.PAN),h.set(e.clientX,e.clientY),t.addEventListener("mousemove",w,!1),t.addEventListener("mouseup",f,!1),t.addEventListener("mouseout",f,!1),t.addEventListener("dblclick",f,!1))}function w(e){if(!1!==r.enabled){c.set(e.clientX,e.clientY);var t=c.x-h.x,a=c.y-h.y;d===s.ROTATE?r.rotate(i.set(-t,-a,0)):d===s.ZOOM?r.zoom(i.set(0,0,a)):d===s.PAN&&r.pan(i.set(-t,a,0)),h.set(e.clientX,e.clientY)}}function f(e){t.removeEventListener("mousemove",w,!1),t.removeEventListener("mouseup",f,!1),t.removeEventListener("mouseout",f,!1),t.removeEventListener("dblclick",f,!1),d=s.NONE}function y(e){e.preventDefault(),r.zoom(i.set(0,0,0<e.deltaY?1:-1))}function E(e){e.preventDefault()}this.focus=function(e){var t;o.setFromObject(e),t=!1===o.isEmpty()?(o.getCenter(l),o.getBoundingSphere(m).radius):(l.setFromMatrixPosition(e.matrixWorld),.1),i.set(0,0,1),i.applyQuaternion(a.quaternion),i.multiplyScalar(4*t),a.position.copy(l).add(i),r.dispatchEvent(g)},this.pan=function(e){var t=a.position.distanceTo(l);e.multiplyScalar(t*r.panSpeed),e.applyMatrix3(u.getNormalMatrix(a.matrix)),a.position.add(e),l.add(e),r.dispatchEvent(g)},this.zoom=function(e){var t=a.position.distanceTo(l);e.multiplyScalar(t*r.zoomSpeed),e.length()>t||(e.applyMatrix3(u.getNormalMatrix(a.matrix)),a.position.add(e),r.dispatchEvent(g))},this.rotate=function(e){n.copy(a.position).sub(l),p.setFromVector3(n),p.theta+=e.x*r.rotationSpeed,p.phi+=e.y*r.rotationSpeed,p.makeSafe(),n.setFromSpherical(p),a.position.copy(l).add(n),a.lookAt(l),r.dispatchEvent(g)},this.dispose=function(){t.removeEventListener("contextmenu",E,!1),t.removeEventListener("mousedown",e,!1),t.removeEventListener("wheel",y,!1),t.removeEventListener("mousemove",w,!1),t.removeEventListener("mouseup",f,!1),t.removeEventListener("mouseout",f,!1),t.removeEventListener("dblclick",f,!1),t.removeEventListener("touchstart",x,!1),t.removeEventListener("touchmove",T,!1)},t.addEventListener("contextmenu",E,!1),t.addEventListener("mousedown",e,!1),t.addEventListener("wheel",y,!1);var v=[new XDTHREE.Vector3,new XDTHREE.Vector3,new XDTHREE.Vector3],b=[new XDTHREE.Vector3,new XDTHREE.Vector3,new XDTHREE.Vector3],R=null;function x(e){if(!1!==r.enabled){switch(e.touches.length){case 1:v[0].set(e.touches[0].pageX,e.touches[0].pageY,0),v[1].set(e.touches[0].pageX,e.touches[0].pageY,0);break;case 2:v[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),v[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio),R=v[0].distanceTo(v[1])}b[0].copy(v[0]),b[1].copy(v[1])}}function T(e){if(!1!==r.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:v[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),v[1].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),r.rotate(v[0].sub(o(v[0],b)).multiplyScalar(-1));break;case 2:v[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),v[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio);var t=v[0].distanceTo(v[1]);r.zoom(i.set(0,0,R-t)),R=t;var a=v[0].clone().sub(o(v[0],b)),n=v[1].clone().sub(o(v[1],b));a.x=-a.x,n.x=-n.x,r.pan(a.add(n))}b[0].copy(v[0]),b[1].copy(v[1])}function o(e,t){var a=t[0];for(var n in t)a.distanceTo(e)>t[n].distanceTo(e)&&(a=t[n]);return a}}t.addEventListener("touchstart",x,!1),t.addEventListener("touchmove",T,!1)},XDTHREE.EditorControls.prototype=Object.create(XDTHREE.EventDispatcher.prototype),XDTHREE.EditorControls.prototype.constructor=XDTHREE.EditorControls,XDTHREE.TransformControls=function(e,n){XDTHREE.Object3D.call(this),n=void 0!==n?n:document,this.visible=!1;var o=new XDTHREE.TransformControlsGizmo;this.add(o);var d=new XDTHREE.TransformControlsPlane;this.add(d);var r=this;P("camera",e),P("object",void 0),P("axis",null),P("enabled",!0),P("mode","translate"),P("translationSnap",null),P("rotationSnap",null),P("space","world"),P("size",1),P("dragging",!1),P("showX",!0),P("showY",!0),P("showZ",!0);var l={type:"change"},i={type:"mouseDown"},t={type:"mouseUp",mode:r.mode},u={type:"objectChange"},c=new XDTHREE.Raycaster,h=new XDTHREE.Vector3,p=new XDTHREE.Vector3,m=new XDTHREE.Quaternion,g={X:new XDTHREE.Vector3(1,0,0),Y:new XDTHREE.Vector3(0,1,0),Z:new XDTHREE.Vector3(0,0,1)},w=(new XDTHREE.Quaternion,new XDTHREE.Vector3,new XDTHREE.Vector3),f=new XDTHREE.Vector3,y=new XDTHREE.Vector3,E=new XDTHREE.Vector3,v=new XDTHREE.Vector3,b=new XDTHREE.Vector3,R=0,a=new XDTHREE.Vector3,s=new XDTHREE.Quaternion,x=new XDTHREE.Vector3,T=new XDTHREE.Vector3,C=new XDTHREE.Quaternion,D=new XDTHREE.Quaternion,I=new XDTHREE.Vector3,U=new XDTHREE.Vector3,V=new XDTHREE.Quaternion,S=new XDTHREE.Vector3,M=new XDTHREE.Vector3,X=new XDTHREE.Quaternion,H=new XDTHREE.Quaternion,k=new XDTHREE.Vector3,j=(k=new XDTHREE.Vector3,new XDTHREE.Vector3),L=new XDTHREE.Vector3,O=new XDTHREE.Quaternion,N=new XDTHREE.Vector3;function P(t,e){var a=e;Object.defineProperty(r,t,{get:function(){return void 0!==a?a:e},set:function(e){a!==e&&(a=e,d[t]=e,o[t]=e,r.dispatchEvent({type:t+"-changed",value:e}),r.dispatchEvent(l))}}),r[t]=e,d[t]=e,o[t]=e}function W(e){var t=e.changedTouches?e.changedTouches[0]:e,a=n.getBoundingClientRect();return{x:(t.clientX-a.left)/a.width*2-1,y:-(t.clientY-a.top)/a.height*2+1,button:e.button}}function A(e){e.preventDefault()}function B(e){r.enabled&&r.pointerHover(W(e))}function G(e){r.enabled&&(document.addEventListener("mousemove",F,!1),r.pointerHover(W(e)),r.pointerDown(W(e)))}function F(e){r.enabled&&r.pointerMove(W(e))}function _(e){r.enabled&&(document.removeEventListener("mousemove",F,!1),r.pointerUp(W(e)))}P("worldPosition",M),P("worldPositionStart",U),P("worldQuaternion",X),P("worldQuaternionStart",V),P("cameraPosition",a),P("cameraQuaternion",s),P("pointStart",w),P("pointEnd",f),P("rotationAxis",E),P("rotationAngle",R),P("eye",j),n.addEventListener("mousedown",G,!1),n.addEventListener("touchstart",G,!1),n.addEventListener("mousemove",B,!1),n.addEventListener("touchmove",B,!1),n.addEventListener("mousemove",F,!1),n.addEventListener("touchmove",F,!1),n.addEventListener("mouseup",_,!1),n.addEventListener("mouseleave",_,!1),n.addEventListener("mouseout",_,!1),n.addEventListener("touchend",_,!1),n.addEventListener("touchcancel",_,!1),n.addEventListener("touchleave",_,!1),n.addEventListener("contextmenu",A,!1),this.dispose=function(){n.removeEventListener("mousedown",G),n.removeEventListener("touchstart",G),n.removeEventListener("mousemove",B),n.removeEventListener("touchmove",B),n.removeEventListener("mousemove",F),n.removeEventListener("touchmove",F),n.removeEventListener("mouseup",_),n.removeEventListener("mouseleave",_),n.removeEventListener("mouseout",_),n.removeEventListener("touchend",_),n.removeEventListener("touchcancel",_),n.removeEventListener("touchleave",_),n.removeEventListener("contextmenu",A),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})},this.attach=function(e){this.object=e,this.visible=!0},this.detach=function(){this.object=void 0,this.visible=!1,this.axis=null},this.updateMatrixWorld=function(){void 0!==this.object&&(this.object.updateMatrixWorld(),this.object.parent.matrixWorld.decompose(T,C,I),this.object.matrixWorld.decompose(M,X,k),D.copy(C).inverse(),H.copy(X).inverse()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(a,s,x),this.camera instanceof XDTHREE.PerspectiveCamera?j.copy(a).sub(M).normalize():this.camera instanceof XDTHREE.OrthographicCamera&&j.copy(a).normalize(),XDTHREE.Object3D.prototype.updateMatrixWorld.call(this)},this.pointerHover=function(e){if(void 0!==this.object&&!0!==this.dragging&&(void 0===e.button||0===e.button)){c.setFromCamera(e,this.camera);var t=c.intersectObjects(o.picker[this.mode].children,!0)[0]||!1;this.axis=t?t.object.name:null}},this.pointerDown=function(e){if(!(void 0===this.object||!0===this.dragging||void 0!==e.button&&0!==e.button||0!==e.button&&void 0!==e.button||null===this.axis)){c.setFromCamera(e,this.camera);var t=c.intersectObjects([d],!0)[0]||!1;if(t){var a=this.space;if("scale"===this.mode?a="local":"E"!==this.axis&&"XYZE"!==this.axis&&"XYZ"!==this.axis||(a="world"),"local"===a&&"rotate"===this.mode){var n=this.rotationSnap;"X"===this.axis&&n&&(this.object.rotation.x=Math.round(this.object.rotation.x/n)*n),"Y"===this.axis&&n&&(this.object.rotation.y=Math.round(this.object.rotation.y/n)*n),"Z"===this.axis&&n&&(this.object.rotation.z=Math.round(this.object.rotation.z/n)*n)}this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),L.copy(this.object.position),O.copy(this.object.quaternion),N.copy(this.object.scale),this.object.matrixWorld.decompose(U,V,S),w.copy(t.point).sub(U)}this.dragging=!0,i.mode=this.mode,this.dispatchEvent(i)}},this.pointerMove=function(e){var t=this.axis,a=this.mode,n=this.object,o=this.space;if("scale"===a?o="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(o="world"),void 0!==n&&null!==t&&!1!==this.dragging&&(void 0===e.button||0===e.button)){c.setFromCamera(e,this.camera);var r=c.intersectObjects([d],!0)[0]||!1;if(!1!==r){if(f.copy(r.point).sub(U),"translate"===a)y.copy(f).sub(w),"local"===o&&"XYZ"!==t&&y.applyQuaternion(H),-1===t.indexOf("X")&&(y.x=0),-1===t.indexOf("Y")&&(y.y=0),-1===t.indexOf("Z")&&(y.z=0),"local"===o&&"XYZ"!==t?y.applyQuaternion(O).divide(I):y.applyQuaternion(D).divide(I),n.position.copy(y).add(L),this.translationSnap&&("local"===o&&(n.position.applyQuaternion(m.copy(O).inverse()),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(O)),"world"===o&&(n.parent&&n.position.add(h.setFromMatrixPosition(n.parent.matrixWorld)),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(h.setFromMatrixPosition(n.parent.matrixWorld))));else if("scale"===a){if(-1!==t.search("XYZ")){var i=f.length()/w.length();f.dot(w)<0&&(i*=-1),p.set(i,i,i)}else h.copy(w),p.copy(f),h.applyQuaternion(H),p.applyQuaternion(H),p.divide(h),-1===t.search("X")&&(p.x=1),-1===t.search("Y")&&(p.y=1),-1===t.search("Z")&&(p.z=1);n.scale.copy(N).multiply(p)}else if("rotate"===a){y.copy(f).sub(w);var s=20/M.distanceTo(h.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(E.copy(j),R=f.angleTo(w),v.copy(w).normalize(),b.copy(f).normalize(),R*=b.cross(v).dot(j)<0?1:-1):"XYZE"===t?(E.copy(y).cross(j).normalize(),R=y.dot(h.copy(E).cross(this.eye))*s):"X"!==t&&"Y"!==t&&"Z"!==t||(E.copy(g[t]),h.copy(g[t]),"local"===o&&h.applyQuaternion(X),R=y.dot(h.cross(j).normalize())*s),this.rotationSnap&&(R=Math.round(R/this.rotationSnap)*this.rotationSnap),this.rotationAngle=R,"local"===o&&"E"!==t&&"XYZE"!==t?(n.quaternion.copy(O),n.quaternion.multiply(m.setFromAxisAngle(E,R)).normalize()):(E.applyQuaternion(D),n.quaternion.copy(m.setFromAxisAngle(E,R)),n.quaternion.multiply(O).normalize())}this.dispatchEvent(l),this.dispatchEvent(u)}}},this.pointerUp=function(e){void 0!==e.button&&0!==e.button||(this.dragging&&null!==this.axis&&(t.mode=this.mode,this.dispatchEvent(t)),this.dragging=!1,void 0===e.button&&(this.axis=null))},this.getMode=function(){return r.mode},this.setMode=function(e){r.mode=e},this.setTranslationSnap=function(e){r.translationSnap=e},this.setRotationSnap=function(e){r.rotationSnap=e},this.setSize=function(e){r.size=e},this.setSpace=function(e){r.space=e},this.update=function(){console.warn("THREE.TransformControls: update function has been depricated.")}},XDTHREE.TransformControls.prototype=Object.assign(Object.create(XDTHREE.Object3D.prototype),{constructor:XDTHREE.TransformControls,isTransformControls:!0}),XDTHREE.TransformControlsGizmo=function(){"use strict";XDTHREE.Object3D.call(this),this.type="TransformControlsGizmo";var e=new XDTHREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:XDTHREE.DoubleSide,fog:!1}),t=new XDTHREE.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1}),a=e.clone();a.opacity=.15;var n=e.clone();n.opacity=.33;var o=e.clone();o.color.set(16711680);var r=e.clone();r.color.set(65280);var i=e.clone();i.color.set(255);var s=e.clone();s.opacity=.25;var d=s.clone();d.color.set(16776960);var l=s.clone();l.color.set(65535);var u=s.clone();u.color.set(16711935),e.clone().color.set(16776960);var c=t.clone();c.color.set(16711680);var h=t.clone();h.color.set(65280);var p=t.clone();p.color.set(255);var m=t.clone();m.color.set(65535);var g=t.clone();g.color.set(16711935);var w=t.clone();w.color.set(16776960);var f=t.clone();f.color.set(7895160);var y=w.clone();y.opacity=.25;var E=new XDTHREE.CylinderBufferGeometry(0,.05,.2,12,1,!1),v=new XDTHREE.BoxBufferGeometry(.125,.125,.125),b=new XDTHREE.BufferGeometry;b.addAttribute("position",new XDTHREE.Float32BufferAttribute([0,0,0,1,0,0],3));var R,x=function(e,t){for(var a=new XDTHREE.BufferGeometry,n=[],o=0;o<=64*t;++o)n.push(0,Math.cos(o/32*Math.PI)*e,Math.sin(o/32*Math.PI)*e);return a.addAttribute("position",new XDTHREE.Float32BufferAttribute(n,3)),a},T={X:[[new XDTHREE.Mesh(E,o),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new XDTHREE.Mesh(E,o),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new XDTHREE.Line(b,c)]],Y:[[new XDTHREE.Mesh(E,r),[0,1,0],null,null,"fwd"],[new XDTHREE.Mesh(E,r),[0,1,0],[Math.PI,0,0],null,"bwd"],[new XDTHREE.Line(b,h),null,[0,0,Math.PI/2]]],Z:[[new XDTHREE.Mesh(E,i),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new XDTHREE.Mesh(E,i),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new XDTHREE.Line(b,p),null,[0,-Math.PI/2,0]]],XYZ:[[new XDTHREE.Mesh(new XDTHREE.OctahedronBufferGeometry(.1,0),s),[0,0,0],[0,0,0]]],XY:[[new XDTHREE.Mesh(new XDTHREE.PlaneBufferGeometry(.295,.295),d),[.15,.15,0]],[new XDTHREE.Line(b,w),[.18,.3,0],null,[.125,1,1]],[new XDTHREE.Line(b,w),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new XDTHREE.Mesh(new XDTHREE.PlaneBufferGeometry(.295,.295),l),[0,.15,.15],[0,Math.PI/2,0]],[new XDTHREE.Line(b,m),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new XDTHREE.Line(b,m),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new XDTHREE.Mesh(new XDTHREE.PlaneBufferGeometry(.295,.295),u),[.15,0,.15],[-Math.PI/2,0,0]],[new XDTHREE.Line(b,g),[.18,0,.3],null,[.125,1,1]],[new XDTHREE.Line(b,g),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},C={X:[[new XDTHREE.Mesh(new XDTHREE.CylinderBufferGeometry(.2,0,1,4,1,!1),a),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new XDTHREE.Mesh(new XDTHREE.CylinderBufferGeometry(.2,0,1,4,1,!1),a),[0,.6,0]]],Z:[[new XDTHREE.Mesh(new XDTHREE.CylinderBufferGeometry(.2,0,1,4,1,!1),a),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new XDTHREE.Mesh(new XDTHREE.OctahedronBufferGeometry(.2,0),a)]],XY:[[new XDTHREE.Mesh(new XDTHREE.PlaneBufferGeometry(.4,.4),a),[.2,.2,0]]],YZ:[[new XDTHREE.Mesh(new XDTHREE.PlaneBufferGeometry(.4,.4),a),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new XDTHREE.Mesh(new XDTHREE.PlaneBufferGeometry(.4,.4),a),[.2,0,.2],[-Math.PI/2,0,0]]]},D={START:[[new XDTHREE.Mesh(new XDTHREE.OctahedronBufferGeometry(.01,2),n),null,null,null,"helper"]],END:[[new XDTHREE.Mesh(new XDTHREE.OctahedronBufferGeometry(.01,2),n),null,null,null,"helper"]],DELTA:[[new XDTHREE.Line((R=new XDTHREE.BufferGeometry,R.addAttribute("position",new XDTHREE.Float32BufferAttribute([0,0,0,1,1,1],3)),R),n),null,null,null,"helper"]],X:[[new XDTHREE.Line(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new XDTHREE.Line(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new XDTHREE.Line(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},I={X:[[new XDTHREE.Line(x(1,.5),c)],[new XDTHREE.Mesh(new XDTHREE.OctahedronBufferGeometry(.04,0),o),[0,0,.99],null,[1,3,1]]],Y:[[new XDTHREE.Line(x(1,.5),h),null,[0,0,-Math.PI/2]],[new XDTHREE.Mesh(new XDTHREE.OctahedronBufferGeometry(.04,0),r),[0,0,.99],null,[3,1,1]]],Z:[[new XDTHREE.Line(x(1,.5),p),null,[0,Math.PI/2,0]],[new XDTHREE.Mesh(new XDTHREE.OctahedronBufferGeometry(.04,0),i),[.99,0,0],null,[1,3,1]]],E:[[new XDTHREE.Line(x(1.25,1),y),null,[0,Math.PI/2,0]],[new XDTHREE.Mesh(new XDTHREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new XDTHREE.Mesh(new XDTHREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new XDTHREE.Mesh(new XDTHREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new XDTHREE.Mesh(new XDTHREE.CylinderBufferGeometry(.03,0,.15,4,1,!1),y),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new XDTHREE.Line(x(1,1),f),null,[0,Math.PI/2,0]]]},U={AXIS:[[new XDTHREE.Line(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},V={X:[[new XDTHREE.Mesh(new XDTHREE.TorusBufferGeometry(1,.1,4,24),a),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new XDTHREE.Mesh(new XDTHREE.TorusBufferGeometry(1,.1,4,24),a),[0,0,0],[Math.PI/2,0,0]]],Z:[[new XDTHREE.Mesh(new XDTHREE.TorusBufferGeometry(1,.1,4,24),a),[0,0,0],[0,0,-Math.PI/2]]],E:[[new XDTHREE.Mesh(new XDTHREE.TorusBufferGeometry(1.25,.1,2,24),a)]],XYZE:[[new XDTHREE.Mesh(new XDTHREE.SphereBufferGeometry(.7,10,8),a)]]},S={X:[[new XDTHREE.Mesh(v,o),[.8,0,0],[0,0,-Math.PI/2]],[new XDTHREE.Line(b,c),null,null,[.8,1,1]]],Y:[[new XDTHREE.Mesh(v,r),[0,.8,0]],[new XDTHREE.Line(b,h),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new XDTHREE.Mesh(v,i),[0,0,.8],[Math.PI/2,0,0]],[new XDTHREE.Line(b,p),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new XDTHREE.Mesh(v,d),[.85,.85,0],null,[2,2,.2]],[new XDTHREE.Line(b,w),[.855,.98,0],null,[.125,1,1]],[new XDTHREE.Line(b,w),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new XDTHREE.Mesh(v,l),[0,.85,.85],null,[.2,2,2]],[new XDTHREE.Line(b,m),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new XDTHREE.Line(b,m),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new XDTHREE.Mesh(v,u),[.85,0,.85],null,[2,.2,2]],[new XDTHREE.Line(b,g),[.855,0,.98],null,[.125,1,1]],[new XDTHREE.Line(b,g),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new XDTHREE.Mesh(new XDTHREE.BoxBufferGeometry(.125,.125,.125),s),[1.1,0,0]]],XYZY:[[new XDTHREE.Mesh(new XDTHREE.BoxBufferGeometry(.125,.125,.125),s),[0,1.1,0]]],XYZZ:[[new XDTHREE.Mesh(new XDTHREE.BoxBufferGeometry(.125,.125,.125),s),[0,0,1.1]]]},M={X:[[new XDTHREE.Mesh(new XDTHREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),a),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new XDTHREE.Mesh(new XDTHREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),a),[0,.5,0]]],Z:[[new XDTHREE.Mesh(new XDTHREE.CylinderBufferGeometry(.2,0,.8,4,1,!1),a),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new XDTHREE.Mesh(v,a),[.85,.85,0],null,[3,3,.2]]],YZ:[[new XDTHREE.Mesh(v,a),[0,.85,.85],null,[.2,3,3]]],XZ:[[new XDTHREE.Mesh(v,a),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new XDTHREE.Mesh(new XDTHREE.BoxBufferGeometry(.2,.2,.2),a),[1.1,0,0]]],XYZY:[[new XDTHREE.Mesh(new XDTHREE.BoxBufferGeometry(.2,.2,.2),a),[0,1.1,0]]],XYZZ:[[new XDTHREE.Mesh(new XDTHREE.BoxBufferGeometry(.2,.2,.2),a),[0,0,1.1]]]},X={X:[[new XDTHREE.Line(b,n.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new XDTHREE.Line(b,n.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new XDTHREE.Line(b,n.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},H=function(e){var t=new XDTHREE.Object3D;for(var a in e)for(var n=e[a].length;n--;){var o=e[a][n][0].clone(),r=e[a][n][1],i=e[a][n][2],s=e[a][n][3],d=e[a][n][4];o.name=a,o.tag=d,r&&o.position.set(r[0],r[1],r[2]),i&&o.rotation.set(i[0],i[1],i[2]),s&&o.scale.set(s[0],s[1],s[2]),o.updateMatrix();var l=o.geometry.clone();l.applyMatrix(o.matrix),o.geometry=l,o.renderOrder=1/0,o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),t.add(o)}return t},k=new XDTHREE.Vector3(0,0,0),j=new XDTHREE.Euler,L=new XDTHREE.Vector3(0,1,0),O=new XDTHREE.Vector3(0,0,0),N=new XDTHREE.Matrix4,P=new XDTHREE.Quaternion,W=new XDTHREE.Quaternion,A=new XDTHREE.Quaternion,B=new XDTHREE.Vector3(1,0,0),G=new XDTHREE.Vector3(0,1,0),F=new XDTHREE.Vector3(0,0,1);this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=H(T)),this.add(this.gizmo.rotate=H(I)),this.add(this.gizmo.scale=H(S)),this.add(this.picker.translate=H(C)),this.add(this.picker.rotate=H(V)),this.add(this.picker.scale=H(M)),this.add(this.helper.translate=H(D)),this.add(this.helper.rotate=H(U)),this.add(this.helper.scale=H(X)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1,this.updateMatrixWorld=function(){var e=this.space;"scale"===this.mode&&(e="local");var t="local"===e?this.worldQuaternion:A;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;var a=[];a=(a=(a=a.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(var n=0;n<a.length;n++){var o=a[n];o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition);var r=this.worldPosition.distanceTo(this.cameraPosition);if(o.scale.set(1,1,1).multiplyScalar(r*this.size/7),"helper"!==o.tag){if(o.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){"X"!==o.name&&"XYZX"!==o.name||.99<Math.abs(L.copy(B).applyQuaternion(t).dot(this.eye))&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"Y"!==o.name&&"XYZY"!==o.name||.99<Math.abs(L.copy(G).applyQuaternion(t).dot(this.eye))&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"Z"!==o.name&&"XYZZ"!==o.name||.99<Math.abs(L.copy(F).applyQuaternion(t).dot(this.eye))&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"XY"===o.name&&Math.abs(L.copy(F).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"YZ"===o.name&&Math.abs(L.copy(B).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),"XZ"===o.name&&Math.abs(L.copy(G).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),-1!==o.name.search("X")&&(L.copy(B).applyQuaternion(t).dot(this.eye)<0?"fwd"===o.tag?o.visible=!1:o.scale.x*=-1:"bwd"===o.tag&&(o.visible=!1)),-1!==o.name.search("Y")&&(L.copy(G).applyQuaternion(t).dot(this.eye)<0?"fwd"===o.tag?o.visible=!1:o.scale.y*=-1:"bwd"===o.tag&&(o.visible=!1)),-1!==o.name.search("Z")&&(L.copy(F).applyQuaternion(t).dot(this.eye)<0?"fwd"===o.tag?o.visible=!1:o.scale.z*=-1:"bwd"===o.tag&&(o.visible=!1))}else"rotate"===this.mode&&(W.copy(t),L.copy(this.eye).applyQuaternion(P.copy(t).inverse()),-1!==o.name.search("E")&&o.quaternion.setFromRotationMatrix(N.lookAt(this.eye,O,G)),"X"===o.name&&(P.setFromAxisAngle(B,Math.atan2(-L.y,L.z)),P.multiplyQuaternions(W,P),o.quaternion.copy(P)),"Y"===o.name&&(P.setFromAxisAngle(G,Math.atan2(L.x,L.z)),P.multiplyQuaternions(W,P),o.quaternion.copy(P)),"Z"===o.name&&(P.setFromAxisAngle(F,Math.atan2(L.y,L.x)),P.multiplyQuaternions(W,P),o.quaternion.copy(P)));o.visible=o.visible&&(-1===o.name.indexOf("X")||this.showX),o.visible=o.visible&&(-1===o.name.indexOf("Y")||this.showY),o.visible=o.visible&&(-1===o.name.indexOf("Z")||this.showZ),o.visible=o.visible&&(-1===o.name.indexOf("E")||this.showX&&this.showY&&this.showZ),o.material._opacity=o.material._opacity||o.material.opacity,o.material._color=o.material._color||o.material.color.clone(),o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled?this.axis&&(o.name===this.axis?o.material.opacity=1:this.axis.split("").some(function(e){return o.name===e})?o.material.opacity=1:o.material.opacity*=.25,o.material.color.lerp(new XDTHREE.Color(1,1,1),.5)):(o.material.opacity*=.5,o.material.color.lerp(new XDTHREE.Color(1,1,1),.5))}else o.visible=!1,"AXIS"===o.name?(o.position.copy(this.worldPositionStart),o.visible=!!this.axis,"X"===this.axis&&(P.setFromEuler(j.set(0,0,0)),o.quaternion.copy(t).multiply(P),.9<Math.abs(L.copy(B).applyQuaternion(t).dot(this.eye))&&(o.visible=!1)),"Y"===this.axis&&(P.setFromEuler(j.set(0,0,Math.PI/2)),o.quaternion.copy(t).multiply(P),.9<Math.abs(L.copy(G).applyQuaternion(t).dot(this.eye))&&(o.visible=!1)),"Z"===this.axis&&(P.setFromEuler(j.set(0,Math.PI/2,0)),o.quaternion.copy(t).multiply(P),.9<Math.abs(L.copy(F).applyQuaternion(t).dot(this.eye))&&(o.visible=!1)),"XYZE"===this.axis&&(P.setFromEuler(j.set(0,Math.PI/2,0)),L.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(N.lookAt(O,L,G)),o.quaternion.multiply(P),o.visible=this.dragging),"E"===this.axis&&(o.visible=!1)):"START"===o.name?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):"END"===o.name?(o.position.copy(this.worldPosition),o.visible=this.dragging):"DELTA"===o.name?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),k.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),k.applyQuaternion(this.worldQuaternionStart.clone().inverse()),o.scale.copy(k),o.visible=this.dragging):(o.quaternion.copy(t),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=-1!==this.axis.search(o.name)))}XDTHREE.Object3D.prototype.updateMatrixWorld.call(this)}},XDTHREE.TransformControlsGizmo.prototype=Object.assign(Object.create(XDTHREE.Object3D.prototype),{constructor:XDTHREE.TransformControlsGizmo,isTransformControlsGizmo:!0}),XDTHREE.TransformControlsPlane=function(){"use strict";XDTHREE.Mesh.call(this,new XDTHREE.PlaneBufferGeometry(1e5,1e5,2,2),new XDTHREE.MeshBasicMaterial({visible:!1,wireframe:!0,side:XDTHREE.DoubleSide,transparent:!0,opacity:.1})),this.type="TransformControlsPlane";var t=new XDTHREE.Vector3(1,0,0),a=new XDTHREE.Vector3(0,1,0),n=new XDTHREE.Vector3(0,0,1),o=new XDTHREE.Vector3,r=new XDTHREE.Vector3,i=new XDTHREE.Vector3,s=new XDTHREE.Matrix4,d=new XDTHREE.Quaternion;this.updateMatrixWorld=function(){var e=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(e="local"),t.set(1,0,0).applyQuaternion("local"===e?this.worldQuaternion:d),a.set(0,1,0).applyQuaternion("local"===e?this.worldQuaternion:d),n.set(0,0,1).applyQuaternion("local"===e?this.worldQuaternion:d),i.copy(a),this.mode){case"translate":case"scale":switch(this.axis){case"X":i.copy(this.eye).cross(t),r.copy(t).cross(i);break;case"Y":i.copy(this.eye).cross(a),r.copy(a).cross(i);break;case"Z":i.copy(this.eye).cross(n),r.copy(n).cross(i);break;case"XY":r.copy(n);break;case"YZ":r.copy(t);break;case"XZ":i.copy(n),r.copy(a);break;case"XYZ":case"E":r.set(0,0,0)}break;case"rotate":default:r.set(0,0,0)}0===r.length()?this.quaternion.copy(this.cameraQuaternion):(s.lookAt(o.set(0,0,0),r,i),this.quaternion.setFromRotationMatrix(s)),XDTHREE.Object3D.prototype.updateMatrixWorld.call(this)}},XDTHREE.TransformControlsPlane.prototype=Object.assign(Object.create(XDTHREE.Mesh.prototype),{constructor:XDTHREE.TransformControlsPlane,isTransformControlsPlane:!0}),XDTHREE.TrackballControls=function(e,t){var r=this,i={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4};this.object=e,this.domElement=void 0!==t?t:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.target=new XDTHREE.Vector3;var a=new XDTHREE.Vector3,s=i.NONE,n=i.NONE,o=new XDTHREE.Vector3,d=new XDTHREE.Vector2,l=new XDTHREE.Vector2,u=new XDTHREE.Vector3,c=0,h=new XDTHREE.Vector2,p=new XDTHREE.Vector2,m=0,g=0,w=new XDTHREE.Vector2,f=new XDTHREE.Vector2;this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone();var y={type:"change"},E={type:"start"},v={type:"end"};this.handleResize=function(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}};var b,R,x,T,C,D,I,U,V,S,M,X,H=(b=new XDTHREE.Vector2,function(e,t){return b.set((e-r.screen.left)/r.screen.width,(t-r.screen.top)/r.screen.height),b}),k=(R=new XDTHREE.Vector2,function(e,t){return R.set((e-.5*r.screen.width-r.screen.left)/(.5*r.screen.width),(r.screen.height+2*(r.screen.top-t))/r.screen.width),R});function j(e){!1!==r.enabled&&(window.removeEventListener("keydown",j),(n=s)===i.NONE&&(e.keyCode!==r.keys[i.ROTATE]||r.noRotate?e.keyCode!==r.keys[i.ZOOM]||r.noZoom?e.keyCode!==r.keys[i.PAN]||r.noPan||(s=i.PAN):s=i.ZOOM:s=i.ROTATE))}function L(e){!1!==r.enabled&&(s=n,window.addEventListener("keydown",j,!1))}function O(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),s===i.NONE&&(s=e.button),s!==i.ROTATE||r.noRotate?s!==i.ZOOM||r.noZoom?s!==i.PAN||r.noPan||(w.copy(H(e.pageX,e.pageY)),f.copy(w)):(h.copy(H(e.pageX,e.pageY)),p.copy(h)):(l.copy(k(e.pageX,e.pageY)),d.copy(l)),document.addEventListener("mousemove",N,!1),document.addEventListener("mouseup",P,!1),r.dispatchEvent(E))}function N(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),s!==i.ROTATE||r.noRotate?s!==i.ZOOM||r.noZoom?s!==i.PAN||r.noPan||f.copy(H(e.pageX,e.pageY)):p.copy(H(e.pageX,e.pageY)):(d.copy(l),l.copy(k(e.pageX,e.pageY))))}function P(e){!1!==r.enabled&&(e.preventDefault(),e.stopPropagation(),s=i.NONE,document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",P),r.dispatchEvent(v))}function W(e){if(!1!==r.enabled&&!0!==r.noZoom){switch(e.preventDefault(),e.stopPropagation(),e.deltaMode){case 2:h.y-=.025*e.deltaY;break;case 1:h.y-=.01*e.deltaY;break;default:h.y-=25e-5*e.deltaY}r.dispatchEvent(E),r.dispatchEvent(v)}}function A(e){if(!1!==r.enabled){switch(e.preventDefault(),e.touches.length){case 1:s=i.TOUCH_ROTATE,l.copy(k(e.touches[0].pageX,e.touches[0].pageY)),d.copy(l);break;default:s=i.TOUCH_ZOOM_PAN;var t=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY;g=m=Math.sqrt(t*t+a*a);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;w.copy(H(n,o)),f.copy(w)}r.dispatchEvent(E)}}function B(e){if(!1!==r.enabled)switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:d.copy(l),l.copy(k(e.touches[0].pageX,e.touches[0].pageY));break;default:var t=e.touches[0].pageX-e.touches[1].pageX,a=e.touches[0].pageY-e.touches[1].pageY;g=Math.sqrt(t*t+a*a);var n=(e.touches[0].pageX+e.touches[1].pageX)/2,o=(e.touches[0].pageY+e.touches[1].pageY)/2;f.copy(H(n,o))}}function G(e){if(!1!==r.enabled){switch(e.touches.length){case 0:s=i.NONE;break;case 1:s=i.TOUCH_ROTATE,l.copy(k(e.touches[0].pageX,e.touches[0].pageY)),d.copy(l)}r.dispatchEvent(v)}}function F(e){!1!==r.enabled&&e.preventDefault()}this.rotateCamera=(T=new XDTHREE.Vector3,C=new XDTHREE.Quaternion,D=new XDTHREE.Vector3,I=new XDTHREE.Vector3,U=new XDTHREE.Vector3,V=new XDTHREE.Vector3,function(){V.set(l.x-d.x,l.y-d.y,0),(x=V.length())?(o.copy(r.object.position).sub(r.target),D.copy(o).normalize(),I.copy(r.object.up).normalize(),U.crossVectors(I,D).normalize(),I.setLength(l.y-d.y),U.setLength(l.x-d.x),V.copy(I.add(U)),T.crossVectors(V,o).normalize(),x*=r.rotateSpeed,C.setFromAxisAngle(T,x),o.applyQuaternion(C),r.object.up.applyQuaternion(C),u.copy(T),c=x):!r.staticMoving&&c&&(c*=Math.sqrt(1-r.dynamicDampingFactor),o.copy(r.object.position).sub(r.target),C.setFromAxisAngle(u,c),o.applyQuaternion(C),r.object.up.applyQuaternion(C)),d.copy(l)}),this.zoomCamera=function(){var e;s===i.TOUCH_ZOOM_PAN?(e=m/g,m=g,o.multiplyScalar(e)):(1!==(e=1+(p.y-h.y)*r.zoomSpeed)&&0<e&&o.multiplyScalar(e),r.staticMoving?h.copy(p):h.y+=(p.y-h.y)*this.dynamicDampingFactor)},this.panCamera=(S=new XDTHREE.Vector2,M=new XDTHREE.Vector3,X=new XDTHREE.Vector3,function(){S.copy(f).sub(w),S.lengthSq()&&(S.multiplyScalar(o.length()*r.panSpeed),X.copy(o).cross(r.object.up).setLength(S.x),X.add(M.copy(r.object.up).setLength(S.y)),r.object.position.add(X),r.target.add(X),r.staticMoving?w.copy(f):w.add(S.subVectors(f,w).multiplyScalar(r.dynamicDampingFactor)))}),this.checkDistances=function(){r.noZoom&&r.noPan||(o.lengthSq()>r.maxDistance*r.maxDistance&&(r.object.position.addVectors(r.target,o.setLength(r.maxDistance)),h.copy(p)),o.lengthSq()<r.minDistance*r.minDistance&&(r.object.position.addVectors(r.target,o.setLength(r.minDistance)),h.copy(p)))},this.update=function(){o.subVectors(r.object.position,r.target),r.noRotate||r.rotateCamera(),r.noZoom||r.zoomCamera(),r.noPan||r.panCamera(),r.object.position.addVectors(r.target,o),r.checkDistances(),r.object.lookAt(r.target),1e-6<a.distanceToSquared(r.object.position)&&(r.dispatchEvent(y),a.copy(r.object.position))},this.reset=function(){s=i.NONE,n=i.NONE,r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.up.copy(r.up0),o.subVectors(r.object.position,r.target),r.object.lookAt(r.target),r.dispatchEvent(y),a.copy(r.object.position)},this.dispose=function(){this.domElement.removeEventListener("contextmenu",F,!1),this.domElement.removeEventListener("mousedown",O,!1),this.domElement.removeEventListener("wheel",W,!1),this.domElement.removeEventListener("touchstart",A,!1),this.domElement.removeEventListener("touchend",G,!1),this.domElement.removeEventListener("touchmove",B,!1),document.removeEventListener("mousemove",N,!1),document.removeEventListener("mouseup",P,!1),window.removeEventListener("keydown",j,!1),window.removeEventListener("keyup",L,!1)},this.domElement.addEventListener("contextmenu",F,!1),this.domElement.addEventListener("mousedown",O,!1),this.domElement.addEventListener("wheel",W,!1),this.domElement.addEventListener("touchstart",A,!1),this.domElement.addEventListener("touchend",G,!1),this.domElement.addEventListener("touchmove",B,!1),window.addEventListener("keydown",j,!1),window.addEventListener("keyup",L,!1),this.handleResize(),this.update()},XDTHREE.TrackballControls.prototype=Object.create(XDTHREE.EventDispatcher.prototype),XDTHREE.TrackballControls.prototype.constructor=XDTHREE.TrackballControls;var Player=function(e){var t=e.signals,a=new UI.Panel;a.setId("player"),a.setPosition("absolute"),a.setDisplay("none");var n=new XDAPP.Player;return a.dom.appendChild(n.dom),window.addEventListener("resize",function(){n.setSize(a.dom.clientWidth,a.dom.clientHeight)}),t.startPlayer.add(function(){a.setDisplay("block"),n.load(e.toJSON(),e.scene.name),n.setSize(a.dom.clientWidth,a.dom.clientHeight),n.play(!0)}),t.stopPlayer.add(function(){a.setDisplay("none"),n.stop(!0),n.dispose()}),a},WEBVR={createButton:function(t){function a(e){o.style.display="",o.style.cursor="pointer",o.style.left="calc(50% - 50px)",o.style.width="100px",o.textContent="ENTER VR",o.onmouseenter=function(){o.style.opacity="1.0"},o.onmouseleave=function(){o.style.opacity="0.5"},o.onclick=function(){e.isPresenting?e.exitPresent():e.requestPresent([{source:t.domElement}])},t.vr.setDevice(e)}function n(){o.style.display="",o.style.cursor="auto",o.style.left="calc(50% - 75px)",o.style.width="150px",o.textContent="VR NOT FOUND",o.onmouseenter=null,o.onmouseleave=null,o.onclick=null,t.vr.setDevice(null)}function e(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="transparent",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("getVRDisplays"in navigator){var o=document.createElement("button");return o.style.display="none",e(o),window.addEventListener("vrdisplayconnect",function(e){a(e.display)},!1),window.addEventListener("vrdisplaydisconnect",function(e){n()},!1),window.addEventListener("vrdisplaypresentchange",function(e){o.textContent=e.display.isPresenting?"EXIT VR":"ENTER VR"},!1),navigator.getVRDisplays().then(function(e){0<e.length?a(e[0]):n()}),o}var r=document.createElement("a");return r.href="https://webvr.info",r.innerHTML="WEBVR NOT SUPPORTED",r.style.left="calc(50% - 90px)",r.style.width="180px",r.style.textDecoration="none",e(r),r},checkAvailability:function(){return console.warn("WEBVR.checkAvailability has been deprecated."),new Promise(function(){})},getMessageContainer:function(){return console.warn("WEBVR.getMessageContainer has been deprecated."),document.createElement("div")},getButton:function(){return console.warn("WEBVR.getButton has been deprecated."),document.createElement("div")},getVRDisplay:function(){console.warn("WEBVR.getVRDisplay has been deprecated.")}},Storage=function(){if(void 0===(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB))return console.warn("Storage: IndexedDB not available."),{init:function(){},get:function(){},set:function(){},clear:function(){}};var n;return{init:function(e){},get:function(t){n.transaction(["states"],"readwrite").objectStore("states").get(0).onsuccess=function(e){t(e.target.result)}},set:function(e,t){var a=performance.now();n.transaction(["states"],"readwrite").objectStore("states").put(e,0).onsuccess=function(e){console.log("["+/\d\d\:\d\d\:\d\d/.exec(new Date)[0]+"]","Saved state to IndexedDB. "+(performance.now()-a).toFixed(2)+"ms")}},clear:function(){}}},Editor=function(e,t){this.DEFAULT_CAMERA=new XDTHREE.PerspectiveCamera(50,1,.01,1e3),this.DEFAULT_CAMERA.name="Camera",this.DEFAULT_CAMERA.position.set(0,10,50),this.DEFAULT_CAMERA.lookAt(new XDTHREE.Vector3);var a=signals.Signal;this.signals={editScript:new a,startPlayer:new a,stopPlayer:new a,showModal:new a,editorCleared:new a,savingStarted:new a,savingFinished:new a,themeChanged:new a,transformModeChanged:new a,snapChanged:new a,spaceChanged:new a,rendererChanged:new a,sceneBackgroundChanged:new a,sceneFogChanged:new a,sceneGraphChanged:new a,sceneCapture:new a,cameraChanged:new a,geometryChanged:new a,objectSelected:new a,objectFocused:new a,objectAdded:new a,objectChanged:new a,objectRemoved:new a,helperAdded:new a,helperRemoved:new a,materialChanged:new a,scriptAdded:new a,scriptChanged:new a,scriptRemoved:new a,animationAdded:new a,animationChanged:new a,animationRemoved:new a,controlsTogglePlay:new a,controlsRestartPlay:new a,startPlaying:new a,pausePlaying:new a,controlsStop:new a,windowResize:new a,showGridChanged:new a,showCountsChanged:new a,refreshSidebarObject3D:new a,historyChanged:new a},this.container=e,this.config=new Config("threejs-editor"),this.history=new History(this),this.storage=new Storage,this.loader=new Loader(this),this.camera=this.DEFAULT_CAMERA.clone(),this.scene=new XDTHREE.Scene,this.scene.name="Scene",this.scene.duration=10,this.scene.background=new XTRADVIEWER.Background("editor"),this.scene.background.createColorBackground(11184810),this.sceneHelpers=new XDTHREE.Scene,this.object={},this.geometries={},this.materials={},this.textures={},this.scripts={},this.selected=null,this.helpers={},this.heightRatio=50,this.showCounts=!0,this.author=null!=t?t:"",this.templates=[]};Editor.prototype={setTheme:function(e){document.getElementById("theme").href=e,this.signals.themeChanged.dispatch(e)},setScene:function(e){for(this.scene.uuid=e.uuid,this.scene.name=e.name,this.scene.duration=10,null!==e.background&&(this.scene.background=new XTRADVIEWER.Background("editor"),this.scene.background=e.background.clone()),null!==e.fog&&(this.scene.fog=e.fog.clone()),this.scene.userData=JSON.parse(JSON.stringify(e.userData)),this.signals.sceneGraphChanged.active=!1;0<e.children.length;)this.addObject(e.children[0]);this.signals.sceneGraphChanged.active=!0,this.signals.sceneGraphChanged.dispatch()},addObject:function(e){var t=this;e.traverse(function(e){void 0!==e.geometry&&t.addGeometry(e.geometry),void 0!==e.material&&t.addMaterial(e.material),t.addHelper(e)}),this.scene.add(e),this.signals.objectAdded.dispatch(e),this.signals.sceneGraphChanged.dispatch()},moveObject:function(e,t,a){if(void 0===t&&(t=this.scene),t.add(e),void 0!==a){var n=t.children.indexOf(a);t.children.splice(n,0,e),t.children.pop()}this.signals.sceneGraphChanged.dispatch()},nameObject:function(e,t){e.name=t,this.signals.sceneGraphChanged.dispatch()},removeObject:function(e){if(null!==e.parent){var t=this;e.traverse(function(e){t.removeHelper(e)}),e.parent.remove(e),this.signals.objectRemoved.dispatch(e),this.signals.sceneGraphChanged.dispatch()}},addGeometry:function(e){this.geometries[e.uuid]=e},setGeometryName:function(e,t){e.name=t,this.signals.sceneGraphChanged.dispatch()},addMaterial:function(e){this.materials[e.uuid]=e},setMaterialName:function(e,t){e.name=t,this.signals.sceneGraphChanged.dispatch()},addTexture:function(e){this.textures[e.uuid]=e},addHelper:function(){var n=new XDTHREE.SphereBufferGeometry(2,4,2),o=new XDTHREE.MeshBasicMaterial({color:16711680,visible:!1});return function(e){var t;if(e.isCamera)t=new XDTHREE.CameraHelper(e,1);else if(e.isPointLight)t=new XDTHREE.PointLightHelper(e,1);else if(e.isDirectionalLight)t=new XDTHREE.DirectionalLightHelper(e,1);else if(e.isSpotLight)t=new XDTHREE.SpotLightHelper(e,1);else if(e.isHemisphereLight)t=new XDTHREE.HemisphereLightHelper(e,1);else{if(!e.isSkinnedMesh)return;t=new XDTHREE.SkeletonHelper(e.skeleton.bones[0])}var a=new XDTHREE.Mesh(n,o);a.name="picker",a.userData.object=e,t.add(a),this.sceneHelpers.add(t),this.helpers[e.id]=t,this.signals.helperAdded.dispatch(t)}}(),removeHelper:function(e){if(void 0!==this.helpers[e.id]){var t=this.helpers[e.id];t.parent.remove(t),delete this.helpers[e.id],this.signals.helperRemoved.dispatch(t)}},addScript:function(e,t){void 0===this.scripts[e.uuid]&&(this.scripts[e.uuid]=[]),this.scripts[e.uuid].push(t),this.signals.scriptAdded.dispatch(t)},removeScript:function(e,t){if(void 0!==this.scripts[e.uuid]){var a=this.scripts[e.uuid].indexOf(t);-1!==a&&this.scripts[e.uuid].splice(a,1),this.signals.scriptRemoved.dispatch(t)}},getObjectMaterial:function(e,t){var a=e.material;return Array.isArray(a)&&(a=a[t]),a},setObjectMaterial:function(e,t,a){Array.isArray(e.material)?e.material[t]=a:e.material=a},select:function(e){if(this.selected!==e){var t=null;null!==e&&(t=e.uuid),this.selected=e,this.config.setKey("selected",t),this.signals.objectSelected.dispatch(e)}},selectById:function(e){e!==this.camera.id?this.select(this.scene.getObjectById(e,!0)):this.select(this.camera)},selectByUuid:function(t){var a=this;this.scene.traverse(function(e){e.uuid===t&&a.select(e)})},deselect:function(){this.select(null)},focus:function(e){void 0!==e&&this.signals.objectFocused.dispatch(e)},focusById:function(e){this.focus(this.scene.getObjectById(e,!0))},clear:function(){this.scene.dispose(),this.history.clear(),this.storage.clear(),this.camera.copy(this.DEFAULT_CAMERA),this.scene.userData={},this.scene.background=new XTRADVIEWER.Background("editor"),this.scene.background.createColorBackground(11184810),this.scene.fog=null,this.scene.name="Scene";for(var e=this.scene.children;0<e.length;)this.removeObject(e[0]);this.geometries={},this.materials={},this.textures={},this.scripts={},this.animations={},this.templates=[],this.config.setKey("project/title","Scene"),this.config.setKey("project/description","Description"),this.config.setKey("project/author",null!=this.author?this.author:"");var t=new Date,a=t.getDate()+"-"+(t.getMonth()+1)+"-"+t.getFullYear();this.config.setKey("project/date",a),this.config.setKey("project/image",""),this.config.setKey("project/imagetype","Auto"),this.config.setKey("project/simpleAdvancedMode","Simple"),this.config.setKey("project/camera/animation","None"),this.config.setKey("project/camera/animationSpeed",1),this.config.setKey("project/camera/animationStartAngle",-90),this.config.setKey("project/camera/animationOscillationAngle",45),this.deselect(),this.signals.editorCleared.dispatch(),this.scene.duration=10},fromJSON:function(e){var t=new XDTHREE.ObjectLoader;if(void 0!==e.scene){var a=t.parse(e.camera);this.camera.copy(a),this.camera.aspect=this.DEFAULT_CAMERA.aspect,this.camera.updateProjectionMatrix(),this.history.fromJSON(e.history),this.scripts=e.scripts,null!=e.templates&&(this.templates=e.templates),this.project=e.project,this.config.setKey("project/heightRatio",null!=this.project.heightRatio?this.project.heightRatio:50),this.config.setKey("project/image",null!=this.project.image?this.project.image:""),this.config.setKey("project/imagetype",null!=this.project.imagetype?this.project.imagetype:"Auto"),this.config.setKey("project/simpleAdvancedMode",null!=this.project.simpleAdvancedMode?this.project.simpleAdvancedMode:"Simple"),this.config.setKey("project/title",null!=this.project.title?this.project.title:""),this.config.setKey("project/description",null!=this.project.description?this.project.description:""),this.config.setKey("project/author",null!=this.project.author?this.project.author:""),this.config.setKey("project/date",null!=this.project.date?this.project.date:""),this.config.setKey("project/camera/animation",null!=this.project.cameraanimation?this.project.cameraanimation:"None"),this.config.setKey("project/camera/animationSpeed",null!=this.project.cameraanimationspeed?this.project.cameraanimationspeed:1),this.config.setKey("project/camera/animationStartAngle",null!=this.project.cameraanimationstartangle?this.project.cameraanimationstartangle:-90),this.config.setKey("project/camera/animationOscillationAngle",null!=this.project.cameraanimationoscillationangle?this.project.cameraanimationoscillationangle:45),null==e.project.heightRatio&&(e.project.heightRatio=50),this.heightRatio=e.project.heightRatio;var n=t.parse(e.scene);if(n.traverse(function(t){if(t.isSpotLight&&null!=t.targetname&&0<=t.targetname.length){var a=t.targetname;n.traverse(function(e){null!=e.name&&e.name===a&&(t.target=e)})}}),this.setScene(n),null!=e.animations)new XTRADANIMATION.Animation(null).updateAnimations(this.scene,e.animations)}else this.setScene(t.parse(e))},toJSON:function(){var e=this.scene,t=this.scripts;for(var a in t){0!==t[a].length&&void 0!==e.getObjectByProperty("uuid",a)||delete t[a]}return{metadata:{},project:{heightRatio:this.heightRatio,image:this.config.getKey("project/image"),imagetype:this.config.getKey("project/imagetype"),simpleAdvancedMode:this.config.getKey("project/simpleAdvancedMode"),title:this.config.getKey("project/title"),description:this.config.getKey("project/description"),author:this.config.getKey("project/author"),date:this.config.getKey("project/date"),cameraanimation:this.config.getKey("project/camera/animation"),cameraanimationspeed:this.config.getKey("project/camera/animationSpeed"),cameraanimationstartangle:this.config.getKey("project/camera/animationStartAngle"),cameraanimationoscillationangle:this.config.getKey("project/camera/animationOscillationAngle")},camera:this.camera.toJSON(),scene:this.scene.toJSON(),scripts:this.scripts,history:this.history.toJSON(),templates:this.templates}},objectByUuid:function(e){return this.scene.getObjectByProperty("uuid",e,!0)},execute:function(e,t){this.history.execute(e,t)},undo:function(){this.history.undo()},redo:function(){this.history.redo()}};var Config=function(e){var a={language:"en",autosave:!1,theme:"css/dark.css","project/title":"New Scene","project/description":"","project/author":"anonymous","project/date":"","project/editable":!0,"project/renderer":"WebGLRenderer","project/renderer/antialias":!0,"project/renderer/shadows":!0,"project/vr":!1,"project/simpleAdvancedMode":"Simple","project/camera/animation":"None","project/camera/animationSpeed":1,"project/camera/animationStartAngle":-90,"project/camera/animationOscillationAngle":45,"settings/history":!1,"settings/shortcuts/translate":"w","settings/shortcuts/rotate":"e","settings/shortcuts/scale":"r","settings/shortcuts/undo":"z","settings/shortcuts/focus":"f"};return{getKey:function(e){return a[e]},setKey:function(){for(var e=0,t=arguments.length;e<t;e+=2)a[arguments[e]]=arguments[e+1]},clear:function(){}}};History=function(e){this.editor=e,this.undos=[],this.redos=[],this.lastCmdTime=new Date,this.idCounter=0,this.historyDisabled=!1,this.config=e.config,Command(e);var t=this;this.editor.signals.startPlayer.add(function(){t.historyDisabled=!0}),this.editor.signals.stopPlayer.add(function(){t.historyDisabled=!1})},History.prototype={execute:function(e,t){var a=this.undos[this.undos.length-1],n=(new Date).getTime()-this.lastCmdTime.getTime(),o=a&&a.updatable&&e.updatable&&a.object===e.object&&a.type===e.type&&a.script===e.script&&a.attributeName===e.attributeName;o&&"SetScriptValueCommand"===e.type?(a.update(e),e=a):o&&n<500?(a.update(e),e=a):(this.undos.push(e),e.id=++this.idCounter),e.name=void 0!==t?t:e.name,e.execute(),e.inMemory=!0,this.config.getKey("settings/history")&&(e.json=e.toJSON()),this.lastCmdTime=new Date,this.redos=[],this.editor.signals.historyChanged.dispatch(e)},undo:function(){if(!this.historyDisabled){var e=void 0;return 0<this.undos.length&&!1===(e=this.undos.pop()).inMemory&&e.fromJSON(e.json),void 0!==e&&(e.undo(),this.redos.push(e),this.editor.signals.historyChanged.dispatch(e)),e}alert("Undo/Redo disabled while scene is playing.")},redo:function(){if(!this.historyDisabled){var e=void 0;return 0<this.redos.length&&!1===(e=this.redos.pop()).inMemory&&e.fromJSON(e.json),void 0!==e&&(e.execute(),this.undos.push(e),this.editor.signals.historyChanged.dispatch(e)),e}alert("Undo/Redo disabled while scene is playing.")},toJSON:function(){var e={undos:[],redos:[]};if(!this.config.getKey("settings/history"))return e;for(var t=0;t<this.undos.length;t++)this.undos[t].hasOwnProperty("json")&&e.undos.push(this.undos[t].json);for(t=0;t<this.redos.length;t++)this.redos[t].hasOwnProperty("json")&&e.redos.push(this.redos[t].json);return e},fromJSON:function(e){if(void 0!==e){for(var t=0;t<e.undos.length;t++){var a=e.undos[t];(n=new window[a.type]).json=a,n.id=a.id,n.name=a.name,this.undos.push(n),this.idCounter=a.id>this.idCounter?a.id:this.idCounter}for(t=0;t<e.redos.length;t++){var n;a=e.redos[t];(n=new window[a.type]).json=a,n.id=a.id,n.name=a.name,this.redos.push(n),this.idCounter=a.id>this.idCounter?a.id:this.idCounter}this.editor.signals.historyChanged.dispatch(this.undos[this.undos.length-1])}},clear:function(){this.undos=[],this.redos=[],this.idCounter=0,this.editor.signals.historyChanged.dispatch()},goToState:function(e){if(this.historyDisabled)alert("Undo/Redo disabled while scene is playing.");else{this.editor.signals.sceneGraphChanged.active=!1,this.editor.signals.historyChanged.active=!1;var t=0<this.undos.length?this.undos[this.undos.length-1]:void 0;if(void 0===t||e>t.id)for(t=this.redo();void 0!==t&&e>t.id;)t=this.redo();else for(;void 0!==(t=this.undos[this.undos.length-1])&&e!==t.id;)this.undo();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.historyChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch(),this.editor.signals.historyChanged.dispatch(t)}},enableSerialization:function(e){this.goToState(-1),this.editor.signals.sceneGraphChanged.active=!1,this.editor.signals.historyChanged.active=!1;for(var t=this.redo();void 0!==t;)t.hasOwnProperty("json")||(t.json=t.toJSON()),t=this.redo();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.historyChanged.active=!0,this.goToState(e)}};var Loader=function(m){var g=this;m.signals;this.textureNames=[],this.textures=[],this.texturePath="",this.loadFiles=function(a){if(0<a.length){p(a);var t=function(e){for(var t=0,a=0;a<e.length;a++){var n=e[a],o=n.name,r=o.split(".").pop().toLowerCase();"jpg"!==r&&"png"!==r&&"gif"!==r||t++}return t}(a);!function(e){g.textureNames=[],g.textures=[];for(var t=0;t<e.length;t++){var a=e[t],n=a.name,o=n.split(".").pop().toLowerCase();if("jpg"===o||"png"===o||"gif"===o){g.textureNames.push(n);var r=new FileReader;r.addEventListener("load",function(e){var t=document.createElement("img");t.src=e.target.result;var a=g.textures.length,n=new XDTHREE.Texture(t);n.sourceFile=g.textureNames[a],n.needsUpdate=!0,g.textures.push(n)},!1),r.readAsDataURL(a)}}}(a);for(var i="",s="",d=null,n=null,e=0;e<a.length;e++){var o=a[e],r=o.name,l=r.split(".").pop().toLowerCase();switch(l.toLowerCase()){case"obj":d=o;var u=(i=r).substring(0,r.lastIndexOf("."));break;case"mtl":n=o,s=r;break;case"jpg":case"png":case"gif":break;default:alert("Unknown object type - "+l)}}var c=new XDTHREE.OBJLoader2,h=setInterval(function(){if(g.textures.length>=t){clearInterval(h);var e,o=function(e){!function(e){var t=e,a=(new XDTHREE.Box3).setFromObject(t),n=0;a.max.x-a.min.x>n&&(n=a.max.x-a.min.x);a.max.y-a.min.y>n&&(n=a.max.y-a.min.y);a.max.z-a.min.z>n&&(n=a.max.z-a.min.z);var o=25/n;t.scale.set(o,o,o),t.name=i,m.execute(new AddObjectCommand(t)),console.log("Loading complete: "+t.name)}(e)},r=function(n){for(var e=0;e<n.length;e++)console.log("Material Name - "+n[e].name);var t=new FileReader;t.addEventListener("progress",function(e){var t="("+Math.floor(e.total/1e3).format()+" KB)",a=Math.floor(e.loaded/e.total*100)+"%";console.log("Loading",i,t,a)}),t.addEventListener("load",function(e){var t=e.target.result;c.setModelName(u),c.setMaterials(n),c.setLogging(!0,!0);var a=c.parse(t);o(a)},!1),t.readAsText(d)};if(0<s.length)(new XDTHREE.LoadingManager).setURLModifier(function(e){var t=p(a)[e];return t?(console.log("Loading",e),URL.createObjectURL(t)):e}),(e=new FileReader).addEventListener("progress",function(e){var t="("+Math.floor(e.total/1e3).format()+" KB)",a=Math.floor(e.loaded/e.total*100)+"%";console.log("Loading",s,t,a)}),e.addEventListener("load",function(e){for(var t=e.target.result,a={},n=0;n<g.textures.length;n++)a[g.textureNames[n]]=g.textures[n];c.loadMtl(s,t,a,r)},!1),e.readAsText(n);else if(0<i.length)(e=new FileReader).addEventListener("load",function(e){var t=e.target.result,a=function(){for(var e={},t=0;t<g.textures.length;t++)e[g.textureNames[t]]=g.textures[t];return e}();c.setModelName(u),c.setMaterials(a),c.setLogging(!0,!0);var n=c.parse(t);o(n)},!1),e.readAsText(d);else alert("No obj file provided")}},500,g)}function p(e){for(var t={},a=0;a<e.length;a++){var n=e[a];t[n.name]=n}return t}}},Menubar=function(e){var t=new UI.Panel;return t.setId("menubar"),t.add(new Menubar.File(e)),t.add(new Menubar.Edit(e)),t.add(new Menubar.Lights(e)),t.add(new Menubar.Play(e)),t.add(new Menubar.Examples(e)),t.add(new Menubar.Help(e)),t.add(new Menubar.Status(e)),t};Menubar.File=function(a){var n=a.config,e=new UI.Panel;e.setClass("menu");var t=new UI.Panel;t.setClass("title"),t.setTextContent("File"),t.dom.zIndex=1e3,e.add(t);var o=new UI.Panel;o.setClass("options"),e.add(o);var r=document.createElement("form");r.style.display="none",document.body.appendChild(r);var i,s=document.createElement("input");s.multiple=!0,s.type="file",s.addEventListener("change",function(e){a.loader.loadFiles(s.files),r.reset()}),r.appendChild(s),(i=new UI.Row).setClass("option"),i.setTextContent("Import Obj/Mtl"),i.onClick(function(){s.click()}),o.add(i),(i=new UI.Row).setClass("option"),i.setTextContent("Capture Image"),i.onClick(function(){var e=document.createElement("a"),t=n.getKey("project/title");0<t.length?e.download=t+".png":e.download="xtrad-capture.png",a.signals.sceneGraphChanged.dispatch(),e.href=document.getElementById("editorcanvasid").toDataURL().replace("image/png","image/octet-stream"),e.click(),alert("Captured!")}),o.add(i);var d=document.createElement("a");return d.style.display="none",document.body.appendChild(d),e},Menubar.Edit=function(a){var e=new UI.Panel;e.setClass("menu");var t=new UI.Panel;t.setClass("title"),t.setTextContent("Edit"),e.add(t);var n=new UI.Panel;n.setClass("options"),e.add(n);var o=new UI.Row;o.setClass("option"),o.setTextContent("Undo (Ctrl+Z)"),o.onClick(function(){a.undo()}),n.add(o);var r,i=new UI.Row;return i.setClass("option"),i.setTextContent("Redo (Ctrl+Shift+Z)"),i.onClick(function(){a.redo()}),n.add(i),(r=new UI.Row).setClass("option"),r.setTextContent("Clear History"),r.onClick(function(){confirm("The Undo/Redo History will be cleared. Are you sure?")&&a.history.clear()}),n.add(r),a.signals.historyChanged.add(function(){var e=a.history;o.setClass("option"),i.setClass("option"),0==e.undos.length&&o.setClass("inactive"),0==e.redos.length&&i.setClass("inactive")}),n.add(new UI.HorizontalRule),(r=new UI.Row).setClass("option"),r.setTextContent("Delete (Del)"),r.onClick(function(){var e=a.selected;if(null==e)alert("You must select an object to delete first!");else{var t=null!=e.name?e.name:"";if(!1===confirm("Delete "+t+"?"))return;if(void 0===e.parent)return;a.execute(new RemoveObjectCommand(e))}}),n.add(r),e},Menubar.Lights=function(n){var e=new UI.Panel;e.setClass("menu");var t=new UI.Panel;t.setClass("title"),t.setTextContent("Add Lights"),e.add(t);var a,o=new UI.Panel;return o.setClass("options"),e.add(o),(a=new UI.Row).setClass("option"),a.setTextContent("PointLight"),a.onClick(function(){var e=new XDTHREE.PointLight(16777215,1,0);e.name="PointLight",n.execute(new AddObjectCommand(e))}),o.add(a),(a=new UI.Row).setClass("option"),a.setTextContent("SpotLight"),a.onClick(function(){var t=1;n.scene.traverse(function(e){e.isSpotLight&&t++});var e=new XDTHREE.SpotLight(16777215);e.name="SpotLight"+t,e.position.set(5,10,7.5),e.angle=Math.PI/4,e.penumbra=.05,e.decay=2,e.distance=0,e.castShadow=!0,e.shadow.mapSize.width=128,e.shadow.mapSize.height=128,e.shadow.camera.near=50,e.shadow.camera.far=400,e.shadow.camera.fov=30;var a=new XDTHREE.Object3D;a.position.set(0,0,0),a.name="SpotTarget"+t,e.target=a,n.execute(new AddObjectCommand(e)),n.execute(new AddObjectCommand(e.target))}),o.add(a),(a=new UI.Row).setClass("option"),a.setTextContent("DirectionalLight"),a.onClick(function(){var e=new XDTHREE.DirectionalLight(16777215,1);e.name="DirectionalLight",e.target.name="DirectionalLight Target",e.position.set(5,10,7.5),n.execute(new AddObjectCommand(e))}),o.add(a),(a=new UI.Row).setClass("option"),a.setTextContent("HemisphereLight"),a.onClick(function(){var e=new XDTHREE.HemisphereLight(43775,16755200,1);e.name="HemisphereLight",e.position.set(0,10,0),n.execute(new AddObjectCommand(e))}),o.add(a),(a=new UI.Row).setClass("option"),a.setTextContent("AmbientLight"),a.onClick(function(){var e=new XDTHREE.AmbientLight(2236962);e.name="AmbientLight",n.execute(new AddObjectCommand(e))}),o.add(a),e},Menubar.Play=function(e){var t=e.signals,a=new UI.Panel;a.setClass("menu");var n=!1,o=new UI.Panel;return o.setClass("title"),o.setTextContent("Play"),o.onClick(function(){!1===n?(n=!0,o.setTextContent("Stop"),t.startPlayer.dispatch()):(n=!1,o.setTextContent("Play"),t.stopPlayer.dispatch())}),a.add(o),a};var xtrad_pluginUrl="",xtrad_uploadUrl="";Menubar.Examples=function(l){xtrad_pluginUrl=xtradDirData.pluginurl,xtrad_uploadUrl=xtradDirData.uploadurl;var e=new UI.Panel;e.setClass("menu");var t=new UI.Panel;t.setClass("title"),t.setTextContent("Templates"),e.add(t);var a=new UI.Panel;return a.setClass("options"),e.add(a),option=new UI.Row,option.setClass("option"),option.setTextContent("Templates"),option.onClick(function(){var e=window.location.href,t=e.indexOf("/wp-admin"),i=(e.substring(0,t),new UI.Modal);i.container.dom.style.width="800px",i.dom.style.width="800px",i.dom.style.height="",xtrad_Viewer.container.appendChild(i.dom);var a=new UI.Panel;a.dom.style.width="800px";var n=new UI.Row,s=new UI.ImageSelect(xtrad_pluginUrl+"/images/",["3D_Text_-_From_Back_To_Front.jpg","3D_Text_with_Squares_-_Back_To_Front.jpg","Ball_Particles_-_Chars_Linear.jpg","Exterior_-_Sunset_-_Checkered_3D_Text.jpg","Image_and_3D_Text.jpg","Interior_-_Spot_Lights_-_3D_Chars.jpg","Interior_3D_Text.jpg","Rotating_Cube_and_3D_Text.jpg","Water_-_3D_Text_-_Rotate_Y.jpg"],"Image",239,120,3,0,!0,!0);n.add(new UI.Text("Template").setWidth("150px")),n.add(s),a.add(n);var o=new UI.Row;o.dom.style.clear="left";var r=new UI.Button("OK").onClick(function(){i.hide();var e=s.getImage();if(0<e.length){if(confirm("Any unsaved data will be lost. Are you sure?")){var t=window.location.href,a=t.indexOf("/wp-admin"),n=t.substring(0,a),o={action:"get_template",template:e=e.substring(0,e.lastIndexOf("."))+".json"},r=n+"/wp-admin/admin-ajax.php";jQuery.post(r,o,function(e){var t=JSON.parse(e),a=t.template,n=JSON.parse(a);xtrad_fontCount=[],xtrad_CubeTexture=[],xtrad_Water=0,xtrad_texg={},xtrad_fonts={},xtrad_fontCount.template=0,xtrad_CubeTexture.template=0;var o=window.location.href,r=o.indexOf("/wp-admin");o.substring(0,r);xtrad_o_traverse_for_fonts("template",n);var i=setInterval(function(){if(xtrad_fontCount.template<=0){clearInterval(i),xtrad_o_traverse("template",n),l.clear(),l.fromJSON(n);var e=50;null!=l.heightRatio&&(e=l.heightRatio);var t=0===xtrad_Viewer.container.clientWidth?xtrad_Viewer.container.parentNode.clientWidth:xtrad_Viewer.container.clientWidth,a=0<t?e/100*(t-300)+64:0;xtrad_Viewer.container.style.height=Math.round(a)+"px",l.signals.windowResize.dispatch()}},1e3,n,l)})}}else alert("You must select a template")});o.add(r);var d=new UI.Button("CANCEL").onClick(function(){i.hide()});o.add(d),a.add(o),i.show(a)}),a.add(option),e},Menubar.Help=function(e){var t=new UI.Panel;t.setClass("menu");var a=new UI.Panel;a.setClass("title"),a.setTextContent("Help"),t.add(a);var n,o=new UI.Panel;return o.setClass("options"),t.add(o),(n=new UI.Row).setClass("option"),n.setTextContent("Quick Start Guide"),n.onClick(function(){window.open("http://viewer.xtra-d.co.uk/quick-start-guide/","_blank")}),o.add(n),(n=new UI.Row).setClass("option"),n.setTextContent("Training Videos"),n.onClick(function(){window.open("http://viewer.xtra-d.co.uk/documentation/training-videos/","_blank")}),o.add(n),(n=new UI.Row).setClass("option"),n.setTextContent("About"),n.onClick(function(){window.open("http://editor.xtra-d.co.uk/about/","_blank")}),o.add(n),t},Menubar.Status=function(e){var t=new UI.Panel;t.setClass("menu right");var a=new UI.Text("r"+XDTHREE.REVISION);return a.setClass("title"),a.setOpacity(.5),t.add(a),t};var Sidebar=function(e){var t=new UI.Panel;t.setId("sidebar");var a=new UI.Text("SCENE").onClick(i),n=new UI.Text("PROJECT").onClick(i),o=new UI.Text("SETTINGS").onClick(i),r=new UI.Div;function i(e){u(e.target.textContent)}r.setId("tabs"),r.add(a,n,o),t.add(r);var s=(new UI.Span).add(new Sidebar.Scene(e),new Sidebar.Properties(e),new Sidebar.Animation(e));t.add(s);var d=(new UI.Span).add(new Sidebar.Project(e));t.add(d);var l=(new UI.Span).add(new Sidebar.Settings(e),new Sidebar.History(e));function u(e){switch(a.setClass(""),n.setClass(""),o.setClass(""),s.setDisplay("none"),d.setDisplay("none"),l.setDisplay("none"),e){case"SCENE":a.setClass("selected"),s.setDisplay("");break;case"PROJECT":n.setClass("selected"),d.setDisplay("");break;case"SETTINGS":o.setClass("selected"),l.setDisplay("")}}return t.add(l),u("SCENE"),t};Sidebar.Scene=function(r){var e=r.signals,t=new UI.Panel;function d(e,t){var a=document.createElement("div");return a.draggable=t,a.innerHTML=o(e),a.value=e.id,a}function i(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function o(e){var t,a='<span class="type '+e.type+'"></span> '+i(e.name);if(e.isMesh){var n=e.geometry,o=e.material;a+=' <span class="type '+n.type+'"></span> '+i(n.name),a+=' <span class="type '+o.type+'"></span> '+i(function(e){if(Array.isArray(e)){for(var t=[],a=0;a<e.length;a++)t.push(e[a].name);return t.join(",")}return e.name}(o))}return a+=(t=e.uuid,void 0===r.scripts[t]?"":' <span class="type Script"></span>')}t.setBorderTop("0"),t.setPaddingTop("20px");var a=!1,l=new UI.Outliner(r);function n(){var e=r.camera,t=r.scene,s=[];s.push(d(e,!1)),s.push(d(t,!1)),function e(t,a){for(var n=0,o=t.length;n<o;n++){var r=t[n],i=d(r,!0);i.style.paddingLeft=10*a+"px",s.push(i),e(r.children,a+1)}}(t.children,1),l.setOptions(s),null!==r.selected&&l.setValue(r.selected.id)}return l.setId("outliner"),l.onChange(function(){a=!0,r.selectById(parseInt(l.getValue())),a=!1}),l.onDblClick(function(){r.focusById(parseInt(l.getValue()))}),t.add(l),t.add(new UI.Break),n(),e.editorCleared.add(n),e.sceneGraphChanged.add(n),e.objectChanged.add(function(e){for(var t=l.options,a=0;a<t.length;a++){var n=t[a];if(n.value===e.id)return void(n.innerHTML=o(e))}}),e.objectSelected.add(function(e){!0!==a&&l.setValue(null!==e?e.id:null)}),t};var xtrad_pluginUrl="",xtrad_uploadUrl="";Sidebar.Project=function(u){var i=u.config,c=u.signals;xtrad_pluginUrl=xtradDirData.pluginurl,xtrad_uploadUrl=xtradDirData.uploadurl;var s={WebGLRenderer:XDTHREE.WebGLRenderer,SVGRenderer:XDTHREE.SVGRenderer,SoftwareRenderer:XDTHREE.SoftwareRenderer,RaytracingRenderer:XDTHREE.RaytracingRenderer},e=new UI.Panel;e.setBorderTop("0"),e.setPaddingTop("20px");var t=new UI.Row,a=new UI.Input(i.getKey("project/title")).setLeft("100px").onChange(function(){i.setKey("project/title",this.getValue())});t.add(new UI.Text("Title").setWidth("90px")),t.add(a),e.add(t);var n=new UI.Row,o=new UI.TextArea(i.getKey("project/description")).setLeft("100px").setWidth("160px").onChange(function(){i.setKey("project/description",this.getValue())});n.add(new UI.Text("Description").setWidth("90px")),n.add(o),e.add(n);var r=new UI.Row,d=new UI.Input(i.getKey("project/author")).setLeft("100px").onChange(function(){i.setKey("project/author",this.getValue())});r.add(new UI.Text("Author").setWidth("90px")),r.add(d),e.add(r);var l=new UI.Row,h=new UI.Input(i.getKey("project/date")).setLeft("100px").onChange(function(){i.setKey("project/date",this.getValue())});l.add(new UI.Text("Date").setWidth("90px")),l.add(h),e.add(l);var p=new UI.Row,m=(new UI.Texture).onChange(function(){var e=m.getValue();u.config.setKey("project/image",btoa(e.image.src)),u.config.setKey("project/imagetype","Manual")});p.add(new UI.Text("Image").setWidth("90px")),p.add(m),e.add(p);var g=new UI.Row,w=new UI.Button("Clear Image").setLeft("100px").setWidth("100px").onClick(function(){u.config.setKey("project/image",""),u.config.setKey("project/imagetype","Auto")});g.add(w),e.add(g);var f=new UI.HorizontalRule;e.add(f);var y=new UI.Row,E=new UI.Integer(u.heightRatio).setRange(5,500).onChange(function(){u.heightRatio=E.getValue();var e=0===u.container.clientWidth?u.container.parentNode.clientWidth:u.container.clientWidth,t=0<e?(e-300)*(u.heightRatio/100):0;u.container.style.height=Math.round(t)+"px",u.signals.windowResize.dispatch()});y.add(new UI.Text("Height Ratio %").setWidth("110px")),y.add(E),e.add(y);var v=new UI.Row;v.setClass("option");var b=new UI.RadioButtonList("cameraanimation").onChange(U);b.setOptions({None:"None",Rotate:"Rotate",Oscillate:"Oscillate"}),b.setValue(i.getKey("project/camera/animation")),v.add(new UI.Text("Camera Animation").setWidth("150px")),v.add(b),e.add(v);var R=new UI.Row;R.setClass("option");var x=new UI.Number(i.getKey("project/camera/animationSpeed")).setRange(0,10).onChange(U);R.add(new UI.Text("Animation Speed").setWidth("150px")),R.add(x),e.add(R);var T=new UI.Row;T.setClass("option");var C=new UI.Number(i.getKey("project/camera/animationOscillationAngle")).setRange(0,360).onChange(U);T.add(new UI.Text("Oscillation Angle").setWidth("150px")),T.add(C),e.add(T);var D=new UI.Row;D.setClass("option");var I=new UI.Number(i.getKey("project/camera/animationStartAngle")).setRange(-180,180).onChange(U);function U(){var e=b.getValue();i.setKey("project/camera/animation",e);var t=x.getValue();i.setKey("project/camera/animationSpeed",t);var a=I.getValue();i.setKey("project/camera/animationStartAngle",a);var n=C.getValue();switch(i.setKey("project/camera/animationOscillationAngle",n),e){case"None":u.execute(new RemoveScriptByNameCommand(u.scene,"camani")),u.signals.sceneGraphChanged.dispatch();break;case"Rotate":var o="var radius = camera.position.z;\n";o+="var first = true;\n",o+="var startTime = 0;\n",o+="var startAngle = "+a+";\n",o+="function update( event ) {\n",o+="if(first){first=false;\nstartTime=event.time;\n}\n",o+="var time = (event.time - startTime) * 0.01 * "+t+";\n",o+="var angle = (time % 360) + startAngle;\n",o+="var radians = angle * (3.14159 / 180);\n",o+="camera.position.x = radius * Math.sin(radians);\n",o+="camera.position.z = radius * Math.cos(radians);\n;",o+="camera.lookAt( new XDTHREE.Vector3() );\n";var r={name:"camani",source:o+="}\n"};u.execute(new RemoveScriptByNameCommand(u.scene,"camani")),u.execute(new AddScriptCommand(u.scene,r)),u.signals.sceneGraphChanged.dispatch();break;case"Oscillate":o="var radius = camera.position.z;\n";o+="var first = true;\n",o+="var startTime = 0;\n",o+="var previousAngle = 0;\n",o+="var realAngle = 0;\n",o+="var direction = 0;\n",o+="var startAngle = "+a+";\n",o+="function update( event ) {\n",o+="if(first){\n",o+="first=false;\n",o+="startTime=event.time;\n",o+="}\n",o+="var time = (event.time - startTime) * 0.01 * "+t+";\n",o+="var angle = (time % 360) + startAngle;\n",o+="var deltaAngle = angle - previousAngle;\n",o+="previousAngle = angle;\n",o+="if(Math.abs(realAngle) > "+n+") {\n",o+="direction = direction === 0 ? 1 : 0;\n",o+="realAngle = direction === 0 ? "+-n+" : "+n+";\n",o+="}\n",o+="realAngle = direction === 0 ? realAngle + deltaAngle : realAngle - deltaAngle;\n",o+="var radians = realAngle * (3.14159 / 180);\n",o+="camera.position.x = radius * Math.sin(radians);\n",o+="camera.position.z = radius * Math.cos(radians);\n;",o+="camera.lookAt( new XDTHREE.Vector3() );\n";r={name:"camani",source:o+="}\n"};u.execute(new RemoveScriptByNameCommand(u.scene,"camani")),u.execute(new AddScriptCommand(u.scene,r)),u.signals.sceneGraphChanged.dispatch()}}D.add(new UI.Text("Start Angle").setWidth("150px")),D.add(I),e.add(D);var V=new UI.HorizontalRule;e.add(V);var S=new UI.Panel,M=null,X=null,H=null,k=null,j=null,L=null,O=null,N=null,P=null,W=null,A=null,B=null,G=null,F=null,_=null,z=null,J=null,Y=null,K=null,Z=null,Q=null,q=null,$=null,ee=null,te=null,ae=null,ne=null,oe=null,re=null,ie=null,se=null,de=null,le=null,ue=null,ce=null,he=null,pe=null,me=null,ge=null,we=null,fe=null,ye=null,Ee=(p=null,null),ve=null,be=null,Re="",xe=null,Te="",Ce=null,De=0,Ie=null,Ue=0,Ve=null,Se=0,Me=null,Xe=0,He=null,ke=0,je=null,Le=0,Oe=null,Ne=0,Pe=null,We=null,Ae=null,Be=null,Ge=null,Fe=100,_e=-100,ze={},Je=null,Ye=null,Ke=null,Ze=window.location.href,Qe=Ze.indexOf("/wp-admin"),qe=Ze.substring(0,Qe)+"/wp-admin/admin-ajax.php";function $e(){var e=new XTRADVIEWER.Background("editor");switch(k.getValue()){case"None":break;case"Colour":var t=O.getValue();e.createColorBackground(t);break;case"Image":var a=ve.getValue();if(null!=a){var n={};n.wrapS=Re.getValue(),n.wrapT=Te.getValue(),n.offsetU=De.getValue(),n.offsetV=Ue.getValue(),n.repeatU=Se.getValue(),n.repeatV=Xe.getValue(),n.rotation=ke.getValue(),n.centreU=Le.getValue(),n.centreV=Ne.getValue(),e.createImageBackground(a,n)}break;case"Shader":var o=Ge.getValue(),r=Fe.getValue(),i=_e.getValue();e.createShaderBackground(u,o,r,i);break;case"Gradient":e.createGradientBackground(z.getValue(),B.getValue(),G.getValue(),F.getValue(),_.getValue(),J.getValue(),Y.getValue());break;case"Checkered":e.createCheckeredBackground(Q.getValue(),$.getValue(),ee.getValue(),le.getValue(),ue.getValue(),ce.getValue(),he.getValue(),pe.getValue(),me.getValue(),ge.getValue(),we.getValue(),fe.getValue(),ye.getValue(),te.getValue(),ae.getValue(),ne.getValue());break;case"SkyBox":var s=xtrad_uploadUrl+"/xtrad-library/skyboxes/"+Ke.getValue()+"/"+Ke.getValue()+"-",d=".jpg",l=[s+"px"+d,s+"nx"+d,s+"py"+d,s+"ny"+d,s+"pz"+d,s+"nz"+d];(new XDTHREE.CubeTextureLoader).load(l,!0,function(t){t.format=XDTHREE.RGBFormat,u.scene.traverse(function(e){e.isMesh&&u.execute(new SetMaterialMapCommand(e,"envMap",t,0))}),c.sceneBackgroundChanged.dispatch(t),c.sceneGraphChanged.dispatch()})}"SkyBox"!==k.getValue()&&c.sceneBackgroundChanged.dispatch(e)}function et(){var e=u.scene;if(a.setValue(u.config.getKey("project/title")),o.setValue(u.config.getKey("project/description")),d.setValue(u.config.getKey("project/author")),h.setValue(u.config.getKey("project/date")),b.setValue(u.config.getKey("project/camera/animation")),x.setValue(u.config.getKey("project/camera/animationSpeed")),I.setValue(u.config.getKey("project/camera/animationStartAngle")),C.setValue(u.config.getKey("project/camera/animationOscillationAngle")),null!=k)switch(e.background.backgroundType){case"color":k.setValue("Colour"),O.setValue("#"+e.background.backgroundObject.getHexString()),L.dom.style.display="block",Ee.dom.style.display="none",Be.dom.style.display="none",P.dom.style.display="none",Z.dom.style.display="none",Je.dom.style.display="none";break;case"image":k.setValue("Image"),Ee.dom.style.display="block",L.dom.style.display="none",Be.dom.style.display="none",P.dom.style.display="none",Z.dom.style.display="none",Je.dom.style.display="none";break;case"shader":k.setValue("Shader"),Fe.setValue(e.background.shadeSize),_e.setValue(e.background.shadeZPos),Ee.dom.style.display="none",L.dom.style.display="none",Be.dom.style.display="block",P.dom.style.display="none",Z.dom.style.display="none",Je.dom.style.display="none";break;case"gradient":switch(k.setValue("Gradient"),Ee.dom.style.display="none",L.dom.style.display="none",Be.dom.style.display="none",P.dom.style.display="block",Z.dom.style.display="none",k.setValue("Gradient"),z.setValue(e.background.backgroundObject.type),B.setValue(e.background.backgroundObject.colour1),G.setValue(e.background.backgroundObject.colour2),J.setValue(e.background.backgroundObject.varyColour),Y.setValue(e.background.backgroundObject.varyColourRate),e.background.backgroundObject.type){case"Linear":W.dom.style.display="block",A.dom.style.display="none",F.setValue(e.background.backgroundObject.angle);break;case"Radial":W.dom.style.display="none",A.dom.style.display="block",_.setValue(e.background.backgroundObject.innerRadius)}Je.dom.style.display="none";break;case"checkered":switch(k.setValue("Checkered"),Ee.dom.style.display="none",L.dom.style.display="none",Be.dom.style.display="none",P.dom.style.display="none",Z.dom.style.display="block",te.setValue(e.background.backgroundObject.noInX),ae.setValue(e.background.backgroundObject.varyColour),ne.setValue(e.background.backgroundObject.varyColourRate),e.background.backgroundObject.type){case"Solid":Q.setValue("Solid"),q.dom.style.display="block",oe.dom.style.display="none",$.setValue(e.background.backgroundObject.solidColour1),ee.setValue(e.background.backgroundObject.solidColour2);break;case"Gradient":switch(Q.setValue("Gradient"),q.dom.style.display="none",oe.dom.style.display="block",le.setValue(e.background.backgroundObject.gradient1.type),e.background.backgroundObject.gradient1.type){case"Linear":re.dom.style.display="block",se.dom.style.display="none",he.setValue(e.background.backgroundObject.gradient1.angle);break;case"Radial":re.dom.style.display="none",se.dom.style.display="block",pe.setValue(e.background.backgroundObject.gradient1.innerRadius)}switch(ue.setValue(e.background.backgroundObject.gradient1.colour1),ce.setValue(e.background.backgroundObject.gradient1.colour2),me.setValue(e.background.backgroundObject.gradient2.type),e.background.backgroundObject.gradient2.type){case"Linear":ie.dom.style.display="block",de.dom.style.display="none",fe.setValue(e.background.backgroundObject.gradient2.angle);break;case"Radial":ie.dom.style.display="none",de.dom.style.display="block",ye.setValue(e.background.backgroundObject.gradient2.innerRadius)}ge.setValue(e.background.backgroundObject.gradient2.colour1),we.setValue(e.background.backgroundObject.gradient2.colour2)}Je.dom.style.display="none";break;case"cube":k.setValue("SkyBox"),L.dom.style.display="none",Ee.dom.style.display="none",Be.dom.style.display="none",P.dom.style.display="none",Z.dom.style.display="none",Je.dom.style.display="block";break;default:k.setValue("None"),L.dom.style.display="none",Ee.dom.style.display="none",Be.dom.style.display="none",P.dom.style.display="none",Z.dom.style.display="none",Je.dom.style.display="none"}E.setValue(u.heightRatio),e.fog?(it.setHexValue(e.fog.color.getHex()),e.fog instanceof XDTHREE.Fog?(ot.setValue("Fog"),st.setValue(e.fog.near),dt.setValue(e.fog.far)):e.fog instanceof XDTHREE.FogExp2&&(ot.setValue("FogExp2"),lt.setValue(e.fog.density))):ot.setValue("None"),ut(),c.sceneBackgroundChanged.dispatch(u.scene.background)}jQuery.post(qe,{action:"list_files"},function(e){var t=JSON.parse(e);t.videos,M=t.shaders,X=t.skyboxes,(H=new UI.Row).setClass("option"),(k=new UI.RadioButtonList("background").onChange(function(){switch(k.getValue()){case"Colour":L.dom.style.display="block",Ee.dom.style.display="none",Be.dom.style.display="none",P.dom.style.display="none",Z.dom.style.display="none",Je.dom.style.display="none";break;case"None":L.dom.style.display="none",Ee.dom.style.display="none",Be.dom.style.display="none",P.dom.style.display="none",Z.dom.style.display="none",Je.dom.style.display="none";break;case"Image":Ee.dom.style.display="block",L.dom.style.display="none",Be.dom.style.display="none",P.dom.style.display="none",Z.dom.style.display="none",Je.dom.style.display="none";break;case"Shader":Ee.dom.style.display="none",L.dom.style.display="none",Be.dom.style.display="block",P.dom.style.display="none",Z.dom.style.display="none",Je.dom.style.display="none";break;case"Gradient":Ee.dom.style.display="none",L.dom.style.display="none",Be.dom.style.display="none",P.dom.style.display="block",Z.dom.style.display="none",Je.dom.style.display="none";break;case"Checkered":Ee.dom.style.display="none",L.dom.style.display="none",Be.dom.style.display="none",P.dom.style.display="none",Z.dom.style.display="block",Je.dom.style.display="none";break;case"SkyBox":Ee.dom.style.display="none",L.dom.style.display="none",Be.dom.style.display="none",P.dom.style.display="none",Z.dom.style.display="none",Je.dom.style.display="block"}$e()})).setOptions({Colour:"Colour",None:"None",Image:"Image",Shader:"Shader",Checkered:"Checkered",Gradient:"Gradient",SkyBox:"SkyBox"}),H.add(new UI.Text("Background").setWidth("90px")),H.add(k),S.add(H),(j=new UI.Row).setClass("option"),(L=new UI.Div).dom.style.display="block",O=(new UI.Color).setValue("#000000").onChange($e),L.add(new UI.Text("Background").setWidth("90px")),L.add(O),j.add(L),S.add(j),(N=new UI.Row).setClass("option"),(P=new UI.Div).dom.style.display="none",(z=new UI.RadioButtonList("gradienttype").onChange(function(){switch(z.getValue()){case"Linear":W.dom.style.display="block",A.dom.style.display="none";break;case"Radial":W.dom.style.display="none",A.dom.style.display="block"}$e()})).setOptions({Linear:"linear",Radial:"Radial"}),z.setValue("Linear"),P.add(z),B=(new UI.Color).setValue("#ffffff").onChange($e),G=(new UI.Color).setValue("#000000").onChange($e),F=new UI.Integer(90).setRange(0,360).onChange($e),_=new UI.Integer(10).setRange(0,500).onChange($e),J=new UI.Checkbox(!1).onChange($e),Y=new UI.Number(.5).setRange(0,20).onChange($e),P.add(new UI.Text("Type").setWidth("90px")),P.add(z),P.add(new UI.Break),P.add(new UI.Text("Colour 1").setWidth("90px")),P.add(B),P.add(new UI.Break),P.add(new UI.Text("Colour 2").setWidth("90px")),P.add(G),P.add(new UI.Break),(W=new UI.Div).dom.style.display="block",W.add(new UI.Text("Angle").setWidth("90px")),W.add(F),P.add(W),(A=new UI.Div).dom.style.display="none",A.add(new UI.Text("Radius").setWidth("90px")),A.add(_),P.add(A),P.add(new UI.Break),P.add(new UI.Text("Vary").setWidth("90px")),P.add(J),P.add(new UI.Break),P.add(new UI.Text("Rate/Change").setWidth("90px")),P.add(Y),P.add(new UI.Break),N.add(P),S.add(N),(K=new UI.Row).setClass("option"),(Z=new UI.Div).dom.style.display="none",(Q=new UI.RadioButtonList("checkeredtype").onChange(function(){switch(Q.getValue()){case"Solid":q.dom.style.display="block",oe.dom.style.display="none";break;case"Gradient":q.dom.style.display="none",oe.dom.style.display="block"}$e()})).setOptions({Solid:"Solid",Gradient:"Gradient"}),Q.setValue("Solid"),Z.add(Q),te=new UI.Integer(10).setRange(1,100).onChange($e),Z.add(new UI.Text("No In X").setWidth("90px")),Z.add(te),(q=new UI.Div).dom.style.display="block",$=(new UI.Color).setValue("#000000").onChange($e),ee=(new UI.Color).setValue("#ffffff").onChange($e),q.add(new UI.Text("Colour 1").setWidth("90px")),q.add($),q.add(new UI.Break),q.add(new UI.Text("Colour 2").setWidth("90px")),q.add(ee),Z.add(q),(oe=new UI.Div).dom.style.display="none",(le=new UI.RadioButtonList("checkeredgradient1type").onChange(function(){switch(le.getValue()){case"Linear":re.dom.style.display="block",se.dom.style.display="none";break;case"Gradient":re.dom.style.display="none",se.dom.style.display="block"}$e()})).setOptions({Linear:"linear",Radial:"Radial"}),le.setValue("Linear"),oe.add(le),ue=(new UI.Color).setValue("#ffffff").onChange($e),ce=(new UI.Color).setValue("#000000").onChange($e),he=new UI.Integer(90).setRange(0,360).onChange($e),pe=new UI.Integer(10).setRange(0,500).onChange($e),oe.add(new UI.Text("G1 Col 1").setWidth("90px")),oe.add(ue),oe.add(new UI.Break),oe.add(new UI.Text("G1 Col 2").setWidth("90px")),oe.add(ce),oe.add(new UI.Break),(re=new UI.Div).dom.style.display="block",re.add(new UI.Text("G1 Angle").setWidth("90px")),re.add(he),oe.add(re),(se=new UI.Div).dom.style.display="none",se.add(new UI.Text("G1 Radius").setWidth("90px")),se.add(pe),oe.add(se),(me=new UI.RadioButtonList("checkeredgradient2type").onChange(function(){switch(me.getValue()){case"Linear":ie.dom.style.display="block",de.dom.style.display="none";break;case"Gradient":ie.dom.style.display="none",de.dom.style.display="block"}$e()})).setOptions({Linear:"linear",Radial:"Radial"}),me.setValue("Linear"),oe.add(me),ge=(new UI.Color).setValue("#ffffff").onChange($e),we=(new UI.Color).setValue("#000000").onChange($e),fe=new UI.Integer(270).setRange(0,360).onChange($e),ye=new UI.Integer(10).setRange(0,500).onChange($e),oe.add(new UI.Text("G2 Col 1").setWidth("90px")),oe.add(ge),oe.add(new UI.Break),oe.add(new UI.Text("G2 Col 2").setWidth("90px")),oe.add(we),oe.add(new UI.Break),(ie=new UI.Div).dom.style.display="block",ie.add(new UI.Text("G2 Angle").setWidth("90px")),ie.add(fe),oe.add(ie),(de=new UI.Div).dom.style.display="none",de.add(new UI.Text("G2 Radius").setWidth("90px")),de.add(pe),oe.add(de),Z.add(oe),ae=new UI.Checkbox(!1).onChange($e),ne=new UI.Number(.5).setRange(0,20).onChange($e),Z.add(new UI.Break),Z.add(new UI.Text("Vary").setWidth("90px")),Z.add(ae),Z.add(new UI.Break),Z.add(new UI.Text("Rate/Change").setWidth("90px")),Z.add(ne),Z.add(new UI.Break),K.add(Z),S.add(K),p=new UI.Row,(Ee=new UI.Div).dom.style.display="none",p.add(Ee),ve=(new UI.Texture).onChange($e),Ee.add(new UI.Text("Image").setWidth("90px")),Ee.add(ve);var a=new UI.Break;Ee.add(a),S.add(p),be=new UI.Row,(Re=(new UI.Select).setOptions({1e3:"Repeat",1001:"ClampToEdge",1002:"MirroredRepeat"}).setWidth("150px").setFontSize("12px").onChange($e)).setValue(1e3),be.add(new UI.Text("Wrap S").setWidth("90px")),be.add(Re),Ee.add(be),xe=new UI.Row,(Te=(new UI.Select).setOptions({1e3:"Repeat",1001:"ClampToEdge",1002:"MirroredRepeat"}).setWidth("150px").setFontSize("12px").onChange($e)).setValue(1e3),xe.add(new UI.Text("Wrap T").setWidth("90px")),xe.add(Te),Ee.add(xe),Ce=new UI.Row,De=new UI.Number(0).setRange(0,1).onChange($e),Ce.add(new UI.Text("Offset X").setWidth("90px")),Ce.add(De),Ee.add(Ce),Ie=new UI.Row,Ue=new UI.Number(0).setRange(0,1).onChange($e),Ie.add(new UI.Text("Offset Y").setWidth("90px")),Ie.add(Ue),Ee.add(Ie),Ve=new UI.Row,Se=new UI.Number(1).setRange(-25,25).onChange($e),Ve.add(new UI.Text("Repeat X").setWidth("90px")),Ve.add(Se),Ee.add(Ve),Me=new UI.Row,Xe=new UI.Number(1).setRange(-25,25).onChange($e),Me.add(new UI.Text("Repeat Y").setWidth("90px")),Me.add(Xe),Ee.add(Me),He=new UI.Row,ke=new UI.Number(0).setRange(0,360).onChange($e),He.add(new UI.Text("Rotation").setWidth("90px")),He.add(ke),Ee.add(He),je=new UI.Row,Le=new UI.Number(.5).setRange(0,1).onChange($e),je.add(new UI.Text("Centre X").setWidth("90px")),je.add(Le),Ee.add(je),Oe=new UI.Row,Ne=new UI.Number(.5).setRange(0,1).onChange($e),Oe.add(new UI.Text("Centre Y").setWidth("90px")),Oe.add(Ne),Ee.add(Oe),(Be=new UI.Div).dom.style.display="none",Pe=new UI.Row,Be.add(Pe),Ge=(new UI.Select).onChange($e),ze={};for(var n=0;n<M.length;n++){var o=M[n];ze[o]=o}Ge.setOptions(ze),0<M.length&&Ge.setValue(M[0]),Pe.add(Ge),Pe.add(new UI.Text("Colour").setWidth("90px")),We=new UI.Row,Be.add(We),Fe=new UI.Number(100).setRange(0,2e3).setWidth("120px").onChange($e),We.add(new UI.Text("Size").setWidth("90px")),We.add(Fe),Ae=new UI.Row,Be.add(Ae),_e=new UI.Number(-100).setRange(-2e3,2e3).setWidth("120px").onChange($e),Ae.add(new UI.Text("Z Pos").setWidth("90px")),Ae.add(_e),S.add(Be),(Je=new UI.Div).dom.style.display="none",(Ye=new UI.Row).setClass("option"),Ke=new UI.Select("select");var r={};for(n=0;n<X.length;n++){r[o=X[n]]=o}Ke.setOptions(r),0<X.length&&Ke.setValue(X[0]),Ye.add(new UI.Text("File").setWidth("90px")),Ye.add(Ke);var i=new UI.Button("Apply").onClick(function(){$e()});switch(Ye.add(i),Je.add(Ye),S.add(Je),u.scene.background.backgroundType){case"color":k.setValue("Colour"),O.setValue(u.scene.background.backgroundObject.getHexString());break;case"image":k.setValue("Image"),Re.setValue(u.scene.background.backgroundObject.material.wrapS),Te.setValue(u.scene.background.backgroundObject.material.wrapT),De.setValue(u.scene.background.backgroundObject.material.offsetX),Ue.setValue(u.scene.background.backgroundObject.material.offsetY),Se.setValue(u.scene.background.backgroundObject.material.repeatU),Xe.setValue(u.scene.background.backgroundObject.material.repeatV),ke.setValue(u.scene.background.backgroundObject.material.rotation),Le.setValue(u.scene.background.backgroundObject.material.centerX),Ne.setValue(u.scene.background.backgroundObject.material.centerY);case"shader":k.setValue("Shader"),Fe.setValue(u.scene.background.shadeSize),_e.setValue(u.scene.background.shadeZPos);break;case"gradient":switch(k.setValue("Gradient"),z.setValue(u.scene.background.backgroundObject.type),B.setValue(u.scene.background.backgroundObject.colour1),G.setValue(u.scene.background.backgroundObject.colour2),J.setValue(u.scene.background.backgroundObject.varyColour),Y.setValue(u.scene.background.backgroundObject.varyColourRate),u.scene.background.backgroundObject.type){case"Linear":W.dom.style.display="block",A.dom.style.display="none",F.setValue(u.scene.background.backgroundObject.angle);break;case"Radial":W.dom.style.display="none",A.dom.style.display="block",_.setValue(u.scene.background.backgroundObject.innerRadius)}break;case"checkered":switch(k.setValue("Checkered"),te.setValue(u.scene.background.backgroundObject.noInX),ae.setValue(u.scene.background.backgroundObject.varyColour),ne.setValue(u.scene.background.backgroundObject.varyColourRate),u.scene.background.backgroundObject.type){case"Solid":Q.setValue("Solid"),q.dom.style.display="block",oe.dom.style.display="none",$.setValue(u.scene.background.backgroundObject.solidColour1),ee.setValue(u.scene.background.backgroundObject.solidColour2);break;case"Gradient":switch(Q.setValue("Gradient"),q.dom.style.display="none",oe.dom.style.display="block",le.setValue(u.scene.background.backgroundObject.gradient1.type),u.scene.background.backgroundObject.gradient1.type){case"Linear":re.dom.style.display="block",se.dom.style.display="none",he.setValue(u.scene.background.backgroundObject.gradient1.angle);break;case"Radial":re.dom.style.display="none",se.dom.style.display="block",pe.setValue(u.scene.background.backgroundObject.gradient1.innerRadius)}switch(ue.setValue(u.scene.background.backgroundObject.gradient1.colour1),ce.setValue(u.scene.background.backgroundObject.gradient1.colour2),me.setValue(u.scene.background.backgroundObject.gradient2.type),u.scene.background.backgroundObject.gradient2.type){case"Linear":ie.dom.style.display="block",de.dom.style.display="none",fe.setValue(u.scene.background.backgroundObject.gradient2.angle);break;case"Radial":ie.dom.style.display="none",de.dom.style.display="block",ye.setValue(u.scene.background.backgroundObject.gradient2.innerRadius)}ge.setValue(u.scene.scene.background.backgroundObject.gradient2.colour1),we.setValue(u.scene.background.backgroundObject.gradient2.colour2)}break;case"cube":k.setValue("SkyBox");break;default:k.setValue("None")}}),e.add(S);var tt=new UI.HorizontalRule;function at(){c.sceneFogChanged.dispatch(ot.getValue(),it.getHexValue(),st.getValue(),dt.getValue(),lt.getValue())}e.add(tt);var nt=new UI.Row,ot=(new UI.Select).setOptions({None:"None",Fog:"Linear",FogExp2:"Exponential"}).setWidth("150px");ot.onChange(function(){at(),ut()}),nt.add(new UI.Text("Fog").setWidth("90px")),nt.add(ot),e.add(nt);var rt=new UI.Row;rt.setDisplay("none"),rt.setMarginLeft("90px"),e.add(rt);var it=(new UI.Color).setValue("#aaaaaa");it.onChange(at),rt.add(it);var st=new UI.Number(.1).setWidth("40px").setRange(0,1/0).onChange(at);rt.add(st);var dt=new UI.Number(50).setWidth("40px").setRange(0,1/0).onChange(at);rt.add(dt);var lt=new UI.Number(.05).setWidth("40px").setRange(0,.1).setPrecision(3).onChange(at);function ut(){var e=ot.getValue();rt.setDisplay("None"===e?"none":""),st.setDisplay("Fog"===e?"":"none"),dt.setDisplay("Fog"===e?"":"none"),lt.setDisplay("FogExp2"===e?"":"none")}rt.add(lt);var ct=new UI.HorizontalRule;e.add(ct);var ht={};for(var pt in s)0<=pt.indexOf("WebGL")&&!1===System.support.webgl||(ht[pt]=pt);var mt=new UI.Row,gt=new UI.Text("WebGLRenderer").setWidth("150px");mt.add(new UI.Text("Renderer").setWidth("90px")),mt.add(gt),e.add(mt),void 0!==i.getKey("project/renderer")&&gt.setValue(i.getKey("project/renderer"));var wt=new UI.Row,ft=new UI.XDTHREE.Boolean(i.getKey("project/renderer/antialias"),"antialias").onChange(function(){i.setKey("project/renderer/antialias",this.getValue()),Et()});wt.add(ft);var yt=new UI.XDTHREE.Boolean(i.getKey("project/renderer/shadows"),"shadows").onChange(function(){i.setKey("project/renderer/shadows",this.getValue()),Et()});function Et(){vt(gt.getValue(),ft.getValue(),!0,!0,!0)}function vt(e,t,a,n,o){wt.setDisplay("WebGLRenderer"===e?"":"none");var r=new s[e]({antialias:t,preserveDrawingBuffer:!1});r.setPixelRatio(window.devicePixelRatio),r.gammaInput=n,r.gammaOutput=o,a&&r.shadowMap&&(r.shadowMap.enabled=!0),c.rendererChanged.dispatch(r)}return wt.add(yt),e.add(wt),vt(i.getKey("project/renderer"),i.getKey("project/renderer/antialias"),!0,!0,!0),u.signals.editorCleared.add(et),u.signals.sceneGraphChanged.add(et),e},Sidebar.Settings=function(t){t.config,t.signals;var e=new UI.Panel;e.setBorderTop("0"),e.setPaddingTop("20px"),e.setPaddingBottom("20px");var a=new UI.Row,n=new UI.Checkbox("Advanced"===t.config.getKey("project/simpleAdvancedMode")).onChange(function(){var e=n.getValue();t.config.setKey("project/simpleAdvancedMode",e?"Advanced":"Simple"),t.signals.materialChanged.dispatch()});return a.add(new UI.Text("Edit Mode - Advanced").setWidth("160px")),a.add(n),e.add(a),t.signals.editorCleared.add(function(){n.setValue("Advanced"===t.config.getKey("project/simpleAdvancedMode"))}),e.add(new Sidebar.Settings.Shortcuts(t)),e.add(new Sidebar.Settings.Viewport(t)),e},Sidebar.Properties=function(e){e.signals;var t=new UI.Span,a=new UI.Text("OBJECT").onClick(i),n=new UI.Text("GEOMETRY").onClick(i),o=new UI.Text("MATERIAL").onClick(i),r=new UI.Div;function i(e){u(e.target.textContent)}r.setId("tabs"),r.add(a,n,o),t.add(r);var s=(new UI.Span).add(new Sidebar.Object(e));t.add(s);var d=(new UI.Span).add(new Sidebar.Geometry(e));t.add(d);var l=(new UI.Span).add(new Sidebar.Material(e));function u(e){switch(a.setClass(""),n.setClass(""),o.setClass(""),s.setDisplay("none"),d.setDisplay("none"),l.setDisplay("none"),e){case"OBJECT":a.setClass("selected"),s.setDisplay("");break;case"GEOMETRY":n.setClass("selected"),d.setDisplay("");break;case"MATERIAL":o.setClass("selected"),l.setDisplay("")}}return t.add(l),u("OBJECT"),t},Sidebar.Object=function(o){var e=o.signals,t=new UI.Panel;t.setBorderTop("0"),t.setPaddingTop("20px"),t.setDisplay("none");var a=new UI.Row,n=new UI.Text;a.add(new UI.Text("Type").setWidth("90px")),a.add(n),t.add(a);var r=new UI.Row,i=(new UI.Input).setWidth("150px").setFontSize("12px").onChange(function(){(o.execute(new SetValueCommand(o.selected,"name",i.getValue())),"Scene"===o.selected.type)&&(document.getElementById("scene-name").value=i.getValue())});r.add(new UI.Text("Name").setWidth("90px")),r.add(i),t.add(r);var s=new UI.Row,d=(new UI.Number).setWidth("50px").onChange(z),l=(new UI.Number).setWidth("50px").onChange(z),u=(new UI.Number).setWidth("50px").onChange(z);s.add(new UI.Text("Position").setWidth("90px")),s.add(d,l,u),t.add(s);var c=new UI.Row,h=(new UI.Number).setStep(10).setUnit("°").setWidth("50px").onChange(z),p=(new UI.Number).setStep(10).setUnit("°").setWidth("50px").onChange(z),m=(new UI.Number).setStep(10).setUnit("°").setWidth("50px").onChange(z);c.add(new UI.Text("Rotation").setWidth("90px")),c.add(h,p,m),t.add(c);var g=new UI.Row,w=new UI.Checkbox(!0).setPosition("absolute").setLeft("75px"),f=new UI.Number(1).setPrecision(3).setRange(.001,1/0).setWidth("50px").onChange(function(){var e=o.selected;if(!0===w.getValue()){var t=f.getValue()/e.scale.x;y.setValue(y.getValue()*t),E.setValue(E.getValue()*t)}z()}),y=new UI.Number(1).setPrecision(3).setRange(.001,1/0).setWidth("50px").onChange(function(){var e=o.selected;if(!0===w.getValue()){var t=y.getValue()/e.scale.y;f.setValue(f.getValue()*t),E.setValue(E.getValue()*t)}z()}),E=new UI.Number(1).setPrecision(3).setRange(.001,1/0).setWidth("50px").onChange(function(){var e=o.selected;if(!0===w.getValue()){var t=E.getValue()/e.scale.z;f.setValue(f.getValue()*t),y.setValue(y.getValue()*t)}z()});g.add(new UI.Text("Scale").setWidth("90px")),g.add(w),g.add(f,y,E),t.add(g);var v=new UI.Row,b=(new UI.Number).onChange(z);v.add(new UI.Text("Fov").setWidth("90px")),v.add(b),t.add(v);var R=new UI.Row,x=(new UI.Number).onChange(z);R.add(new UI.Text("Near").setWidth("90px")),R.add(x),t.add(R);var T=new UI.Row,C=(new UI.Number).onChange(z);T.add(new UI.Text("Far").setWidth("90px")),T.add(C),t.add(T);var D=new UI.Row,I=(new UI.Number).setRange(0,1/0).onChange(z);D.add(new UI.Text("Intensity").setWidth("90px")),D.add(I),t.add(D);var U=new UI.Row,V=(new UI.Color).onChange(z);U.add(new UI.Text("Color").setWidth("90px")),U.add(V),t.add(U);var S=new UI.Row,M=(new UI.Color).onChange(z);S.add(new UI.Text("Ground color").setWidth("90px")),S.add(M),t.add(S);var X=new UI.Row,H=(new UI.Number).setRange(0,1/0).onChange(z);X.add(new UI.Text("Distance").setWidth("90px")),X.add(H),t.add(X);var k=new UI.Row,j=(new UI.Number).setPrecision(3).setRange(0,Math.PI/2).onChange(z);k.add(new UI.Text("Angle").setWidth("90px")),k.add(j),t.add(k);var L=new UI.Row,O=(new UI.Number).setRange(0,1).onChange(z);L.add(new UI.Text("Penumbra").setWidth("90px")),L.add(O),t.add(L);var N=new UI.Row,P=(new UI.Number).setRange(0,1/0).onChange(z);N.add(new UI.Text("Decay").setWidth("90px")),N.add(P),t.add(N);var W=new UI.Row;W.add(new UI.Text("Shadow").setWidth("90px"));var A=new UI.XDTHREE.Boolean(!1,"cast").onChange(z);W.add(A);var B=new UI.XDTHREE.Boolean(!1,"receive").onChange(z);W.add(B);var G=new UI.Number(1).onChange(z);W.add(G),t.add(W);var F=new UI.Row,_=(new UI.Checkbox).onChange(z);function z(){var e=o.selected;if(null!==e){var t=new XDTHREE.Vector3(d.getValue(),l.getValue(),u.getValue());.01<=e.position.distanceTo(t)&&o.execute(new SetPositionCommand(e,t));var a=new XDTHREE.Euler(h.getValue()*XDTHREE.Math.DEG2RAD,p.getValue()*XDTHREE.Math.DEG2RAD,m.getValue()*XDTHREE.Math.DEG2RAD);.01<=e.rotation.toVector3().distanceTo(a.toVector3())&&o.execute(new SetRotationCommand(e,a));var n=new XDTHREE.Vector3(f.getValue(),y.getValue(),E.getValue());.01<=e.scale.distanceTo(n)&&o.execute(new SetScaleCommand(e,n)),void 0!==e.fov&&.01<=Math.abs(e.fov-b.getValue())&&(o.execute(new SetValueCommand(e,"fov",b.getValue())),e.updateProjectionMatrix()),void 0!==e.near&&.01<=Math.abs(e.near-x.getValue())&&o.execute(new SetValueCommand(e,"near",x.getValue())),void 0!==e.far&&.01<=Math.abs(e.far-C.getValue())&&o.execute(new SetValueCommand(e,"far",C.getValue())),void 0!==e.intensity&&.01<=Math.abs(e.intensity-I.getValue())&&o.execute(new SetValueCommand(e,"intensity",I.getValue())),void 0!==e.color&&e.color.getHex()!==V.getHexValue()&&o.execute(new SetColorCommand(e,"color",V.getHexValue())),void 0!==e.groundColor&&e.groundColor.getHex()!==M.getHexValue()&&o.execute(new SetColorCommand(e,"groundColor",M.getHexValue())),void 0!==e.distance&&.01<=Math.abs(e.distance-H.getValue())&&o.execute(new SetValueCommand(e,"distance",H.getValue())),void 0!==e.angle&&.01<=Math.abs(e.angle-j.getValue())&&o.execute(new SetValueCommand(e,"angle",j.getValue())),void 0!==e.penumbra&&.01<=Math.abs(e.penumbra-O.getValue())&&o.execute(new SetValueCommand(e,"penumbra",O.getValue())),void 0!==e.decay&&.01<=Math.abs(e.decay-P.getValue())&&o.execute(new SetValueCommand(e,"decay",P.getValue())),e.visible!==_.getValue()&&o.execute(new SetValueCommand(e,"visible",_.getValue())),void 0!==e.castShadow&&e.castShadow!==A.getValue()&&o.execute(new SetValueCommand(e,"castShadow",A.getValue())),void 0!==e.receiveShadow&&e.receiveShadow!==B.getValue()&&(null!=e.material&&(e.material.needsUpdate=!0),o.execute(new SetValueCommand(e,"receiveShadow",B.getValue()))),void 0!==e.shadow&&e.shadow.radius!==G.getValue()&&o.execute(new SetValueCommand(e.shadow,"radius",G.getValue()))}}function J(e){var t;n.setValue(e.type),i.setValue(e.name),d.setValue(e.position.x),l.setValue(e.position.y),u.setValue(e.position.z),h.setValue(e.rotation.x*XDTHREE.Math.RAD2DEG),p.setValue(e.rotation.y*XDTHREE.Math.RAD2DEG),m.setValue(e.rotation.z*XDTHREE.Math.RAD2DEG),f.setValue(e.scale.x),y.setValue(e.scale.y),E.setValue(e.scale.z),void 0!==e.fov&&b.setValue(e.fov),void 0!==e.near&&x.setValue(e.near),void 0!==e.far&&C.setValue(e.far),void 0!==e.intensity&&I.setValue(e.intensity),void 0!==e.color&&V.setHexValue(e.color.getHexString()),void 0!==e.groundColor&&M.setHexValue(e.groundColor.getHexString()),void 0!==e.distance&&H.setValue(e.distance),void 0!==e.angle&&j.setValue(e.angle),void 0!==e.penumbra&&O.setValue(e.penumbra),void 0!==e.decay&&P.setValue(e.decay),void 0!==e.castShadow&&A.setValue(e.castShadow),void 0!==e.receiveShadow&&B.setValue(e.receiveShadow),void 0!==e.shadow&&G.setValue(e.shadow.radius),_.setValue(e.visible),(t=e).isLight||t.isObject3D&&t.userData.targetInverse?(c.setDisplay("none"),g.setDisplay("none")):(c.setDisplay(""),g.setDisplay(""))}return F.add(new UI.Text("Visible").setWidth("90px")),F.add(_),t.add(F),e.objectSelected.add(function(e){null!==e?(t.setDisplay("block"),function(e){var t={fov:v,near:R,far:T,intensity:D,color:U,groundColor:S,distance:X,angle:k,penumbra:L,decay:N,castShadow:W,receiveShadow:B,shadow:G};for(var a in t)t[a].setDisplay(void 0!==e[a]?"":"none")}(e),J(e)):t.setDisplay("none")}),e.objectChanged.add(function(e){e===o.selected&&J(e)}),e.refreshSidebarObject3D.add(function(e){e===o.selected&&J(e)}),t},Sidebar.Geometry=function(a){var e=a.signals,n=new UI.Panel;n.setBorderTop("0"),n.setDisplay("none"),n.setPaddingTop("20px");var t=new UI.Row,o=new UI.Text;t.add(new UI.Text("Type").setWidth("90px")),t.add(o),n.add(t);var r=new UI.Row,i=(new UI.Input).setWidth("150px").setFontSize("12px").onChange(function(){a.execute(new SetGeometryValueCommand(a.selected,"name",i.getValue()))});r.add(new UI.Text("Name").setWidth("90px")),r.add(i),n.add(r);var s=new UI.Span;n.add(s),n.add(new Sidebar.Geometry.Geometry(a)),n.add(new Sidebar.Geometry.BufferGeometry(a));var d=new UI.Text;function l(){var e=a.selected;if(null!=e&&null!=e.name&&"XtraCharPivot"===e.name)n.setDisplay("block"),o.setValue("XtraCharPivot"),i.setValue(e.name),s.clear(),s.add(new Sidebar.Geometry.Characters(a,e));else if(e&&e.geometry){var t=e.geometry;n.setDisplay("block"),o.setValue(t.type),i.setValue(t.name),s.clear(),"BufferGeometry"===t.type||"Geometry"===t.type?s.add(new Sidebar.Geometry.Modifiers(a,e)):void 0!==Sidebar.Geometry[t.type]&&s.add(new Sidebar.Geometry[t.type](a,e)),null===t.boundingSphere&&t.computeBoundingSphere(),d.setValue(Math.floor(1e3*t.boundingSphere.radius)/1e3)}else n.setDisplay("none")}return n.add(new UI.Text("Bounds").setWidth("90px")),n.add(d),e.objectSelected.add(l),e.geometryChanged.add(l),n},Sidebar.Geometry.Geometry=function(e){var t=e.signals,a=new UI.Row,n=new UI.Row,o=new UI.Text;n.add(new UI.Text("Vertices").setWidth("90px")),n.add(o),a.add(n);var r=new UI.Row,i=new UI.Text;function s(e){if(null!=e){var t=e.geometry;t&&t.isGeometry?(a.setDisplay("block"),o.setValue(t.vertices.length.format()),i.setValue(t.faces.length.format())):a.setDisplay("none")}}return r.add(new UI.Text("Faces").setWidth("90px")),r.add(i),a.add(r),t.objectSelected.add(s),t.geometryChanged.add(s),a},Sidebar.Geometry.BufferGeometry=function(e){var t=e.signals,d=new UI.Row;function a(e){if(null!=e){var t=e.geometry;if(t&&t.isBufferGeometry){d.clear(),d.setDisplay("block");var a=new UI.Text("Attributes").setWidth("90px");d.add(a);var n=(new UI.Span).setDisplay("inline-block").setWidth("160px");d.add(n);var o=t.index;null!==o&&(n.add(new UI.Text("Index").setWidth("80px")),n.add(new UI.Text(o.count.format()).setFontSize("12px")),n.add(new UI.Break));var r=t.attributes;for(var i in r){var s=r[i];n.add(new UI.Text(i).setWidth("80px")),n.add(new UI.Text(s.count.format()+" ("+s.itemSize+")").setFontSize("12px")),n.add(new UI.Break)}}else d.setDisplay("none")}}return t.objectSelected.add(a),t.geometryChanged.add(a),d},Sidebar.Geometry.Modifiers=function(e,t){var a=e.signals,n=(new UI.Row).setPaddingLeft("90px"),o=t.geometry,r=new UI.Button("Compute Vertex Normals");return r.onClick(function(){o.computeVertexNormals(),o.isBufferGeometry?o.attributes.normal.needsUpdate=!0:o.normalsNeedUpdate=!0,a.geometryChanged.dispatch(t)}),n.add(r),n},Sidebar.Geometry.BoxGeometry=function(e,t){e.signals;var a=new UI.Row,n=t.geometry,o=n.parameters,r=new UI.Row,i=new UI.Number(o.width).onChange(f);r.add(new UI.Text("Width").setWidth("90px")),r.add(i),a.add(r);var s=new UI.Row,d=new UI.Number(o.height).onChange(f);s.add(new UI.Text("Height").setWidth("90px")),s.add(d),a.add(s);var l=new UI.Row,u=new UI.Number(o.depth).onChange(f);l.add(new UI.Text("Depth").setWidth("90px")),l.add(u),a.add(l);var c=new UI.Row,h=new UI.Integer(o.widthSegments).setRange(1,1/0).onChange(f);c.add(new UI.Text("Width segments").setWidth("90px")),c.add(h),a.add(c);var p=new UI.Row,m=new UI.Integer(o.heightSegments).setRange(1,1/0).onChange(f);p.add(new UI.Text("Height segments").setWidth("90px")),p.add(m),a.add(p);var g=new UI.Row,w=new UI.Integer(o.depthSegments).setRange(1,1/0).onChange(f);function f(){e.execute(new SetGeometryCommand(t,new XDTHREE[n.type](i.getValue(),d.getValue(),u.getValue(),h.getValue(),m.getValue(),w.getValue())))}return g.add(new UI.Text("Depth segments").setWidth("90px")),g.add(w),a.add(g),a},Sidebar.Geometry.BoxBufferGeometry=Sidebar.Geometry.BoxGeometry,Sidebar.Geometry.CircleGeometry=function(e,t){e.signals;var a=new UI.Row,n=t.geometry,o=n.parameters,r=new UI.Row,i=new UI.Number(o.radius).onChange(p);r.add(new UI.Text("Radius").setWidth("90px")),r.add(i),a.add(r);var s=new UI.Row,d=new UI.Integer(o.segments).setRange(3,1/0).onChange(p);s.add(new UI.Text("Segments").setWidth("90px")),s.add(d),a.add(s);var l=new UI.Row,u=new UI.Number(o.thetaStart*XDTHREE.Math.RAD2DEG).setStep(10).onChange(p);l.add(new UI.Text("Theta start").setWidth("90px")),l.add(u),a.add(l);var c=new UI.Row,h=new UI.Number(o.thetaLength*XDTHREE.Math.RAD2DEG).setStep(10).onChange(p);function p(){e.execute(new SetGeometryCommand(t,new XDTHREE[n.type](i.getValue(),d.getValue(),u.getValue()*XDTHREE.Math.DEG2RAD,h.getValue()*XDTHREE.Math.DEG2RAD)))}return c.add(new UI.Text("Theta length").setWidth("90px")),c.add(h),a.add(c),a},Sidebar.Geometry.CircleBufferGeometry=Sidebar.Geometry.CircleGeometry,Sidebar.Geometry.CylinderGeometry=function(e,t){e.signals;var a=new UI.Row,n=t.geometry,o=n.parameters,r=new UI.Row,i=new UI.Number(o.radiusTop).onChange(f);r.add(new UI.Text("Radius top").setWidth("90px")),r.add(i),a.add(r);var s=new UI.Row,d=new UI.Number(o.radiusBottom).onChange(f);s.add(new UI.Text("Radius bottom").setWidth("90px")),s.add(d),a.add(s);var l=new UI.Row,u=new UI.Number(o.height).onChange(f);l.add(new UI.Text("Height").setWidth("90px")),l.add(u),a.add(l);var c=new UI.Row,h=new UI.Integer(o.radialSegments).setRange(1,1/0).onChange(f);c.add(new UI.Text("Radial segments").setWidth("90px")),c.add(h),a.add(c);var p=new UI.Row,m=new UI.Integer(o.heightSegments).setRange(1,1/0).onChange(f);p.add(new UI.Text("Height segments").setWidth("90px")),p.add(m),a.add(p);var g=new UI.Row,w=new UI.Checkbox(o.openEnded).onChange(f);function f(){e.execute(new SetGeometryCommand(t,new XDTHREE[n.type](i.getValue(),d.getValue(),u.getValue(),h.getValue(),m.getValue(),w.getValue())))}return g.add(new UI.Text("Open ended").setWidth("90px")),g.add(w),a.add(g),a},Sidebar.Geometry.CylinderBufferGeometry=Sidebar.Geometry.CylinderGeometry,Sidebar.Geometry.IcosahedronGeometry=function(e,t){var a=e.signals,n=new UI.Row,o=t.geometry,r=o.parameters,i=new UI.Row,s=new UI.Number(r.radius).onChange(u);i.add(new UI.Text("Radius").setWidth("90px")),i.add(s),n.add(i);var d=new UI.Row,l=new UI.Integer(r.detail).setRange(0,1/0).onChange(u);function u(){e.execute(new SetGeometryCommand(t,new XDTHREE[o.type](s.getValue(),l.getValue()))),a.objectChanged.dispatch(t)}return d.add(new UI.Text("Detail").setWidth("90px")),d.add(l),n.add(d),n},Sidebar.Geometry.IcosahedronBufferGeometry=Sidebar.Geometry.IcosahedronGeometry,Sidebar.Geometry.PlaneGeometry=function(e,t){e.signals;var a=new UI.Row,n=t.geometry,o=n.parameters,r=new UI.Row,i=new UI.Number(o.width).onChange(p);r.add(new UI.Text("Width").setWidth("90px")),r.add(i),a.add(r);var s=new UI.Row,d=new UI.Number(o.height).onChange(p);s.add(new UI.Text("Height").setWidth("90px")),s.add(d),a.add(s);var l=new UI.Row,u=new UI.Integer(o.widthSegments).setRange(1,1/0).onChange(p);l.add(new UI.Text("Width segments").setWidth("90px")),l.add(u),a.add(l);var c=new UI.Row,h=new UI.Integer(o.heightSegments).setRange(1,1/0).onChange(p);function p(){e.execute(new SetGeometryCommand(t,new XDTHREE[n.type](i.getValue(),d.getValue(),u.getValue(),h.getValue())))}return c.add(new UI.Text("Height segments").setWidth("90px")),c.add(h),a.add(c),a},Sidebar.Geometry.PlaneBufferGeometry=Sidebar.Geometry.PlaneGeometry,Sidebar.Geometry.SphereGeometry=function(e,t){e.signals;var a=new UI.Row,n=t.geometry,o=n.parameters,r=new UI.Row,i=new UI.Number(o.radius).onChange(E);r.add(new UI.Text("Radius").setWidth("90px")),r.add(i),a.add(r);var s=new UI.Row,d=new UI.Integer(o.widthSegments).setRange(1,1/0).onChange(E);s.add(new UI.Text("Width segments").setWidth("90px")),s.add(d),a.add(s);var l=new UI.Row,u=new UI.Integer(o.heightSegments).setRange(1,1/0).onChange(E);l.add(new UI.Text("Height segments").setWidth("90px")),l.add(u),a.add(l);var c=new UI.Row,h=new UI.Number(o.phiStart*XDTHREE.Math.RAD2DEG).setStep(10).onChange(E);c.add(new UI.Text("Phi start").setWidth("90px")),c.add(h),a.add(c);var p=new UI.Row,m=new UI.Number(o.phiLength*XDTHREE.Math.RAD2DEG).setStep(10).onChange(E);p.add(new UI.Text("Phi length").setWidth("90px")),p.add(m),a.add(p);var g=new UI.Row,w=new UI.Number(o.thetaStart*XDTHREE.Math.RAD2DEG).setStep(10).onChange(E);g.add(new UI.Text("Theta start").setWidth("90px")),g.add(w),a.add(g);var f=new UI.Row,y=new UI.Number(o.thetaLength*XDTHREE.Math.RAD2DEG).setStep(10).onChange(E);function E(){e.execute(new SetGeometryCommand(t,new XDTHREE[n.type](i.getValue(),d.getValue(),u.getValue(),h.getValue()*XDTHREE.Math.DEG2RAD,m.getValue()*XDTHREE.Math.DEG2RAD,w.getValue()*XDTHREE.Math.DEG2RAD,y.getValue()*XDTHREE.Math.DEG2RAD)))}return f.add(new UI.Text("Theta length").setWidth("90px")),f.add(y),a.add(f),a},Sidebar.Geometry.SphereBufferGeometry=Sidebar.Geometry.SphereGeometry,Sidebar.Geometry.TorusGeometry=function(e,t){e.signals;var a=new UI.Row,n=t.geometry,o=n.parameters,r=new UI.Row,i=new UI.Number(o.radius).onChange(g);r.add(new UI.Text("Radius").setWidth("90px")),r.add(i),a.add(r);var s=new UI.Row,d=new UI.Number(o.tube).onChange(g);s.add(new UI.Text("Tube").setWidth("90px")),s.add(d),a.add(s);var l=new UI.Row,u=new UI.Integer(o.radialSegments).setRange(1,1/0).onChange(g);l.add(new UI.Text("Radial segments").setWidth("90px")),l.add(u),a.add(l);var c=new UI.Row,h=new UI.Integer(o.tubularSegments).setRange(1,1/0).onChange(g);c.add(new UI.Text("Tubular segments").setWidth("90px")),c.add(h),a.add(c);var p=new UI.Row,m=new UI.Number(o.arc*XDTHREE.Math.RAD2DEG).setStep(10).onChange(g);function g(){e.execute(new SetGeometryCommand(t,new XDTHREE[n.type](i.getValue(),d.getValue(),u.getValue(),h.getValue(),m.getValue()*XDTHREE.Math.DEG2RAD)))}return p.add(new UI.Text("Arc").setWidth("90px")),p.add(m),a.add(p),a},Sidebar.Geometry.TorusBufferGeometry=Sidebar.Geometry.TorusGeometry,Sidebar.Geometry.TorusKnotGeometry=function(e,t){e.signals;var a=new UI.Row,n=t.geometry,o=n.parameters,r=new UI.Row,i=new UI.Number(o.radius).onChange(f);r.add(new UI.Text("Radius").setWidth("90px")),r.add(i),a.add(r);var s=new UI.Row,d=new UI.Number(o.tube).onChange(f);s.add(new UI.Text("Tube").setWidth("90px")),s.add(d),a.add(s);var l=new UI.Row,u=new UI.Integer(o.tubularSegments).setRange(1,1/0).onChange(f);l.add(new UI.Text("Tubular segments").setWidth("90px")),l.add(u),a.add(l);var c=new UI.Row,h=new UI.Integer(o.radialSegments).setRange(1,1/0).onChange(f);c.add(new UI.Text("Radial segments").setWidth("90px")),c.add(h),a.add(c);var p=new UI.Row,m=new UI.Number(o.p).onChange(f);p.add(new UI.Text("P").setWidth("90px")),p.add(m),a.add(p);var g=new UI.Row,w=new UI.Number(o.q).onChange(f);function f(){e.execute(new SetGeometryCommand(t,new XDTHREE[n.type](i.getValue(),d.getValue(),u.getValue(),h.getValue(),m.getValue(),w.getValue())))}return p.add(new UI.Text("Q").setWidth("90px")),p.add(w),a.add(g),a},Sidebar.Geometry.TorusKnotBufferGeometry=Sidebar.Geometry.TorusKnotGeometry,Sidebar.Geometry.TubeGeometry=function(o,r){o.signals;var e=new UI.Row,i=r.geometry,t=i.parameters,u=0,c=[],a=new UI.Row;a.add(new UI.Text("Path").setWidth("90px"));var n=(new UI.Span).setDisplay("inline-block");a.add(n);var h=new UI.Div;n.add(h);for(var s=t.path.points,d=0;d<s.length;d++){var l=s[d];h.add(I(l.x,l.y,l.z))}var p=new UI.Button("+").onClick(function(){if(0===c.length)h.add(I(0,0,0));else{var e=c[c.length-1];h.add(I(e.x.getValue(),e.y.getValue(),e.z.getValue()))}D()});n.add(p),e.add(a);var m=new UI.Row,g=new UI.Number(t.radius).onChange(D);m.add(new UI.Text("Radius").setWidth("90px")),m.add(g),e.add(m);var w=new UI.Row,f=new UI.Integer(t.tubularSegments).onChange(D);w.add(new UI.Text("Tubelar Segments").setWidth("90px")),w.add(f),e.add(w);var y=new UI.Row,E=new UI.Integer(t.radialSegments).onChange(D);y.add(new UI.Text("Radial Segments").setWidth("90px")),y.add(E),e.add(y);var v=new UI.Row,b=new UI.Checkbox(t.closed).onChange(D);v.add(new UI.Text("Closed").setWidth("90px")),v.add(b),e.add(v);var R=new UI.Row,x=(new UI.Select).setOptions({centripetal:"centripetal",chordal:"chordal",catmullrom:"catmullrom"}).setValue(t.path.curveType).onChange(D);R.add(new UI.Text("Curve Type").setWidth("90px"),x),e.add(R);var T=(new UI.Row).setDisplay("catmullrom"==x.getValue()?"":"none"),C=new UI.Number(t.path.tension).setStep(.01).onChange(D);function D(){for(var e=[],t=0,a=0;a<c.length;a++){var n=c[a];n&&(e.push(new XDTHREE.Vector3(n.x.getValue(),n.y.getValue(),n.z.getValue())),t++,n.lbl.setValue(t))}T.setDisplay("catmullrom"==x.getValue()?"":"none"),o.execute(new SetGeometryCommand(r,new XDTHREE[i.type](new XDTHREE.CatmullRomCurve3(e,b.getValue(),x.getValue(),C.getValue()),f.getValue(),g.getValue(),E.getValue(),b.getValue())))}function I(e,t,a){var n=new UI.Div,o=new UI.Text(u+1).setWidth("20px"),r=new UI.Number(e).setWidth("30px").onChange(D),i=new UI.Number(t).setWidth("30px").onChange(D),s=new UI.Number(a).setWidth("30px").onChange(D),d=u,l=new UI.Button("-").onClick(function(){!function(e){if(!c[e])return;h.remove(c[e].row),c[e]=null,D()}(d)});return c.push({row:n,lbl:o,x:r,y:i,z:s}),u++,n.add(o,r,i,s,l),n}return T.add(new UI.Text("Tension").setWidth("90px"),C),e.add(T),e},Sidebar.Geometry.TubeBufferGeometry=Sidebar.Geometry.TubeGeometry,XDTHREE.TeapotBufferGeometry=function(e,t,a,n,o,r,i){var s=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,3,16,17,18,7,19,20,21,11,22,23,24,15,25,26,27,18,28,29,30,21,31,32,33,24,34,35,36,27,37,38,39,30,40,41,0,33,42,43,4,36,44,45,8,39,46,47,12,12,13,14,15,48,49,50,51,52,53,54,55,56,57,58,59,15,25,26,27,51,60,61,62,55,63,64,65,59,66,67,68,27,37,38,39,62,69,70,71,65,72,73,74,68,75,76,77,39,46,47,12,71,78,79,48,74,80,81,52,77,82,83,56,56,57,58,59,84,85,86,87,88,89,90,91,92,93,94,95,59,66,67,68,87,96,97,98,91,99,100,101,95,102,103,104,68,75,76,77,98,105,106,107,101,108,109,110,104,111,112,113,77,82,83,56,107,114,115,84,110,116,117,88,113,118,119,92,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,123,136,137,120,127,138,139,124,131,140,141,128,135,142,143,132,132,133,134,135,144,145,146,147,148,149,150,151,68,152,153,154,135,142,143,132,147,155,156,144,151,157,158,148,154,159,160,68,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,164,177,178,161,168,179,180,165,172,181,182,169,176,183,184,173,173,174,175,176,185,186,187,188,189,190,191,192,193,194,195,196,176,183,184,173,188,197,198,185,192,199,200,189,196,201,202,193,203,203,203,203,204,205,206,207,208,208,208,208,209,210,211,212,203,203,203,203,207,213,214,215,208,208,208,208,212,216,217,218,203,203,203,203,215,219,220,221,208,208,208,208,218,222,223,224,203,203,203,203,221,225,226,204,208,208,208,208,224,227,228,209,209,210,211,212,229,230,231,232,233,234,235,236,237,238,239,240,212,216,217,218,232,241,242,243,236,244,245,246,240,247,248,249,218,222,223,224,243,250,251,252,246,253,254,255,249,256,257,258,224,227,228,209,252,259,260,229,255,261,262,233,258,263,264,237,265,265,265,265,266,267,268,269,270,271,272,273,92,119,118,113,265,265,265,265,269,274,275,276,273,277,278,279,113,112,111,104,265,265,265,265,276,280,281,282,279,283,284,285,104,103,102,95,265,265,265,265,282,286,287,266,285,288,289,270,95,94,93,92],d=[1.4,0,2.4,1.4,-.784,2.4,.784,-1.4,2.4,0,-1.4,2.4,1.3375,0,2.53125,1.3375,-.749,2.53125,.749,-1.3375,2.53125,0,-1.3375,2.53125,1.4375,0,2.53125,1.4375,-.805,2.53125,.805,-1.4375,2.53125,0,-1.4375,2.53125,1.5,0,2.4,1.5,-.84,2.4,.84,-1.5,2.4,0,-1.5,2.4,-.784,-1.4,2.4,-1.4,-.784,2.4,-1.4,0,2.4,-.749,-1.3375,2.53125,-1.3375,-.749,2.53125,-1.3375,0,2.53125,-.805,-1.4375,2.53125,-1.4375,-.805,2.53125,-1.4375,0,2.53125,-.84,-1.5,2.4,-1.5,-.84,2.4,-1.5,0,2.4,-1.4,.784,2.4,-.784,1.4,2.4,0,1.4,2.4,-1.3375,.749,2.53125,-.749,1.3375,2.53125,0,1.3375,2.53125,-1.4375,.805,2.53125,-.805,1.4375,2.53125,0,1.4375,2.53125,-1.5,.84,2.4,-.84,1.5,2.4,0,1.5,2.4,.784,1.4,2.4,1.4,.784,2.4,.749,1.3375,2.53125,1.3375,.749,2.53125,.805,1.4375,2.53125,1.4375,.805,2.53125,.84,1.5,2.4,1.5,.84,2.4,1.75,0,1.875,1.75,-.98,1.875,.98,-1.75,1.875,0,-1.75,1.875,2,0,1.35,2,-1.12,1.35,1.12,-2,1.35,0,-2,1.35,2,0,.9,2,-1.12,.9,1.12,-2,.9,0,-2,.9,-.98,-1.75,1.875,-1.75,-.98,1.875,-1.75,0,1.875,-1.12,-2,1.35,-2,-1.12,1.35,-2,0,1.35,-1.12,-2,.9,-2,-1.12,.9,-2,0,.9,-1.75,.98,1.875,-.98,1.75,1.875,0,1.75,1.875,-2,1.12,1.35,-1.12,2,1.35,0,2,1.35,-2,1.12,.9,-1.12,2,.9,0,2,.9,.98,1.75,1.875,1.75,.98,1.875,1.12,2,1.35,2,1.12,1.35,1.12,2,.9,2,1.12,.9,2,0,.45,2,-1.12,.45,1.12,-2,.45,0,-2,.45,1.5,0,.225,1.5,-.84,.225,.84,-1.5,.225,0,-1.5,.225,1.5,0,.15,1.5,-.84,.15,.84,-1.5,.15,0,-1.5,.15,-1.12,-2,.45,-2,-1.12,.45,-2,0,.45,-.84,-1.5,.225,-1.5,-.84,.225,-1.5,0,.225,-.84,-1.5,.15,-1.5,-.84,.15,-1.5,0,.15,-2,1.12,.45,-1.12,2,.45,0,2,.45,-1.5,.84,.225,-.84,1.5,.225,0,1.5,.225,-1.5,.84,.15,-.84,1.5,.15,0,1.5,.15,1.12,2,.45,2,1.12,.45,.84,1.5,.225,1.5,.84,.225,.84,1.5,.15,1.5,.84,.15,-1.6,0,2.025,-1.6,-.3,2.025,-1.5,-.3,2.25,-1.5,0,2.25,-2.3,0,2.025,-2.3,-.3,2.025,-2.5,-.3,2.25,-2.5,0,2.25,-2.7,0,2.025,-2.7,-.3,2.025,-3,-.3,2.25,-3,0,2.25,-2.7,0,1.8,-2.7,-.3,1.8,-3,-.3,1.8,-3,0,1.8,-1.5,.3,2.25,-1.6,.3,2.025,-2.5,.3,2.25,-2.3,.3,2.025,-3,.3,2.25,-2.7,.3,2.025,-3,.3,1.8,-2.7,.3,1.8,-2.7,0,1.575,-2.7,-.3,1.575,-3,-.3,1.35,-3,0,1.35,-2.5,0,1.125,-2.5,-.3,1.125,-2.65,-.3,.9375,-2.65,0,.9375,-2,-.3,.9,-1.9,-.3,.6,-1.9,0,.6,-3,.3,1.35,-2.7,.3,1.575,-2.65,.3,.9375,-2.5,.3,1.125,-1.9,.3,.6,-2,.3,.9,1.7,0,1.425,1.7,-.66,1.425,1.7,-.66,.6,1.7,0,.6,2.6,0,1.425,2.6,-.66,1.425,3.1,-.66,.825,3.1,0,.825,2.3,0,2.1,2.3,-.25,2.1,2.4,-.25,2.025,2.4,0,2.025,2.7,0,2.4,2.7,-.25,2.4,3.3,-.25,2.4,3.3,0,2.4,1.7,.66,.6,1.7,.66,1.425,3.1,.66,.825,2.6,.66,1.425,2.4,.25,2.025,2.3,.25,2.1,3.3,.25,2.4,2.7,.25,2.4,2.8,0,2.475,2.8,-.25,2.475,3.525,-.25,2.49375,3.525,0,2.49375,2.9,0,2.475,2.9,-.15,2.475,3.45,-.15,2.5125,3.45,0,2.5125,2.8,0,2.4,2.8,-.15,2.4,3.2,-.15,2.4,3.2,0,2.4,3.525,.25,2.49375,2.8,.25,2.475,3.45,.15,2.5125,2.9,.15,2.475,3.2,.15,2.4,2.8,.15,2.4,0,0,3.15,.8,0,3.15,.8,-.45,3.15,.45,-.8,3.15,0,-.8,3.15,0,0,2.85,.2,0,2.7,.2,-.112,2.7,.112,-.2,2.7,0,-.2,2.7,-.45,-.8,3.15,-.8,-.45,3.15,-.8,0,3.15,-.112,-.2,2.7,-.2,-.112,2.7,-.2,0,2.7,-.8,.45,3.15,-.45,.8,3.15,0,.8,3.15,-.2,.112,2.7,-.112,.2,2.7,0,.2,2.7,.45,.8,3.15,.8,.45,3.15,.112,.2,2.7,.2,.112,2.7,.4,0,2.55,.4,-.224,2.55,.224,-.4,2.55,0,-.4,2.55,1.3,0,2.55,1.3,-.728,2.55,.728,-1.3,2.55,0,-1.3,2.55,1.3,0,2.4,1.3,-.728,2.4,.728,-1.3,2.4,0,-1.3,2.4,-.224,-.4,2.55,-.4,-.224,2.55,-.4,0,2.55,-.728,-1.3,2.55,-1.3,-.728,2.55,-1.3,0,2.55,-.728,-1.3,2.4,-1.3,-.728,2.4,-1.3,0,2.4,-.4,.224,2.55,-.224,.4,2.55,0,.4,2.55,-1.3,.728,2.55,-.728,1.3,2.55,0,1.3,2.55,-1.3,.728,2.4,-.728,1.3,2.4,0,1.3,2.4,.224,.4,2.55,.4,.224,2.55,.728,1.3,2.55,1.3,.728,2.55,.728,1.3,2.4,1.3,.728,2.4,0,0,0,1.425,0,0,1.425,.798,0,.798,1.425,0,0,1.425,0,1.5,0,.075,1.5,.84,.075,.84,1.5,.075,0,1.5,.075,-.798,1.425,0,-1.425,.798,0,-1.425,0,0,-.84,1.5,.075,-1.5,.84,.075,-1.5,0,.075,-1.425,-.798,0,-.798,-1.425,0,0,-1.425,0,-1.5,-.84,.075,-.84,-1.5,.075,0,-1.5,.075,.798,-1.425,0,1.425,-.798,0,.84,-1.5,.075,1.5,-.84,.075];THREE.BufferGeometry.call(this),e=e||50,t=void 0!==t?Math.max(2,Math.floor(t)||10):10,r=void 0===r||r;var l=3.15*((i=void 0===i||i)?1:1.3)/2,u=e/l,c=(a=void 0===a||a)?(8*t-4)*t:0;c+=(n=void 0===n||n)?(16*t-4)*t:0,c+=(o=void 0===o||o)?40*t*t:0;var h=new Uint32Array(3*c),p=a?4:0;p+=n?8:0,p+=o?20:0,p*=(t+1)*(t+1);var m=new Float32Array(3*p),g=new Float32Array(3*p),w=new Float32Array(2*p),f=new XDTHREE.Matrix4;f.set(-1,3,-3,1,3,-6,3,0,-3,3,0,0,1,0,0,0);var y,E,v,b,R,x,T,C,D,I,U,V,S,M,X,H,k=[],j=[],L=[],O=[],N=[],P=[],W=[],A=[],B=[],G=new XDTHREE.Vector3,F=0,_=0,z=new XDTHREE.Vector3,J=new XDTHREE.Matrix4,Y=new XDTHREE.Matrix4,K=new XDTHREE.Vector4,Z=new XDTHREE.Vector4,Q=new XDTHREE.Vector4,q=new XDTHREE.Vector4,$=new XDTHREE.Vector3,ee=new XDTHREE.Vector3,te=f.clone();te.transpose();var ae=function(e,t,a){return!(m[3*e]===m[3*t]&&m[3*e+1]===m[3*t+1]&&m[3*e+2]===m[3*t+2]||m[3*e]===m[3*a]&&m[3*e+1]===m[3*a+1]&&m[3*e+2]===m[3*a+2]||m[3*t]===m[3*a]&&m[3*t+1]===m[3*a+1]&&m[3*t+2]===m[3*a+2])};for(y=0;y<3;y++)P[y]=new XDTHREE.Matrix4;var ne=a?32:28;T=t+1;for(var oe=0,re=0,ie=0,se=0,de=0,le=o?0:20;le<ne;le++)if(n||le<20||28<=le){for(y=0;y<3;y++){for(E=0;E<4;E++)for(v=0;v<4;v++)k[4*v+E]=d[3*s[16*le+4*E+v]+y],r&&20<=le&&le<28&&2!==y&&(k[4*v+E]*=1.077),i||2!==y||(k[4*v+E]*=1.3);J.set(k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7],k[8],k[9],k[10],k[11],k[12],k[13],k[14],k[15]),Y.multiplyMatrices(J,f),P[y].multiplyMatrices(te,Y)}for(R=0;R<=t;R++)for(C=R/t,x=0;x<=t;x++){for(D=x/t,V=4,I=U=1;V--;)j[V]=I,L[V]=U,I*=C,U*=D,3===V?(O[V]=N[V]=0,F=_=1):(O[V]=F*(3-V),N[V]=_*(3-V),F*=C,_*=D);for(K.fromArray(j),Z.fromArray(L),Q.fromArray(O),q.fromArray(N),y=0;y<3;y++)(b=K.clone()).applyMatrix4(P[y]),W[y]=b.dot(Z),(b=Q.clone()).applyMatrix4(P[y]),A[y]=b.dot(Z),(b=K.clone()).applyMatrix4(P[y]),B[y]=b.dot(q);$.fromArray(A),ee.fromArray(B),G.crossVectors(ee,$),G.normalize(),0===W[0]&&0===W[1]?z.set(0,W[2]>l?1:-1,0):z.set(G.x,G.z,-G.y),m[re++]=u*W[0],m[re++]=u*(W[2]-l),m[re++]=-u*W[1],g[ie++]=z.x,g[ie++]=z.y,g[ie++]=z.z,w[se++]=1-D,w[se++]=1-C}for(R=0;R<t;R++)for(x=0;x<t;x++)H=(S=oe*T*T+R*T+x)+T,ae(S,M=S+1,X=M+T)&&(h[de++]=S,h[de++]=M,h[de++]=X),ae(S,X,H)&&(h[de++]=S,h[de++]=X,h[de++]=H);oe++}this.setIndex(new XDTHREE.BufferAttribute(h,1)),this.addAttribute("position",new XDTHREE.BufferAttribute(m,3)),this.addAttribute("normal",new XDTHREE.BufferAttribute(g,3)),this.addAttribute("uv",new XDTHREE.BufferAttribute(w,2)),this.computeBoundingSphere()},XDTHREE.TeapotBufferGeometry.prototype=Object.create(XDTHREE.BufferGeometry.prototype),XDTHREE.TeapotBufferGeometry.prototype.constructor=XDTHREE.TeapotBufferGeometry,Sidebar.Geometry.TeapotBufferGeometry=function(e,t){var a=new UI.Row,n=t.geometry.parameters,o=new UI.Row,r=new UI.Number(n.size).onChange(y);o.add(new UI.Text("Size").setWidth("90px")),o.add(r),a.add(o);var i=new UI.Row,s=new UI.Integer(n.segments).setRange(1,1/0).onChange(y);i.add(new UI.Text("Segments").setWidth("90px")),i.add(s),a.add(i);var d=new UI.Row,l=new UI.Checkbox(n.bottom).onChange(y);d.add(new UI.Text("Bottom").setWidth("90px")),d.add(l),a.add(d);var u=new UI.Row,c=new UI.Checkbox(n.lid).onChange(y);u.add(new UI.Text("Lid").setWidth("90px")),u.add(c),a.add(u);var h=new UI.Row,p=new UI.Checkbox(n.body).onChange(y);h.add(new UI.Text("Body").setWidth("90px")),h.add(p),a.add(h);var m=new UI.Row,g=new UI.Checkbox(n.fitLid).onChange(y);m.add(new UI.Text("Fitted Lid").setWidth("90px")),m.add(g),a.add(m);var w=new UI.Row,f=new UI.Checkbox(n.blinn).onChange(y);function y(){t.geometry.dispose(),t.geometry=new XDTHREE.TeapotBufferGeometry(r.getValue(),s.getValue(),l.getValue(),c.getValue(),p.getValue(),g.getValue(),f.getValue()),t.geometry.computeBoundingSphere(),e.geometryChanged.dispatch(t)}return w.add(new UI.Text("Blinn-scaled").setWidth("90px")),w.add(f),a.add(w),a},Sidebar.Geometry.LatheGeometry=function(o,r){o.signals;var e=new UI.Row,i=r.geometry,t=i.parameters,a=new UI.Row,s=new UI.Integer(t.segments).onChange(v);a.add(new UI.Text("Segments").setWidth("90px")),a.add(s),e.add(a);var n=new UI.Row,d=new UI.Number(180*t.phiStart/Math.PI).onChange(v);n.add(new UI.Text("Phi start (°)").setWidth("90px")),n.add(d),e.add(n);var l=new UI.Row,u=new UI.Number(180*t.phiLength/Math.PI).onChange(v);l.add(new UI.Text("Phi length (°)").setWidth("90px")),l.add(u),e.add(l);var c=0,h=[],p=new UI.Row;p.add(new UI.Text("Points").setWidth("90px"));var m=(new UI.Span).setDisplay("inline-block");p.add(m);var g=new UI.Div;m.add(g);for(var w=0;w<t.points.length;w++){var f=t.points[w];g.add(E(f.x,f.y))}var y=new UI.Button("+").onClick(function(){if(0===h.length)g.add(E(0,0));else{var e=h[h.length-1];g.add(E(e.x.getValue(),e.y.getValue()))}v()});function E(e,t){var a=new UI.Div,n=new UI.Text(c+1).setWidth("20px"),o=new UI.Number(e).setRange(0,1/0).setWidth("40px").onChange(v),r=new UI.Number(t).setWidth("40px").onChange(v),i=c,s=new UI.Button("-").onClick(function(){!function(e){if(!h[e])return;g.remove(h[e].row),h[e]=null,v()}(i)});return h.push({row:a,lbl:n,x:o,y:r}),c++,a.add(n,o,r,s),a}function v(){for(var e=[],t=0,a=0;a<h.length;a++){var n=h[a];n&&(e.push(new XDTHREE.Vector2(n.x.getValue(),n.y.getValue())),t++,n.lbl.setValue(t))}o.execute(new SetGeometryCommand(r,new XDTHREE[i.type](e,s.getValue(),d.getValue()/180*Math.PI,u.getValue()/180*Math.PI)))}return m.add(y),e.add(p),e},Sidebar.Geometry.LatheBufferGeometry=Sidebar.Geometry.LatheGeometry;var xtrad_pluginUrl="",xtrad_uploadUrl="";Sidebar.Geometry.TextGeometry=function(P,W){P.signals;var A=new UI.Row,e=W.geometry;this.parameters=e.parameters,xtrad_pluginUrl=xtradDirData.pluginurl,xtrad_uploadUrl=xtradDirData.uploadurl;var B=this,t=window.location.href,a=t.indexOf("/wp-admin"),n=t.substring(0,a)+"/wp-admin/admin-ajax.php";return jQuery.post(n,{action:"list_files"},function(e){var t=JSON.parse(e).ttffonts,a=new UI.Row,d=(new UI.TextArea).onChange(O);d.setValue(B.parameters.text),a.add(new UI.Text("Text").setWidth("90px")),a.add(d),A.add(a);var n=new UI.Row,l=new UI.RadioButtonList("fonttype").onChange(function(){switch(l.getValue()){case"TTF":p.dom.style.display="none",i.dom.style.display="block",O();break;case"Threejs":p.dom.style.display="block",i.dom.style.display="none",O()}});l.setOptions({TTF:"TTF",Threejs:"Threejs"});var o=null!=W.geometry.parameters.parameters.font.fontType&&0<W.geometry.parameters.parameters.font.fontType.length?W.geometry.parameters.parameters.font.fontType:"TTF";l.setValue(o),n.add(new UI.Text("Font Type").setWidth("90px")),n.add(l),A.add(n);var r=new UI.Row,i=new UI.Div;i.dom.style.display="block",r.add(i);for(var u=new UI.Select("selectnoupper").onChange(O),s={},c=0;c<t.length;c++){var h=t[c];s[h]=h}u.setOptions(s),null!=W.geometry.parameters.parameters.fontType&&0!==W.geometry.parameters.parameters.fontType.length||u.setValue("Dustismo Regular.ttf"),"TTF"===o?u.setValue(null!=W.geometry.parameters.parameters.fontName&&0<W.geometry.parameters.parameters.fontName.length?W.geometry.parameters.parameters.fontName:"Dustismo Regular.ttf"):u.setValue("Dustismo Regular.ttf"),i.add(new UI.Text("Font").setWidth("90px")),i.add(u),A.add(r);var p=new UI.Div,m=new UI.Row;p.dom.style.display="none",p.add(m);var g=new UI.Select("select").onChange(O);if(g.setOptions({helvetiker:"helvetiker",optimer:"optimer",gentilis:"gentilis","droid sans":"droid sans","droid sans mono":"droid sans mono","droid serif":"droid serif"}),null!=W.geometry.parameters.parameters.fontType&&0!==W.geometry.parameters.parameters.fontType.length||g.setValue("optimer"),"Threejs"===o){var w=null!=W.geometry.parameters.parameters.fontName&&0<W.geometry.parameters.parameters.fontName.length?W.geometry.parameters.parameters.fontName:"optimer",f=w.indexOf("/");if(0<=f){var y=(w=w.substr(f+1)).indexOf("_bold");0<=y&&(w=w.substr(0,y));var E=w.indexOf("_regular");0<=E&&(w=w.substr(0,E)),w=w.replace(/_/g," ")}else{var v=w.indexOf("_");0<=v&&(w=w.substr(0,v))}g.setValue(w)}else g.setValue("optimer");m.add(new UI.Text("Font").setWidth("90px")),m.add(g);var b=new UI.Row,R=new UI.RadioButtonList("fontweight").onChange(O);switch(R.setOptions({normal:"normal",bold:"bold"}),"Threejs"===o&&R.setValue(null!=W.geometry.parameters.parameters.font.weight&&0<W.geometry.parameters.parameters.font.weight.length?W.geometry.parameters.parameters.font.weight:"normal"),b.add(new UI.Text("Font Weight").setWidth("90px")),b.add(R),p.add(b),A.add(p),o){case"TTF":p.dom.style.display="none",i.dom.style.display="block";break;case"Threejs":p.dom.style.display="block",i.dom.style.display="none"}var x=new UI.Row,T=new UI.Number(B.parameters.parameters.size).setRange(.1,20).onChange(O);x.add(new UI.Text("Size").setWidth("90px")),x.add(T),A.add(x);var C=new UI.Row,D=new UI.Number(B.parameters.parameters.height).setRange(.1,20).onChange(O);C.add(new UI.Text("Extrusion Depth").setWidth("90px")),C.add(D),A.add(C);var I=new UI.Row,U=new UI.Integer(B.parameters.parameters.curveSegments).setRange(1,200).onChange(O);I.add(new UI.Text("Segments").setWidth("90px")),I.add(U),A.add(I);var V=new UI.Row,S=new UI.Number(B.parameters.parameters.bevelThickness).setRange(0,10).onChange(O);V.add(new UI.Text("Bevel Thickness").setWidth("90px")),V.add(S),A.add(V);var M=new UI.Row,X=new UI.Number(B.parameters.parameters.bevelSize).setRange(.1,10).onChange(O);M.add(new UI.Text("Bevel size").setWidth("90px")),M.add(X),A.add(M);var H=new UI.Row,k=new UI.Number(B.parameters.parameters.bevelOffset).setRange(0,10).onChange(O);H.add(new UI.Text("Bevel offset").setWidth("90px")),H.add(k),A.add(H);var j=new UI.Row,L=new UI.Checkbox(B.parameters.parameters.bevelEnabled).onChange(O);function O(){var t=l.getValue(),e=!0;if(null!=W.geometry.parameters.parameters.font.fontType&&W.geometry.parameters.parameters.font.fontType===t&&null!=W.geometry.parameters.parameters.font.fontType&&0<W.geometry.parameters.parameters.font.fontType.length&&null!=W.geometry.parameters.parameters.font.name&&0<W.geometry.parameters.parameters.font.name.length)switch(W.geometry.parameters.parameters.font.fontType){case"TTF":t===W.geometry.parameters.parameters.font.fontType&&W.geometry.parameters.parameters.font.name===u.getValue()&&(e=!1);break;case"Threejs":null!=W.geometry.parameters.parameters.font.weight&&0<W.geometry.parameters.parameters.font.weight.length&&t===W.geometry.parameters.parameters.font.fontType&&W.geometry.parameters.parameters.font.name===u.getValue()&&W.geometry.parameters.parameters.font.weight===R.getValue().toLowerCase()&&(e=!1)}if(e)if("TTF"===t){var a=u.getValue();(new XDTHREE.TTFLoader).load(xtrad_uploadUrl+"/xtrad-library/ttffonts/"+a,function(e){font=new XDTHREE.Font(e),font.name=a,font.fontType=t,N(W,t,a,d.getValue(),font,T.getValue(),D.getValue(),L.getValue(),X.getValue(),k.getValue(),S.getValue(),U.getValue())})}else{var n=new XDTHREE.FontLoader,o=g.getValue().toLowerCase(),r=o.startsWith("droid")?"droid/":"",i="normal"===R.getValue().toLowerCase()?"regular":R.getValue().toLowerCase(),s=r+o.replace(/ /g,"_")+"_"+i+".typeface.json";n.load(xtrad_pluginUrl+"/js/fonts/"+s,function(e){e.fontType="Threejs",e.name=s,e.weight=i,N(W,t,s,d.getValue(),e,T.getValue(),D.getValue(),L.getValue(),X.getValue(),k.getValue(),S.getValue(),U.getValue())})}else N(W,W.geometry.parameters.parameters.fontType,W.geometry.parameters.parameters.fontName,d.getValue(),W.geometry.parameters.parameters.font,T.getValue(),D.getValue(),L.getValue(),X.getValue(),k.getValue(),S.getValue(),U.getValue())}function N(e,t,a,n,o,r,i,s,d,l,u,c){var h={fontType:t,fontName:a,text:n,font:o,materials:e.material,positionx:"center",size:r,height:0===i?.03:i,bevelEnabled:0!==i&&s,bevelThickness:0===i?0:u,bevelSize:0===i?0:d,bevelOffset:l,material:0,extrudeMaterial:0===i?0:1,curveSegments:c},p=(new XTRADVIEWER.Text).createText(h),m=new XDTHREE.Vector3(p.children[0].position.x,p.children[0].position.y,p.children[0].position.z);e.geometry=p.children[0].geometry,P.execute(new SetPositionCommand(e,m)),P.signals.sceneGraphChanged.dispatch()}j.add(new UI.Text("Bevel").setWidth("90px")),j.add(L),A.add(j)}),A},Sidebar.Geometry.TextBufferGeometry=Sidebar.Geometry.TextGeometry;var xtrad_pluginUrl="";Sidebar.Geometry.Text2DGeometry=function(n,o){n.signals;var e=new UI.Row,t=o.geometry;this.parameters=t.parameters,xtrad_pluginUrl=xtradDirData.pluginurl;var a=new UI.Row,r=(new UI.TextArea).onChange(ce);r.setValue(this.parameters.text),a.add(new UI.Text("Text").setWidth("100px")),a.add(r),e.add(a);var i=new UI.Row,s=new UI.RadioButtonList("d2type").onChange(ce);s.setOptions({"3D":"3D",Billboard:"Billboard"}),s.setValue(this.parameters.d2Type),i.add(new UI.Text("2D Type").setWidth("100px")),i.add(s),e.add(i);var d=new UI.Row,l=new UI.RadioButtonList("fontstyle").onChange(ce);l.setOptions({normal:"normal",italic:"italic"}),l.setValue(this.parameters.fontStyle),d.add(new UI.Text("Font Style").setWidth("100px")),d.add(l),e.add(d);var u=new UI.Row,c=new UI.RadioButtonList("fontvariant").onChange(ce);c.setOptions({normal:"normal","small-caps":"small-caps"}),c.setValue(this.parameters.fontVariant),u.add(new UI.Text("Font Variant").setWidth("100px")),u.add(c),e.add(u);var h=new UI.Row,p=new UI.RadioButtonList("fontweight").onChange(ce);p.setOptions({normal:"normal",bold:"bold"}),p.setValue(this.parameters.fontWeight),h.add(new UI.Text("Font Weight").setWidth("100px")),h.add(p),e.add(h);var m=new UI.Row,g=new UI.Input("Arial").onChange(ce);g.setValue(this.parameters.fontFamily),m.add(new UI.Text("Font").setWidth("100px")),m.add(g),e.add(m);var w=new UI.Row,f=new UI.Integer(30).setRange(4,500).onChange(ce);f.setValue(this.parameters.fontSize),w.add(new UI.Text("Font Size (px)").setWidth("100px")),w.add(f),e.add(w);var y=new UI.Row,E=new UI.RadioButtonList("fontcolourtype").onChange(function(){switch(E.getValue()){case"solid":b.dom.style.display="block",x.dom.style.display="none";break;case"gradient":b.dom.style.display="none",x.dom.style.display="block"}ce()});E.setOptions({solid:"solid",gradient:"gradient"}),E.setValue(this.parameters.colorType),y.add(new UI.Text("Font Color Type").setWidth("130px")),y.add(E),e.add(y);var v=new UI.Row,b=new UI.Div;b.dom.style.display="solid"===this.parameters.colorType?"block":"none";var R=(new UI.Color).setValue(this.parameters.color).onChange(ce);b.add(new UI.Text("Colour").setWidth("100px")),b.add(R);var x=new UI.Div;x.dom.style.display="gradient"===this.parameters.colorType?"block":"none";var T=(new UI.Color).setValue(this.parameters.gradientColor1).onChange(ce),C=(new UI.Color).setValue(this.parameters.gradientColor2).onChange(ce),D=new UI.Integer(this.parameters.gradientAngle).setRange(0,360).onChange(ce);x.add(new UI.Text("Col 1").setWidth("100px")),x.add(T),x.add(new UI.Break),x.add(new UI.Text("Col 2").setWidth("100px")),x.add(C),x.add(new UI.Break),x.add(new UI.Text("Angle").setWidth("100px")),x.add(D),v.add(b),v.add(x),e.add(v);var I=new UI.Row,U=new UI.RadioButtonList("fontalign").onChange(ce);U.setOptions({center:"center",left:"left",right:"right"}),U.setValue(this.parameters.align),I.add(new UI.Text("Align").setWidth("100px")),I.add(U),e.add(I);var V=new UI.Row,S=new UI.RadioButtonList("fontveritalalign").onChange(ce);S.setOptions({top:"top",middle:"middle",bottom:"bottom"}),S.setValue(this.parameters.verticalAlign),V.add(new UI.Text(" Vertical Align").setWidth("100px")),V.add(S),e.add(V);var M=new UI.Row,X=new UI.RadioButtonList("fontstroketype").onChange(ce);X.setOptions({normal:"normal",stroke:"stroke"}),X.setValue(this.parameters.strokeStyle),M.add(new UI.Text("Font Stroke Type").setWidth("100px")),M.add(X),e.add(M);var H=new UI.Row,k=(new UI.Color).setValue(this.parameters.shadowColor).onChange(ce);H.add(new UI.Text("Shadow Colour").setWidth("80px")),H.add(k),e.add(H);var j=(new UI.Integer).setValue(this.parameters.shadowBlur).setRange(0,100).onChange(ce);H.add(new UI.Text("Shadow Blur").setWidth("80px")),H.add(j);var L=new UI.Row,O=(new UI.Integer).setValue(this.parameters.shadowOffsetX).setRange(-100,100).onChange(ce);L.add(new UI.Text("Shadow Offset X").setWidth("80px")),L.add(O),e.add(L);var N=(new UI.Integer).setValue(this.parameters.shadowOffsetY).setRange(-100,100).onChange(ce);L.add(new UI.Text("Offset Y").setWidth("80px")),L.add(N);var P=new UI.Row,W=new UI.Div;W.dom.style.display="none"===this.parameters.backgroundColorType?"none":"block";var A=(new UI.Integer).setValue(this.parameters.leftPadding).setRange(0,200).onChange(ce);W.add(new UI.Text("Padding Left").setWidth("80px")),W.add(A);var B=(new UI.Integer).setValue(this.parameters.rightPadding).setRange(0,200).onChange(ce);W.add(new UI.Text("Right").setWidth("80px")),W.add(B),P.add(W),e.add(P);var G=new UI.Row,F=new UI.Div;F.dom.style.display="none"===this.parameters.backgroundColorType?"none":"block";var _=(new UI.Integer).setValue(this.parameters.topPadding).setRange(0,200).onChange(ce);F.add(new UI.Text("Padding Top").setWidth("80px")),F.add(_);var z=(new UI.Integer).setValue(this.parameters.bottomPadding).setRange(0,200).onChange(ce);F.add(new UI.Text("Bottom").setWidth("80px")),F.add(z),G.add(F),e.add(G);var J=new UI.Row,Y=new UI.Div;Y.dom.style.display="none"===this.parameters.backgroundColorType?"none":"block";var K=(new UI.Integer).setValue(this.parameters.lineSpacing).setRange(0,100).onChange(ce);Y.add(new UI.Text("Line Spacing").setWidth("80px")),Y.add(K),J.add(Y),e.add(J);var Z=new UI.Row,Q=new UI.RadioButtonList("backgroundcolourtype").onChange(function(){switch(Q.getValue()){case"none":$.dom.style.display="none",te.dom.style.display="none",W.dom.style.display="none",F.dom.style.display="none",Y.dom.style.display="none";break;case"solid":$.dom.style.display="block",te.dom.style.display="none",W.dom.style.display="block",F.dom.style.display="block",Y.dom.style.display="block";break;case"gradient":$.dom.style.display="none",te.dom.style.display="block",W.dom.style.display="block",F.dom.style.display="block",Y.dom.style.display="block"}ce()});Q.setOptions({none:"none",solid:"solid",gradient:"gradient"}),Q.setValue(this.parameters.backgroundColorType),Z.add(new UI.Text("Background Color Type").setWidth("130px")),Z.add(Q),e.add(Z);var q=new UI.Row,$=new UI.Div;$.dom.style.display="solid"===this.parameters.backgroundColorType?"block":"none";var ee=(new UI.Color).setValue(this.parameters.backgroundColor).onChange(ce);$.add(new UI.Text("Colour").setWidth("100px")),$.add(ee);var te=new UI.Div;te.dom.style.display="gradient"===this.parameters.backgroundColorType?"block":"none";var ae=(new UI.Color).setValue(this.parameters.backgroundGradientColor1).onChange(ce),ne=(new UI.Color).setValue(this.parameters.backgroundGradientColor2).onChange(ce),oe=new UI.Integer(this.parameters.backgroundGradientAngle).setRange(0,360).onChange(ce);te.add(new UI.Text("B Col 1").setWidth("100px")),te.add(ae),te.add(new UI.Break),te.add(new UI.Text("B Col 2").setWidth("100px")),te.add(ne),te.add(new UI.Break),te.add(new UI.Text("B Angle").setWidth("100px")),te.add(oe),q.add($),q.add(te),e.add(q);var re=new UI.Row,ie=new UI.RadioButtonList("side").onChange(ce);ie.setOptions({front:"front",both:"both"}),ie.setValue(this.parameters.side),re.add(new UI.Text("Side").setWidth("100px")),re.add(ie),e.add(re);var se=new UI.Row,de=new UI.Checkbox(this.parameters.antiAlias).onChange(ce);se.add(new UI.Text("Antialias").setWidth("100px")),se.add(de),e.add(se);var le=new UI.Row,ue=new UI.Checkbox(this.parameters.canvasPowerOf2).onChange(ce);function ce(){var e=r.getValue(),t={};t.d2Type=s.getValue(),t.fontStyle=l.getValue(),t.fontVariant=c.getValue(),t.fontWeight=p.getValue(),t.fontSize=f.getValue(),t.fontFamily=g.getValue(),t.align=U.getValue(),t.verticalAlign=S.getValue(),t.colorType=E.getValue(),t.color=R.getValue(),t.gradientColor1=T.getValue(),t.gradientColor2=C.getValue(),t.gradientAngle=D.getValue(),t.backgroundColorType=Q.getValue(),t.backgroundColor=ee.getValue(),t.backgroundGradientColor1=ae.getValue(),t.backgroundGradientColor2=ne.getValue(),t.backgroundGradientAngle=oe.getValue(),t.strokeStyle=X.getValue(),t.shadowColor=k.getValue(),t.shadowBlur=j.getValue(),t.shadowOffsetX=O.getValue(),t.shadowOffsetY=N.getValue(),t.widthSegments=1,t.heightSegments=1,t.side=ie.getValue(),t.antiAlias=de.getValue(),t.canvasPowerOf2=ue.getValue(),t.leftPadding=A.getValue(),t.rightPadding=B.getValue(),t.topPadding=_.getValue(),t.bottomPadding=z.getValue(),t.lineSpacing=K.getValue();var a=(new XTRADVIEWER.Text2D).createText(e,t);a.position.x=o.position.x,a.position.y=o.position.y,a.position.z=o.position.z,a.setRotationFromEuler(o.rotation),a.isSprite&&o.isMesh||o.isSprite&&a.isMesh?(n.execute(new RemoveObjectCommand(o)),n.execute(new AddObjectCommand(a)),n.signals.sceneGraphChanged.dispatch()):(n.execute(new SetGeometryCommand(o,a.geometry)),o.material.transparent=a.material.transparent,o.material.side=a.material.side,n.execute(new SetMaterialMapCommand(o,"map",a.material.map,0)))}return le.add(new UI.Text("Canvas ^2").setWidth("100px")),le.add(ue),e.add(le),e},Sidebar.Geometry.Text2DBufferGeometry=Sidebar.Geometry.Text2DGeometry;var xtrad_pluginUrl="",xtrad_uploadUrl="";Sidebar.Geometry.Characters=function(_e,ze){_e.signals;var Je=new UI.Row;xtrad_pluginUrl=xtradDirData.pluginurl,xtrad_uploadUrl=xtradDirData.uploadurl;var e=window.location.href,t=e.indexOf("/wp-admin"),a=e.substring(0,t)+"/wp-admin/admin-ajax.php";return jQuery.post(a,{action:"list_files"},function(e){for(var t=ze.children[0],a="",n=0;n<ze.children.length;n++)a+=ze.children[n].geometry.parameters.text;var r="",i=null!=t.geometry.parameters.parameters.font.fontType&&0<t.geometry.parameters.parameters.font.fontType.length?t.geometry.parameters.parameters.font.fontType:"TTF";r="TTF"===i?null!=t.geometry.parameters.parameters.fontName&&0<t.geometry.parameters.parameters.fontName.length?t.geometry.parameters.parameters.fontName:"Dustismo Regular":null!=t.geometry.parameters.parameters.fontName&&0<t.geometry.parameters.parameters.fontName.length?t.geometry.parameters.parameters.fontName:"optimer";var s=null!=t.geometry.parameters.parameters.font.weight&&0<t.geometry.parameters.parameters.font.weight.length?t.geometry.parameters.parameters.font.weight:"normal",o=JSON.parse(e).ttffonts,d=new UI.Row,c=(new UI.Input).onChange(Fe);c.setValue(a),d.add(new UI.Text("Text").setWidth("90px")),d.add(c),Je.add(d);var l=new UI.Row,h=new UI.RadioButtonList("fonttype").onChange(function(){switch(h.getValue()){case"TTF":y.dom.style.display="none",p.dom.style.display="block",Fe();break;case"Threejs":y.dom.style.display="block",p.dom.style.display="none",Fe()}});h.setOptions({TTF:"TTF",Threejs:"Threejs"}),h.setValue(i),l.add(new UI.Text("Font Type").setWidth("90px")),l.add(h),Je.add(l);var u=new UI.Row,p=new UI.Div;p.dom.style.display="block",u.add(p);for(var m=new UI.Select("selectnoupper").onChange(Fe),g={},w=0;w<o.length;w++){var f=o[w];g[f]=f}m.setOptions(g),"TTF"===i?m.setValue(r):m.setValue("Dustismo Regular.ttf"),p.add(new UI.Text("Font").setWidth("90px")),p.add(m),Je.add(u);var y=new UI.Div,E=new UI.Row;y.dom.style.display="none",y.add(E);var v=new UI.Select("select").onChange(Fe);if(v.setOptions({helvetiker:"helvetiker",optimer:"optimer",gentilis:"gentilis","droid sans":"droid sans","droid sans mono":"droid sans mono","droid serif":"droid serif"}),"Threejs"===i){var b=r,R=b.indexOf("/");if(0<=R){var x=(b=b.substr(R+1)).indexOf("_bold");0<=x&&(b=b.substr(0,x));var T=b.indexOf("_regular");0<=T&&(b=b.substr(0,T)),b=b.replace(/_/g," ")}else{var C=b.indexOf("_");0<=C&&(b=b.substr(0,C))}v.setValue(b)}else v.setValue("optimer");E.add(new UI.Text("Font").setWidth("90px")),E.add(v);var D=new UI.Row,I=new UI.RadioButtonList("fontweight").onChange(Fe);switch(I.setOptions({normal:"normal",bold:"bold"}),"Threejs"===i&&I.setValue(s),D.add(new UI.Text("Font Weight").setWidth("90px")),D.add(I),y.add(D),Je.add(y),i){case"TTF":y.dom.style.display="none",p.dom.style.display="block";break;case"Threejs":y.dom.style.display="block",p.dom.style.display="none"}var U=new UI.Row,V=new UI.Integer(t.geometry.parameters.parameters.size).setRange(1,40).onChange(Fe);U.add(new UI.Text(" Size").setWidth("90px")),U.add(V),Je.add(U);var S=new UI.Row,M=new UI.Integer(t.geometry.parameters.parameters.curveSegments).setRange(1,200).onChange(Fe);S.add(new UI.Text("Segments").setWidth("90px")),S.add(M),Je.add(S);var X=new UI.Row,H=new UI.Number(t.geometry.parameters.parameters.height).setRange(0,40).onChange(Fe);X.add(new UI.Text("Extrusion").setWidth("90px")),X.add(H),Je.add(X);var k=new UI.Row,j=new UI.Checkbox(t.geometry.parameters.parameters.bevelEnabled).onChange(Fe);k.add(new UI.Text("Bevelled").setWidth("90px")),k.add(j),Je.add(k);var L=new UI.Row,O=new UI.Number(t.geometry.parameters.parameters.bevelSize).setRange(0,40).onChange(Fe);L.add(new UI.Text("Bevel Size").setWidth("90px")),L.add(O),Je.add(L);var N=new UI.Row,P=new UI.Number(t.geometry.parameters.parameters.bevelOffset).setRange(0,40).onChange(Fe);N.add(new UI.Text("Bevel Offset").setWidth("90px")),N.add(P),Je.add(N);var W=new UI.Row,A=new UI.Number(t.geometry.parameters.parameters.bevelThickness).setRange(0,40).onChange(Fe);W.add(new UI.Text("Bevel Thickness").setWidth("90px")),W.add(A),Je.add(W);var B=null!=t.geometry.parameters.parameters.animateObject?t.geometry.parameters.parameters.animateObject:"Fixed",G=new UI.Row;G.setClass("option");var F=new UI.RadioButtonList("animationPivot").onChange(function(){switch(F.getValue()){case"Fixed":Z.dom.style.display="none",z.dom.style.display="none";break;case"Rotation":case"RotationChar":Z.dom.style.display="none",z.dom.style.display="block";break;case"Fly":Z.dom.style.display="block",z.dom.style.display="none"}Fe()});F.setOptions({Fixed:"Fixed",Rotation:"Rotation",RotationChar:"RotationChar",Fly:"Fly"}),F.setValue(B),G.add(new UI.Text("Animate").setWidth("90px")),G.add(F),Je.add(G);var _=new UI.Row,z=new UI.Div;z.dom.style.display="Rotation"===B||"RotationChar"===B?"block":"none";var J=new UI.Number(null!=t.geometry.parameters.parameters.animateRotations?t.geometry.parameters.parameters.animateRotations.x:0).setWidth("90px").setRange(0,10).onChange(Fe);z.add(J),z.add(new UI.Text("X").setWidth("90px")),z.add(J);var Y=new UI.Number(null!=t.geometry.parameters.parameters.animateRotations?t.geometry.parameters.parameters.animateRotations.y:0).setWidth("90px").setRange(0,10).onChange(Fe);z.add(Y),z.add(new UI.Text("Y").setWidth("90px")),z.add(Y);var K=new UI.Number(null!=t.geometry.parameters.parameters.animateRotations?t.geometry.parameters.parameters.animateRotations.z:0).setWidth("90px").setRange(0,10).onChange(Fe);z.add(K),z.add(new UI.Text("Z").setWidth("90px")),z.add(K),_.add(z),Je.add(_);var Z=new UI.Div;Z.dom.style.display="Fly"===B?"block":"none";var Q=2;null!=ze.userData&&null!=ze.userData.fly&&(Q=ze.userData.fly.startTime);var q=new UI.Row,$=new UI.Number(Q).setWidth("90px").setRange(0,100).onChange(Fe);q.add(new UI.Text("StartTime").setWidth("90px")),q.add($),Z.add(q);var ee=new UI.Row,te=0;null!=ze.userData&&null!=ze.userData.fly&&(te=ze.userData.fly.startPosX);var ae=0;null!=ze.userData&&null!=ze.userData.fly&&(ae=ze.userData.fly.startPosY);var ne=-50;null!=ze.userData&&null!=ze.userData.fly&&(ne=ze.userData.fly.startPosZ);var oe=new UI.Number(te).setWidth("90px").setRange(-500,500).onChange(Fe);ee.add(new UI.Text("Start X").setWidth("90px")),ee.add(oe);var re=new UI.Number(ae).setWidth("90px").setRange(-500,500).onChange(Fe);ee.add(new UI.Text("Start Y").setWidth("90px")),ee.add(re);var ie=new UI.Number(ne).setWidth("90px").setRange(-500,500).onChange(Fe);ee.add(new UI.Text("Start Z").setWidth("90px")),ee.add(ie),Z.add(ee);var se=new UI.Row,de=0;null!=ze.userData&&null!=ze.userData.fly&&(de=null!=ze.userData.fly.endPosX?ze.userData.fly.endPosX:-ze.userData.fly.startPosX);var le=0;null!=ze.userData&&null!=ze.userData.fly&&(le=null!=ze.userData.fly.endPosY?ze.userData.fly.endPosY:-ze.userData.fly.startPosY);var ue=50;null!=ze.userData&&null!=ze.userData.fly&&(ue=null!=ze.userData.fly.endPosZ?ze.userData.fly.endPosZ:-ze.userData.fly.startPosZ);var ce=new UI.Number(de).setWidth("90px").setRange(-500,500).onChange(Fe);se.add(new UI.Text("End X").setWidth("90px")),se.add(ce);var he=new UI.Number(le).setWidth("90px").setRange(-500,500).onChange(Fe);se.add(new UI.Text("End Y").setWidth("90px")),se.add(he);var pe=new UI.Number(ue).setWidth("90px").setRange(-500,500).onChange(Fe);se.add(new UI.Text("End Z").setWidth("90px")),se.add(pe),Z.add(se);var me="None";null!=ze.userData&&null!=ze.userData.fly&&(me=ze.userData.fly.in);var ge=new UI.Row;ge.setClass("option");var we=new UI.RadioButtonList("flyInMode").onChange(Fe);we.setOptions({None:"None",Random:"Random",Linear:"Linear"}),we.setValue(me),ge.add(new UI.Text("Fly In Type").setWidth("90px")),ge.add(we),Z.add(ge);var fe="SingleChar";null!=ze.userData&&null!=ze.userData.fly&&(fe=ze.userData.fly.inType);var ye=new UI.Row;ye.setClass("option");var Ee=new UI.RadioButtonList("flyInTypeMode").onChange(Fe);Ee.setOptions({SingleChar:"SingleChar",Word:"Word",All:"All"}),Ee.setValue(fe),ge.add(new UI.Text("Fly In Mode").setWidth("90px")),ge.add(Ee),Z.add(ye);var ve=10;null!=ze.userData&&null!=ze.userData.fly&&(ve=ze.userData.fly.inTime);var be=new UI.Row,Re=new UI.Number(ve).setWidth("90px").setRange(0,100).onChange(Fe);be.add(new UI.Text("Fly In Time").setWidth("90px")),be.add(Re),Z.add(be);var xe="Linear";null!=ze.userData&&null!=ze.userData.fly&&(xe=ze.userData.fly.inEasing);var Te=new UI.Row,Ce=new UI.RadioButtonList("flyInEasing").onChange(Fe);Ce.setOptions({Linear:"Linear",InCubic:"InCubic",OutCubic:"OutCubic",InOutCubic:"InOutCubic",InElastic:"InElastic",OutElastic:"OutElastic",InOutElastic:"InOutElastic"}),Ce.setValue(xe),Te.add(new UI.Text("Fly In Easing").setWidth("150px")),Te.add(Ce),Z.add(Te);var De=2;null!=ze.userData&&null!=ze.userData.fly&&(De=ze.userData.fly.stayTime);var Ie=new UI.Row,Ue=new UI.Number(De).setWidth("90px").setRange(0,100).onChange(Fe);Ie.add(new UI.Text("Wait").setWidth("90px")),Ie.add(Ue),Z.add(Ie);var Ve="None";null!=ze.userData&&null!=ze.userData.fly&&(Ve=ze.userData.fly.out);var Se=new UI.Row;Se.setClass("option");var Me=new UI.RadioButtonList("FlyOutMode").onChange(Fe);Me.setOptions({None:"None",Random:"Random",Linear:"Linear"}),Me.setValue(Ve),Se.add(new UI.Text("Fly Out Type").setWidth("150px")),Se.add(Me),Z.add(Se);var Xe="SingleChar";null!=ze.userData&&null!=ze.userData.fly&&(Xe=ze.userData.fly.outType);var He=new UI.Row;He.setClass("option");var ke=new UI.RadioButtonList("flyOutTypeMode").onChange(Fe);ke.setOptions({SingleChar:"SingleChar",Word:"Word",All:"All"}),ke.setValue(Xe),Se.add(new UI.Text("Fly Out Mode").setWidth("90px")),Se.add(ke),Z.add(He);var je=10;null!=ze.userData&&null!=ze.userData.fly&&(je=ze.userData.fly.outTime);var Le=new UI.Row,Oe=new UI.Number(je).setWidth("90px").setRange(0,100).onChange(Fe);Le.add(new UI.Text("Fly Out Time").setWidth("90px")),Le.add(Oe),Z.add(Le);var Ne="Linear";null!=ze.userData&&null!=ze.userData.fly&&(Ne=ze.userData.fly.outEasing);var Pe=new UI.Row,We=new UI.RadioButtonList("flyOutEasing").onChange(Fe);We.setOptions({Linear:"Linear",InCubic:"InCubic",OutCubic:"OutCubic",InOutCubic:"InOutCubic",InElastic:"InElastic",OutElastic:"OutElastic",InOutElastic:"InOutElastic"}),We.setValue(Ne),Pe.add(new UI.Text("Fly Out Easing").setWidth("150px")),Pe.add(We),Z.add(Pe);var Ae=0;null!=ze.userData&&null!=ze.userData.fly&&null!=ze.userData.fly.pauseAtEnd&&(Ae=ze.userData.fly.pauseAtEnd);var Be=new UI.Row,Ge=new UI.Number(Ae).setWidth("90px").setRange(0,100).onChange(Fe);function Fe(){var e,t,a,n=h.getValue(),o=!0;if(i===n)switch(i){case"TTF":r===m.getValue()&&(o=!1);break;case"Threejs":r===m.getValue()&&s===I.getValue().toLowerCase()&&(o=!1)}function u(e,t,a,n,o,r,i,s,d,l,u,c,h,p){if(0<e.children.length){for(var m=e.children[0],g=m.material,w=g[0].metalness,f=g[0].opacity,y=g[0].roughness,E=null!=m.geometry.parameters.parameters.uniformscript?null!=m.geometry.parameters.parameters.uniformscript:"",v=e.children.length-1;0<=v;--v){var b=e.children[v];_e.execute(new RemoveObjectCommand(b))}for(var R=0;R<a.length;R++){if("RandomPerChar"===t){var x=randomColor();g=[new XDTHREE.MeshStandardMaterial({color:x,opacity:f,transparent:f<1,metalness:w,roughness:y,flatShading:!0}),new XDTHREE.MeshStandardMaterial({color:x,opacity:f,transparent:f<1,metalness:w,roughness:y,flatShading:!1})]}var T=a.charAt(R),C={fontType:o,fontName:n,colourType:t,text:T,font:r,materials:g,positionx:"center",size:i,height:0===s?.03:s,bevelEnabled:0!==s&&d,bevelThickness:0===s?0:l,bevelSize:0===s?0:u,bevelOffset:c,material:0,extrudeMaterial:0===s?0:1,animateObject:h,animateRotations:p},D=(new XTRADVIEWER.Text).createText(C).children[0];D.name=T,e.add(D)}for(var I=[],U=0,V=0;V<e.children.length;V++){var S=e.children[V],M=(new XDTHREE.Box3).setFromObject(S),X=1;M.min.x<1e7&&(X=M.max.x-M.min.x),I.push(X),U+=X}var H=-U/2;for(V=0;V<e.children.length;V++){(S=e.children[V]).position.x=H,H+=I[V]}if("Rotation"===h||"RotationChar"===h||"Shader"===t&&"Fly"!==h){var k="function update( event ) {\nvar time = event.time * 0.001;\nvar delta = event.delta * 0.001;\n",j={objectRotations:{},groupRotations:{}};"Rotation"===h?(k+="this.rotation.x = time * this.userData.objectRotations.x;\nthis.rotation.y = time * this.userData.objectRotations.y;\nthis.rotation.z = time * this.userData.objectRotations.z;\n",j.objectRotations={x:p.x,y:p.y,z:p.z}):"RotationChar"===h&&(k+="for(var i = 0; i < this.children.length; i++){\n",k+="this.children[i].rotation.x = time * this.userData.objectRotations.x;\nthis.children[i].rotation.y = time * this.userData.objectRotations.y;\nthis.children[i].rotation.z = time * this.userData.objectRotations.z;\n",k+="}\n",j.objectRotations={x:p.x,y:p.y,z:p.z}),"Shader"===t&&(k+=E),k+="}"}else if("Fly"===h){(j={fly:{}}).fly={text:a,startTime:$.getValue(),startPosX:oe.getValue(),startPosY:re.getValue(),startPosZ:ie.getValue(),endPosX:ce.getValue(),endPosY:he.getValue(),endPosZ:pe.getValue(),in:we.getValue(),inType:Ee.getValue(),inTime:Re.getValue(),inEasing:Ce.getValue(),stayTime:Ue.getValue(),out:Me.getValue(),outType:ke.getValue(),outTime:Oe.getValue(),outEasing:We.getValue(),pauseAtEnd:Ge.getValue()},k=function(e,t){var a="";a+="var charUpdate = new XTRADVIEWER.CharAnimation(this.userData, this.children);\n",a+="function update( event ) {\nvar time = event.time * 0.001;\nvar delta = event.delta * 0.001;\n",a+="\tcharUpdate.updateCharacters(event.time, this.children);\n","Shader"===e&&(a+=t);return a+="}\n"}(t,E)}e.userData=j,_e.execute(new AddObjectCommand(e));var L={name:"group"+type,source:k};_e.execute(new RemoveScriptByNameCommand(e,L)),_e.execute(new AddScriptCommand(e,L))}}o?function(n){var o=n.children[0],r=h.getValue();if("TTF"===r){var i=m.getValue(),e=new XDTHREE.TTFLoader;e.load(xtrad_uploadUrl+"/xtrad-library/ttffonts/"+i,function(e){var t=new XDTHREE.Font(e);t.name=i,t.fontType=r,t.weight="";var a=null!=o.geometry.parameters.parameters.colourType?o.geometry.parameters.parameters.colourType:"";u(n,a,c.getValue(),i,r,t,V.getValue(),H.getValue(),j.getValue(),A.getValue(),O.getValue(),P.getValue(),F.getValue(),{x:J.getValue(),y:Y.getValue(),z:K.getValue()})})}else{var t=new XDTHREE.FontLoader,a=v.getValue().toLowerCase(),s=a.startsWith("droid")?"droid/":"",d="normal"===I.getValue().toLowerCase()?"regular":I.getValue().toLowerCase(),l=s+a.replace(/ /g,"_")+"_"+d+".typeface.json";t.load(xtrad_pluginUrl+"/js/fonts/"+l,function(e){e.name=l,e.fontType=r,e.weight=d;var t=null!=o.geometry.parameters.parameters.colourType?o.geometry.parameters.parameters.colourType:"";u(n,t,c.getValue(),l,r,e,V.getValue(),H.getValue(),j.getValue(),A.getValue(),O.getValue(),P.getValue(),F.getValue(),{x:J.getValue(),y:Y.getValue(),z:K.getValue()})})}}(ze):(t=(e=ze).children[0],a=null!=t.geometry.parameters.parameters.colourType?t.geometry.parameters.parameters.colourType:"",u(e,a,c.getValue(),t.geometry.parameters.parameters.font.name,t.geometry.parameters.parameters.font.fontType,t.geometry.parameters.parameters.font,V.getValue(),H.getValue(),j.getValue(),A.getValue(),O.getValue(),P.getValue(),F.getValue(),{x:J.getValue(),y:Y.getValue(),z:K.getValue()}))}Be.add(new UI.Text("Pause Before Restart").setWidth("90px")),Be.add(Ge),Z.add(Be),Je.add(Z)}),Je};var xtrad_uploadUrl="",xtrad_pluginUrl="";Sidebar.Material=function(x){var T,c=x.signals,C=(x.config.getKey("project/simpleAdvancedMode"),0);xtrad_uploadUrl=xtradDirData.uploadurl,xtrad_pluginUrl=xtradDirData.pluginurl;var h=new UI.Panel;h.setBorderTop("0"),h.setDisplay("none"),h.setPaddingTop("20px");var e,D="",p="",m=null,I="",U=0,V=0,S=0,M=0,X=0,H=0,k=0,j="",L=!1,O="",N=!1,P="",W=0,A=!1,B="",G=0,F=!1,_="",z="",J=!1,Y=0,K=!1,Z=!1,Q=0,g=null,w=null,f=null,y=null,E=null,v=null,b=null,R=null,q=null,$=null,ee=null,te=null,ae=null,ne=null,oe=null,re=null,ie=null,se=null,de=null,le=null,ue=null,ce=null,he=null,pe=null,me=null,ge=null,we="",fe=null,ye="",Ee=null,ve=0,be=null,Re=0,xe=null,Te=0,Ce=null,De=0,Ie=null,Ue=0,Ve=null,Se=0,Me=null,Xe=0,He=null,ke=!0,t=new UI.Row,r=new UI.Row;r.add(new UI.Text("Slot").setWidth("90px"));var je=(new UI.Select).setWidth("170px").setFontSize("12px").onChange(Oe);je.setOptions({0:""}).setValue(0),r.add(je),h.add(r),t.add(new UI.Text("").setWidth("90px")),t.add(new UI.Button("New").onClick(function(){var e=new(XDTHREE[D.getValue()]);x.execute(new SetMaterialCommand(T,e,C),"New Material: "+D.getValue()),Oe()})),t.add(new UI.Button("Copy").setMarginLeft("4px").onClick(function(){if(e=T.material,Array.isArray(e)){if(0===e.length)return;e=e[C]}})),t.add(new UI.Button("Paste").setMarginLeft("4px").onClick(function(){void 0!==e&&(x.execute(new SetMaterialCommand(T,e,C),"Pasted Material: "+D.getValue()),We(),Oe())})),h.add(t);var Le=null,a=window.location.href,n=a.indexOf("/wp-admin"),o=a.substring(0,n)+"/wp-admin/admin-ajax.php";function Oe(){var e=T,t=e.geometry,a=C;(C=parseInt(je.getValue()))!==a&&We(!0);var n=x.getObjectMaterial(T,C),o=!1,r=!1,i=W.getValue(),s=!0===N.getValue(),d=s?P.getValue():null,l=G.getValue(),u=!0===A.getValue(),c=u?B.getValue():null,h=p?_.getValue():null,p=!0===F.getValue(),m=parseInt(z.getValue()),g=J.getValue(),w=Y.getValue(),f=K.getValue(),y=Z.getValue(),E=Q.getValue();if(e.isSprite&&(r=!0),t.isGeometry&&0<t.faceVertexUvs[0].length&&(r=!0),t.isBufferGeometry&&void 0!==t.attributes.uv&&(r=!0),n){if(n instanceof XDTHREE[D.getValue()]==!1&&(n=new(XDTHREE[D.getValue()]),x.execute(new SetMaterialCommand(T,n,C),"New Material: "+D.getValue())),n instanceof XDTHREE.PointsMaterial&&(r=!0),void 0!==n.color&&n.color.getHex()!==I.getHexValue()&&x.execute(new SetMaterialColorCommand(T,"color",I.getHexValue(),C)),void 0!==n.roughness&&.01<=Math.abs(n.roughness-U.getValue())&&x.execute(new SetMaterialValueCommand(T,"roughness",U.getValue(),C)),void 0!==n.metalness&&.01<=Math.abs(n.metalness-V.getValue())&&x.execute(new SetMaterialValueCommand(T,"metalness",V.getValue(),C)),void 0!==n.emissive&&n.emissive.getHex()!==S.getHexValue()&&x.execute(new SetMaterialColorCommand(T,"emissive",S.getHexValue(),C)),void 0!==n.specular&&n.specular.getHex()!==M.getHexValue()&&x.execute(new SetMaterialColorCommand(T,"specular",M.getHexValue(),C)),void 0!==n.shininess&&.01<=Math.abs(n.shininess-X.getValue())&&x.execute(new SetMaterialValueCommand(T,"shininess",X.getValue(),C)),void 0!==n.clearCoat&&.01<=Math.abs(n.clearCoat-H.getValue())&&x.execute(new SetMaterialValueCommand(T,"clearCoat",H.getValue(),C)),void 0!==n.clearCoatRoughness&&.01<=Math.abs(n.clearCoatRoughness-k.getValue())&&x.execute(new SetMaterialValueCommand(T,"clearCoatRoughness",k.getValue(),C)),void 0!==n.vertexColors){var v=parseInt(j.getValue());n.vertexColors!==v&&x.execute(new SetMaterialValueCommand(T,"vertexColors",v,C))}if(void 0!==n.map)if(r){var b=!0===L.getValue(),R=b?O.getValue():null;(n.map!==R||Pe(n.map))&&(Ne(n.map),n.needsUpdate=!0,x.execute(new SetMaterialMapCommand(T,"map",R,C)))}else b&&(o=!0);void 0!==n.bumpMap&&(r?((n.bumpMap!==d||Pe(n.bumpMap))&&(Ne(n.bumpMap),n.needsUpdate=!0,x.execute(new SetMaterialMapCommand(T,"bumpMap",d,C))),n.bumpScale!==i&&x.execute(new SetMaterialValueCommand(T,"bumpScale",i,C))):s&&(o=!0)),void 0!==n.displacementMap&&(r?((n.displacementMap!==c||Pe(n.displacementMap))&&(Ne(n.displacementMap),n.needsUpdate=!0,x.execute(new SetMaterialMapCommand(T,"displacementMap",c,C))),n.displacementScale!==l&&x.execute(new SetMaterialValueCommand(T,"displacementScale",l,C))):u&&(o=!0)),void 0!==n.specularMap&&(r?(n.specularMap!==h||Pe(n.specularMap))&&(Ne(n.specularMap),n.needsUpdate=!0,x.execute(new SetMaterialMapCommand(T,"specularMap",h,C))):p&&(o=!0)),void 0!==n.side&&n.side!==m&&x.execute(new SetMaterialValueCommand(T,"side",m,C)),void 0!==n.flatShading&&n.flatShading!==g&&x.execute(new SetMaterialValueCommand(T,"flatShading",g,C)),void 0!==n.opacity&&.01<=Math.abs(n.opacity-w)&&x.execute(new SetMaterialValueCommand(T,"opacity",w,C)),void 0!==n.transparent&&n.transparent!==f&&x.execute(new SetMaterialValueCommand(T,"transparent",f,C)),void 0!==n.wireframe&&n.wireframe!==y&&x.execute(new SetMaterialValueCommand(T,"wireframe",y,C)),void 0!==n.wireframeLinewidth&&.01<=Math.abs(n.wireframeLinewidth-E)&&x.execute(new SetMaterialValueCommand(T,"wireframeLinewidth",E,C)),We()}o&&console.warn("Can't set texture, model doesn't have texture coordinates")}function Ne(e){null!=e&&(e.wrapS=parseInt(we.getValue()),e.wrapT=parseInt(ye.getValue()),e.repeat.set(Te.getValue(),De.getValue()),e.offset.set(ve.getValue(),Re.getValue()),e.rotation=Ue.getValue()*Math.PI/180,e.center.set(Se.getValue(),Xe.getValue()),e.flipY=ke.getValue(),e.matrixAutoUpdate=!0,e.needsUpdate=!0)}function i(e){null!=e&&(we.setValue(e.wrapS),ye.setValue(e.wrapT),Te.setValue(e.repeat.x),De.setValue(e.repeat.y),ve.setValue(e.offset.x),Re.setValue(e.offset.y),Ue.setValue(180*e.rotation/Math.PI),Se.setValue(e.center.x),Xe.setValue(e.center.y),ke.setValue(e.flipY))}function Pe(e){var t=!1;return null!=e&&(e.wrapS!==we.getValue()&&(t=!0),e.wrapT!==ye.getValue()&&(t=!0),e.repeat.x!==Te.getValue()&&(t=!0),e.repeat.y!==De.getValue()&&(t=!0),e.offset.x!==ve.getValue()&&(t=!0),e.offset.y!==Re.getValue()&&(t=!0),e.rotation!==Ue.getValue()*Math.PI/180&&(t=!0),e.center.x!==Se.getValue()&&(t=!0),e.center.y!==Xe.getValue()&&(t=!0),e.flipY!==ke.getValue()&&(t=!0)),t}function We(e){if(T){var t=T.material,a=!1;if(Array.isArray(t)){var n={};C=Math.max(0,Math.min(t.length,C));for(var o=0;o<t.length;o++)n[o]=String(o+1)+": "+t[o].name;je.setOptions(n).setValue(C)}void 0!==(t=x.getObjectMaterial(T,C)).name&&p.setValue(t.name),D.setValue(t.type),void 0!==t.color&&I.setHexValue(t.color.getHexString()),void 0!==t.roughness&&U.setValue(t.roughness),void 0!==t.metalness&&V.setValue(t.metalness),void 0!==t.emissive&&S.setHexValue(t.emissive.getHexString()),void 0!==t.specular&&M.setHexValue(t.specular.getHexString()),void 0!==t.shininess&&X.setValue(t.shininess),void 0!==t.clearCoat&&H.setValue(t.clearCoat),void 0!==t.clearCoatRoughness&&k.setValue(t.clearCoatRoughness),void 0!==t.vertexColors&&j.setValue(t.vertexColors),re.dom.style.display="flex",L.setValue(null!==t.map),void 0!==t.map&&(null!==t.map||e)&&(O.setValue(t.map),a||(i(t.map),a=!0)),void 0!==t.bumpMap&&(N.setValue(null!==t.bumpMap),(null!==t.bumpMap||e)&&(P.setValue(t.bumpMap),a||(i(t.bumpMap),a=!0)),W.setValue(t.bumpScale)),void 0!==t.displacementMap&&(A.setValue(null!==t.displacementMap),(null!==t.displacementMap||e)&&(B.setValue(t.displacementMap),a||(i(t.displacementMap),a=!0)),G.setValue(t.displacementScale)),void 0!==t.specularMap&&(F.setValue(null!==t.specularMap),(null!==t.specularMap||e)&&(_.setValue(t.specularMap),a||(i(t.specularMap),a=!0))),void 0!==t.side&&z.setValue(t.side),void 0!==t.flatShading&&J.setValue(t.flatShading),void 0!==t.opacity&&Y.setValue(t.opacity),void 0!==t.transparent&&K.setValue(t.transparent),void 0!==t.wireframe&&Z.setValue(t.wireframe),void 0!==t.wireframeLinewidth&&Q.setValue(t.wireframeLinewidth),function(){var e={name:w,color:b,roughness:R,metalness:q,emissive:$,specular:ee,shininess:te,clearCoat:ae,clearCoatRoughness:ne,vertexShader:f,vertexColors:oe,map:ie,bumpMap:se,displacementMap:de,specularMap:le,side:ue,flatShading:ce,opacity:he,transparent:pe,wireframe:me},t=T.material;if(Array.isArray(t)){if(r.setDisplay(""),0===t.length)return;t=t[C]}else r.setDisplay("none");for(var a in e)e[a].setDisplay(void 0!==t[a]?"":"none")}()}}return jQuery.post(o,{action:"list_files"},function(e){var t=JSON.parse(e);t.videos,g=new UI.Row,D=(new UI.Select).setOptions({MeshBasicMaterial:"MeshBasicMaterial",MeshDepthMaterial:"MeshDepthMaterial",MeshNormalMaterial:"MeshNormalMaterial",MeshLambertMaterial:"MeshLambertMaterial",MeshPhongMaterial:"MeshPhongMaterial",MeshStandardMaterial:"MeshStandardMaterial",MeshPhysicalMaterial:"MeshPhysicalMaterial",SpriteMaterial:"SpriteMaterial",PointsMaterial:"PointsMaterial"}).setWidth("150px").setFontSize("12px").onChange(Oe),g.add(new UI.Text("Type").setWidth("90px")),g.add(D),h.add(g),w=new UI.Row,p=(new UI.Input).setWidth("150px").setFontSize("12px").onChange(function(){x.execute(new SetMaterialValueCommand(x.selected,"name",p.getValue(),C))}),w.add(new UI.Text("Name").setWidth("90px")),w.add(p),h.add(w),(f=new UI.Row).add(new UI.Text("Program").setWidth("90px"));var a=new UI.Button("Info");a.setMarginLeft("4px"),a.onClick(function(){c.editScript.dispatch(T,"programInfo")}),f.add(a),(y=new UI.Button("Vertex")).setMarginLeft("4px"),y.onClick(function(){c.editScript.dispatch(T,"vertexShader")}),f.add(y);var n=new UI.Button("Fragment");n.setMarginLeft("4px"),n.onClick(function(){c.editScript.dispatch(T,"fragmentShader")}),f.add(n),h.add(f),Le=t.materials;for(var o=xtrad_uploadUrl+"/xtrad-library/materials/",r=[],i=0;i<Le.length;i++){var s=(t=JSON.parse(Le[i])).name,d=s+"/"+s+".jpg";r.push(d)}(E=new UI.Div).dom.style.display="block",(v=new UI.Row).setClass("option"),m=new UI.ImageSelect(o,r,"Material",64,64,3,148,!1,!1),v.add(new UI.Text("Mat").setWidth("90px")),v.add(m);var l=new UI.Button("Apply").onClick(function(){!function(){var e=m.getImage(),t=parseInt(je.getValue()),a=x.getObjectMaterial(T,t);if(a&&0<e.length){var n=T,o=n.geometry,r=!1;n instanceof XDTHREE.Sprite&&(r=!0),o instanceof XDTHREE.Geometry&&0<o.faceVertexUvs[0].length&&(r=!0),o instanceof XDTHREE.BufferGeometry&&void 0!==o.attributes.uv&&(r=!0);for(var i=xtrad_uploadUrl+"/xtrad-library/materials/",s=0;s<Le.length;s++){var d=Le[s],l=JSON.parse(d),u=null;if(null!=l.data&&0<l.data.length)var u=JSON.parse(l.data);if(l.name===e){if(null!=l.map&&void 0!==a.map&&r){L.setValue(!0);var c=i+l.name+"/"+l.map,h=(new XDTHREE.TextureLoader).load(c);Ne(h),x.execute(new SetMaterialMapCommand(T,"map",h,t))}if(null!=l.displacement&&void 0!==a.displacementMap&&r){A.setValue(!0);var c=i+l.name+"/"+l.displacement,h=(new XDTHREE.TextureLoader).load(c);Ne(h),x.execute(new SetMaterialMapCommand(T,"displacementMap",h,t)),null!=u&&null!=u.displacementScale&&x.execute(new SetMaterialValueCommand(T,"displacementScale",u.displacementScale,t))}if(null!=l.bump&&void 0!==a.bumpMap&&r){N.setValue(!0);var c=i+l.name+"/"+l.bump,h=(new XDTHREE.TextureLoader).load(c);Ne(h),x.execute(new SetMaterialMapCommand(T,"bumpMap",h,t)),null!=u&&null!=u.bumpScale&&x.execute(new SetMaterialValueCommand(T,"bumpScale",u.bumpScale,t))}if(null!=l.specular&&void 0!==a.specularMap&&r){F.setValue(!0);var c=i+l.name+"/"+l.specular,h=(new XDTHREE.TextureLoader).load(c);Ne(h),x.execute(new SetMaterialMapCommand(T,"specularMap",h,t))}}}We(),setTimeout(function(){x.signals.objectChanged.dispatch(n)},1e3)}}()}),u=new UI.Button("Clear").onClick(function(){!function(){m.getImage();var e=parseInt(je.getValue()),t=x.getObjectMaterial(T,e);t&&(null!=t.map&&(t.map=null,x.execute(new SetMaterialMapCommand(T,"map",null,e))),void 0!==t.bumpMap&&null!=t.bumpMap&&(t.bumpMap=null,x.execute(new SetMaterialMapCommand(T,"bumpMap",null,e))),void 0!==t.displacementMap&&null!=t.displacementMap&&(t.displacementMap=null,x.execute(new SetMaterialMapCommand(T,"displacementMap",null,e))),void 0!==t.specularMap&&null!=t.specularMap&&(t.specularMap=null,x.execute(new SetMaterialMapCommand(T,"specularMap",null,e))));Te.setValue(1),De.setValue(1),ve.setValue(0),Re.setValue(0),Se.setValue(.5),Xe.setValue(.5),Ue.setValue(0),ke.setValue(!0),We()}()});v.add(l),v.add(u),E.add(v),h.add(E),b=new UI.Row,I=(new UI.Color).onChange(Oe),b.add(new UI.Text("Color").setWidth("90px")),b.add(I),h.add(b),R=new UI.Row,U=new UI.Number(.5).setWidth("60px").setRange(0,1).onChange(Oe),R.add(new UI.Text("Roughness").setWidth("90px")),R.add(U),h.add(R),q=new UI.Row,V=new UI.Number(.5).setWidth("60px").setRange(0,1).onChange(Oe),q.add(new UI.Text("Metalness").setWidth("90px")),q.add(V),h.add(q),$=new UI.Row,S=(new UI.Color).setHexValue(0).onChange(Oe),$.add(new UI.Text("Emissive").setWidth("90px")),$.add(S),h.add($),ee=new UI.Row,M=(new UI.Color).setHexValue(1118481).onChange(Oe),ee.add(new UI.Text("Specular").setWidth("90px")),ee.add(M),h.add(ee),te=new UI.Row,X=new UI.Number(30).onChange(Oe),te.add(new UI.Text("Shininess").setWidth("90px")),te.add(X),h.add(te),ae=new UI.Row,H=new UI.Number(1).setWidth("60px").setRange(0,1).onChange(Oe),ae.add(new UI.Text("ClearCoat").setWidth("90px")),ae.add(H),h.add(ae),ne=new UI.Row,k=new UI.Number(1).setWidth("60px").setRange(0,1).onChange(Oe),ne.add(new UI.Text("ClearCoat Roughness").setWidth("90px")),ne.add(k),h.add(ne),oe=new UI.Row,j=(new UI.Select).setOptions({0:"No",1:"Face",2:"Vertex"}).onChange(Oe),oe.add(new UI.Text("Vertex Colors").setWidth("90px")),oe.add(j),h.add(oe),(re=new UI.Div).dom.style.display="flex",ie=new UI.Row,L=new UI.Checkbox(!1).onChange(Oe),O=(new UI.Texture).onChange(Oe),ie.add(new UI.Text("Image").setWidth("90px")),ie.add(L),ie.add(O),re.add(ie),h.add(re),se=new UI.Row,N=new UI.Checkbox(!1).onChange(Oe),P=(new UI.Texture).onChange(Oe),W=new UI.Number(1).setWidth("30px").onChange(Oe),se.add(new UI.Text("Bump Map").setWidth("90px")),se.add(N),se.add(P),se.add(W),h.add(se),de=new UI.Row,A=new UI.Checkbox(!1).onChange(Oe),B=(new UI.Texture).onChange(Oe),G=new UI.Number(1).setWidth("30px").onChange(Oe),de.add(new UI.Text("Displace Map").setWidth("90px")),de.add(A),de.add(B),de.add(G),h.add(de),le=new UI.Row,F=new UI.Checkbox(!1).onChange(Oe),_=(new UI.Texture).onChange(Oe),le.add(new UI.Text("Specular Map").setWidth("90px")),le.add(F),le.add(_),h.add(le),ue=new UI.Row,z=(new UI.Select).setOptions({0:"Front",1:"Back",2:"Double"}).setWidth("150px").setFontSize("12px").onChange(Oe),ue.add(new UI.Text("Side").setWidth("90px")),ue.add(z),h.add(ue),ce=new UI.Row,J=new UI.Checkbox(!1).setLeft("100px").onChange(Oe),ce.add(new UI.Text("Flat Shaded").setWidth("90px")),ce.add(J),h.add(ce),he=new UI.Row,Y=new UI.Number(1).setWidth("60px").setRange(0,1).onChange(Oe),he.add(new UI.Text("Opacity").setWidth("90px")),he.add(Y),h.add(he),pe=new UI.Row,K=(new UI.Checkbox).setLeft("100px").onChange(Oe),pe.add(new UI.Text("Transparent").setWidth("90px")),pe.add(K),h.add(pe),me=new UI.Row,Z=new UI.Checkbox(!1).onChange(Oe),Q=new UI.Number(1).setWidth("60px").setRange(0,100).onChange(Oe),me.add(new UI.Text("Wireframe").setWidth("90px")),me.add(Z),me.add(Q),h.add(me),h.add(new UI.HorizontalRule),ge=new UI.Row,(we=(new UI.Select).setOptions({1e3:"Repeat",1001:"ClampToEdge",1002:"MirroredRepeat"}).setWidth("150px").setFontSize("12px").onChange(Oe)).setValue(1e3),ge.add(new UI.Text("Wrap S").setWidth("90px")),ge.add(we),h.add(ge),fe=new UI.Row,(ye=(new UI.Select).setOptions({1e3:"Repeat",1001:"ClampToEdge",1002:"MirroredRepeat"}).setWidth("150px").setFontSize("12px").onChange(Oe)).setValue(1e3),fe.add(new UI.Text("Wrap T").setWidth("90px")),fe.add(ye),h.add(fe),Ee=new UI.Row,ve=new UI.Number(0).setRange(0,1).onChange(Oe),Ee.add(new UI.Text("Offset X").setWidth("90px")),Ee.add(ve),h.add(Ee),be=new UI.Row,Re=new UI.Number(0).setRange(0,1).onChange(Oe),be.add(new UI.Text("Offset Y").setWidth("90px")),be.add(Re),h.add(be),xe=new UI.Row,Te=new UI.Number(1).setRange(-25,25).onChange(Oe),xe.add(new UI.Text("Repeat X").setWidth("90px")),xe.add(Te),h.add(xe),Ce=new UI.Row,De=new UI.Number(1).setRange(-25,25).onChange(Oe),Ce.add(new UI.Text("Repeat Y").setWidth("90px")),Ce.add(De),h.add(Ce),Ie=new UI.Row,Ue=new UI.Number(0).setRange(0,360).onChange(Oe),Ie.add(new UI.Text("Rotation").setWidth("90px")),Ie.add(Ue),h.add(Ie),Ve=new UI.Row,Se=new UI.Number(.5).setRange(0,1).onChange(Oe),Ve.add(new UI.Text("Centre X").setWidth("90px")),Ve.add(Se),h.add(Ve),Me=new UI.Row,Xe=new UI.Number(.5).setRange(0,1).onChange(Oe),Me.add(new UI.Text("Centre Y").setWidth("90px")),Me.add(Xe),h.add(Me),He=new UI.Row,ke=new UI.Checkbox(!0).onChange(Oe),He.add(new UI.Text("Flip Y").setWidth("90px")),He.add(ke),h.add(He)}),c.objectSelected.add(function(e){var t=!1;if(e&&e.material&&(t=!0,Array.isArray(e.material)&&0===e.material.length&&(t=!1)),t){var a=e!==T;T=e,We(a),h.setDisplay("")}else T=null,h.setDisplay("none")}),c.materialChanged.add(function(){We()}),h};var xtrad_pluginUrl="",xtrad_uploadUrl="";Sidebar.Animation=function(s){var d=s.signals;xtrad_pluginUrl=xtradDirData.pluginurl,xtrad_uploadUrl=xtradDirData.uploadurl;var l=new UI.Panel;l.setDisplay("none"),l.add(new UI.Text("Animations").setTextTransform("uppercase")),l.add(new UI.Break);var n=new UI.Row;l.add(n);var e=window.location.href,t=e.indexOf("/wp-admin"),a=e.substring(0,t)+"/wp-admin/admin-ajax.php";function u(){n.clear(),n.setDisplay("none");var e=s.selected;null!==e&&null!=e.animations&&(n.setDisplay("block"),function(e){var t=document.querySelector("#animationsdiv");null!=t&&t.parentNode.removeChild(t);var d=new UI.Div;d.dom.id="animationsdiv",n.add(d);for(var a=0;a<e.animations.clip.tracks.length;a++)!function(o,r){var i=r.name,e=i.substring(0,i.lastIndexOf("."));if(e===o.name){var i=new UI.Input(r.name).setWidth("130px").setFontSize("12px");i.onChange(function(){}),d.add(i);var s=new UI.Button("Remove");s.setMarginLeft("4px"),s.onClick(function(){if(confirm("Are you sure?")){var e=r.name,t=o.animations.clip.tracks;if(0<t.length)for(var a=t.length-1;0<=a;--a){var n=t[a].name;e===n&&t.splice(a,1)}d.dom.removeChild(i.dom),d.dom.removeChild(s.dom)}}),d.add(s),d.add(new UI.Break)}}(e,e.animations.clip.tracks[a])}(e))}return jQuery.post(a,{action:"list_files"},function(e){for(var t=JSON.parse(e).animations,a=new UI.Button("Add"),n=new UI.Select,o={None:"None"},r=0;r<t.length;r++){var i=t[r];o[i]=i}n.setOptions(o),0<t.length&&n.setValue("None"),a.onClick(function(){var e=s.selected,t=n.getValue();e.animations={},"None"===t||function(e,a){function t(e,t){animationText=e.responseText,a(animationText)}n=e,o=xtrad_uploadUrl+"/xtrad-library/animations/"+n,jQuery.ajax({url:o,dataType:"text",complete:t});var n,o}(t,function(e){0<e.length&&new XTRADANIMATION.Animation(s).parseAnimation(s.selected,e);u()}),d.animationAdded.add(u),d.animationRemoved.add(u),d.animationChanged.add(u),d.objectSelected.add(function(e){null!==e&&s.camera!==e?(l.setDisplay("block"),u()):l.setDisplay("none")})}),l.add(n),l.add(a)}),d.animationAdded.add(u),d.animationRemoved.add(u),d.animationChanged.add(u),d.objectSelected.add(function(e){null!==e&&s.camera!==e?(l.setDisplay("block"),u()):l.setDisplay("none")}),l},Sidebar.History=function(n){var o=n.signals,r=n.config,s=n.history,e=new UI.Panel;e.add(new UI.Text("HISTORY"));var t=new UI.XDTHREE.Boolean(r.getKey("settings/history"),"persistent");t.setPosition("absolute").setRight("8px"),t.onChange(function(){var e=this.getValue();if(r.setKey("settings/history",e),e){alert("The history will be preserved across sessions.\nThis can have an impact on performance when working with textures.");var t=s.undos[s.undos.length-1],a=void 0!==t?t.id:0;n.history.enableSerialization(a)}else o.historyChanged.dispatch()}),e.add(t),e.add(new UI.Break,new UI.Break);var a=new UI.Outliner(n);a.onChange(function(){!0,n.history.goToState(parseInt(a.getValue())),!1}),e.add(a);var i=function(){var r=[];function i(e){var t=document.createElement("div");return t.value=e.id,t}!function(e){for(var t=0,a=e.length;t<a;t++){var n=e[t],o=i(n);o.innerHTML="&nbsp;"+n.name,r.push(o)}}(s.undos),function(e,t){for(var a=e.length-1;0<=a;a--){var n=e[a],o=i(n);o.innerHTML="&nbsp;"+n.name,o.style.opacity=.3,r.push(o)}}(s.redos),a.setOptions(r)};return i(),o.editorCleared.add(i),o.historyChanged.add(i),o.historyChanged.add(function(e){a.setValue(void 0!==e?e.id:null)}),e},Sidebar.Settings.Shortcuts=function(a){var n=0<=navigator.platform.toUpperCase().indexOf("MAC");function o(e){return e.match(/^[A-Za-z0-9]$/i)}var r=a.config,i=a.signals,s=new UI.Div;s.add(new UI.Break);var e=["translate","rotate","scale","undo","focus"];function t(e){var t="settings/shortcuts/"+e,a=new UI.Row,n=(new UI.Input).setWidth("150px").setFontSize("12px");n.setTextTransform("lowercase"),n.onChange(function(){var e=n.getValue().toLowerCase();o(e)&&r.setKey(t,e)}),n.dom.addEventListener("click",function(){n.dom.select()}),n.dom.addEventListener("blur",function(){o(n.getValue())||n.setValue(r.getKey(t))}),n.dom.addEventListener("keyup",function(e){o(e.key)&&n.dom.blur()}),void 0!==r.getKey(t)&&n.setValue(r.getKey(t)),n.dom.maxLength=1,a.add(new UI.Text(e).setTextTransform("capitalize").setWidth("90px")),a.add(n),s.add(a)}for(var d=0;d<e.length;d++)t(e[d]);return a.container.addEventListener("keydown",function(e){switch(e.key.toLowerCase()){case"backspace":e.preventDefault();case"delete":var t=a.selected;if(null===t)return;null!==t.parent&&a.execute(new RemoveObjectCommand(t));break;case r.getKey("settings/shortcuts/translate"):i.transformModeChanged.dispatch("translate");break;case r.getKey("settings/shortcuts/rotate"):i.transformModeChanged.dispatch("rotate");break;case r.getKey("settings/shortcuts/scale"):i.transformModeChanged.dispatch("scale");break;case r.getKey("settings/shortcuts/undo"):(n?e.metaKey:e.ctrlKey)&&(e.preventDefault(),e.shiftKey?a.redo():a.undo());break;case r.getKey("settings/shortcuts/focus"):null!==a.selected&&a.focus(a.selected)}},!1),s},Sidebar.Settings.Viewport=function(e){var t=e.signals,a=new UI.Div;a.add(new UI.Break),a.add(new UI.Text("Counts").setWidth("90px"));var n=new UI.XDTHREE.Boolean(!0).onChange(s);a.add(n),a.add(new UI.Break),a.add(new UI.Text("Grid").setWidth("90px"));var o=new UI.XDTHREE.Boolean(!0).onChange(s);a.add(o);var r=new UI.Number(5).setWidth("40px").onChange(s);a.add(r);var i=new UI.XDTHREE.Boolean(!1,"snap").onChange(s);function s(){t.showGridChanged.dispatch(o.getValue()),t.showCountsChanged.dispatch(n.getValue()),t.snapChanged.dispatch(!0===i.getValue()?r.getValue():null)}return a.add(i),a};var Toolbar=function(e){var t=e.signals,a=new UI.Panel;a.setId("toolbar");var n=new UI.Panel;a.add(n);var o=new UI.Button("translate");o.dom.title="W",o.dom.className="Button selected",o.onClick(function(){t.transformModeChanged.dispatch("translate")}),n.add(o);var r=new UI.Button("rotate");r.dom.title="E",r.onClick(function(){t.transformModeChanged.dispatch("rotate")}),n.add(r);var i=new UI.Button("scale");i.dom.title="R",i.onClick(function(){t.transformModeChanged.dispatch("scale")}),n.add(i);var s=new UI.XDTHREE.Boolean(!1,"local");return s.onChange(function(){t.spaceChanged.dispatch(!0===this.getValue()?"local":"world")}),n.add(s),t.objectSelected.add(function(e){a.setDisplay(null===e?"none":"")}),t.transformModeChanged.add(function(e){switch(o.dom.classList.remove("selected"),r.dom.classList.remove("selected"),i.dom.classList.remove("selected"),e){case"translate":o.dom.classList.add("selected");break;case"rotate":r.dom.classList.add("selected");break;case"scale":i.dom.classList.add("selected")}}),a},Viewport=function(a){var o=a.signals,r=new UI.Panel;r.setId("viewport"),r.setPosition("absolute"),r.add(new Viewport.Info(a));var t=null,n=a.camera,i=a.scene,e=a.sceneHelpers,s=[],d=new XDTHREE.GridHelper(50,50,4473924,8947848);e.add(d);for(var l=d.geometry.attributes.color.array,u=0;u<l.length;u+=60)for(var c=0;c<12;c++)l[u+c]=.26;var h=new XDTHREE.Box3,p=new XDTHREE.BoxHelper;p.material.depthTest=!1,p.material.transparent=!0,p.visible=!1,e.add(p);var m=null,g=null,w=null,f=new XDTHREE.TransformControls(n,r.dom);f.addEventListener("change",function(){var e=f.object;void 0!==e&&(p.setFromObject(e),void 0!==a.helpers[e.id]&&a.helpers[e.id].update(),o.refreshSidebarObject3D.dispatch(e)),S()}),f.addEventListener("mouseDown",function(){var e=f.object;m=e.position.clone(),g=e.rotation.clone(),w=e.scale.clone(),U.enabled=!1}),f.addEventListener("mouseUp",function(){var e=f.object;if(void 0!==e)switch(f.getMode()){case"translate":m.equals(e.position)||a.execute(new SetPositionCommand(e,e.position,m));break;case"rotate":g.equals(e.rotation)||a.execute(new SetRotationCommand(e,e.rotation,g));break;case"scale":w.equals(e.scale)||a.execute(new SetScaleCommand(e,e.scale,w))}U.enabled=!0}),e.add(f);var y=new XDTHREE.Raycaster,E=new XDTHREE.Vector2;function v(e,t){return E.set(2*e.x-1,-2*e.y+1),y.setFromCamera(E,n),y.intersectObjects(t)}var b=new XDTHREE.Vector2,R=new XDTHREE.Vector2,x=new XDTHREE.Vector2;function T(e,t,a){var n=e.getBoundingClientRect();return[(t-n.left)/n.width,(a-n.top)/n.height]}function C(){if(0===b.distanceTo(R)){var e=v(R,s);if(0<e.length){var t=e[0].object;void 0!==t.userData.object?a.select(t.userData.object):a.select(t)}else a.select(null);S()}}function D(e){var t=T(r.dom,e.clientX,e.clientY);R.fromArray(t),C(),document.removeEventListener("mouseup",D,!1)}function I(e){var t=e.changedTouches[0],a=T(r.dom,t.clientX,t.clientY);R.fromArray(a),C(),document.removeEventListener("touchend",I,!1)}r.dom.addEventListener("mousedown",function(e){var t=T(r.dom,e.clientX,e.clientY);b.fromArray(t),document.addEventListener("mouseup",D,!1)},!1),r.dom.addEventListener("touchstart",function(e){var t=e.changedTouches[0],a=T(r.dom,t.clientX,t.clientY);b.fromArray(a),document.addEventListener("touchend",I,!1)},!1),r.dom.addEventListener("dblclick",function(e){var t=T(r.dom,e.clientX,e.clientY);x.fromArray(t);var a=v(x,s);if(0<a.length){var n=a[0];o.objectFocused.dispatch(n.object)}},!1);var U=new XDTHREE.EditorControls(n,r.dom);U.addEventListener("change",function(){o.cameraChanged.dispatch(n)}),o.editorCleared.add(function(){U.center.set(0,0,0),S()}),o.transformModeChanged.add(function(e){f.setMode(e)}),o.snapChanged.add(function(e){f.setTranslationSnap(e)}),o.spaceChanged.add(function(e){f.setSpace(e)}),o.rendererChanged.add(function(e){null!==t&&r.dom.removeChild(t.domElement),(t=e).autoClear=!1,t.autoUpdateScene=!1,t.gammaInput=!0,t.gammaOutput=!0,t.setPixelRatio(window.devicePixelRatio),t.shadowMap.enbled=!0,t.setSize(r.dom.offsetWidth,r.dom.offsetHeight),r.dom.appendChild(t.domElement),S()}),o.sceneGraphChanged.add(function(){S()}),o.sceneCapture.add(function(){t.render(i,n);var e=document.getElementById("editorcanvasid").toDataURL().replace("image/png","image/octet-stream");xtrad_Viewer.config.setKey("project/image",btoa(e))}),o.cameraChanged.add(function(){S()}),o.objectSelected.add(function(e){p.visible=!1,f.detach(),null!==e&&e!==i&&e!==n&&(h.setFromObject(e),!1===h.isEmpty()&&(p.setFromObject(e),p.visible=!0),f.attach(e)),S()}),o.objectFocused.add(function(e){U.focus(e)}),o.geometryChanged.add(function(e){void 0!==e&&p.setFromObject(e),S()}),o.objectAdded.add(function(e){e.traverse(function(e){s.push(e)})}),o.objectChanged.add(function(e){a.selected===e&&p.setFromObject(e),e.isPerspectiveCamera&&e.updateProjectionMatrix(),void 0!==a.helpers[e.id]&&a.helpers[e.id].update(),S()}),o.objectRemoved.add(function(e){U.enabled=!0,e===f.object&&f.detach(),e.traverse(function(e){s.splice(s.indexOf(e),1)})}),o.helperAdded.add(function(e){s.push(e.getObjectByName("picker"))}),o.helperRemoved.add(function(e){s.splice(s.indexOf(e.getObjectByName("picker")),1)}),o.materialChanged.add(function(e){S()}),o.sceneBackgroundChanged.add(function(e){e instanceof XTRADVIEWER.Background?i.background=e:e instanceof XDTHREE.CubeTexture&&(i.background=new XTRADVIEWER.Background("editor"),i.background.createCubeTextureBackground(e)),S()});var V=null;function S(){i.updateMatrixWorld(),t.render(i,n),null!=XDTHREE.RaytracingRenderer&&t instanceof XDTHREE.RaytracingRenderer!=!1||(e.updateMatrixWorld(),t.render(e,n))}return o.sceneFogChanged.add(function(e,t,a,n,o){if(V!==e){switch(e){case"None":i.fog=null;break;case"Fog":i.fog=new XDTHREE.Fog;break;case"FogExp2":i.fog=new XDTHREE.FogExp2}V=e}i.fog.isFog?(i.fog.color.setHex(t),i.fog.near=a,i.fog.far=n):i.fog.isFogExp2&&(i.fog.color.setHex(t),i.fog.density=o),S()}),o.windowResize.add(function(){a.DEFAULT_CAMERA.aspect=r.dom.offsetWidth/r.dom.offsetHeight,a.DEFAULT_CAMERA.updateProjectionMatrix(),n.aspect=r.dom.offsetWidth/r.dom.offsetHeight,n.updateProjectionMatrix(),t.setSize(r.dom.offsetWidth,r.dom.offsetHeight),S()}),o.showGridChanged.add(function(e){d.visible=e,S()}),r};Viewport.Info=function(i){var e=i.signals,t=new UI.Panel;t.setId("info"),t.setPosition("absolute"),t.setLeft("10px"),t.setBottom("10px"),t.setFontSize("12px"),t.setColor("#fff");var a=new UI.Div;t.add(a),a.dom.style.display=i.showCounts?"block":"none";var s=new UI.Text("0").setMarginLeft("6px"),d=new UI.Text("0").setMarginLeft("6px"),l=new UI.Text("0").setMarginLeft("6px");function n(){for(var e=i.scene,a=0,n=0,o=0,t=0,r=e.children.length;t<r;t++){e.children[t].traverseVisible(function(e){if(a++,e.isMesh){var t=e.geometry;t.isGeometry?(n+=t.vertices.length,o+=t.faces.length):t.isBufferGeometry&&(n+=t.attributes.position.count,null!==t.index?o+=t.index.count/3:o+=t.attributes.position.count/3)}})}s.setValue(a.format()),d.setValue(n.format()),l.setValue(o.format())}return a.add(new UI.Text("objects"),s,new UI.Break),a.add(new UI.Text("vertices"),d,new UI.Break),a.add(new UI.Text("triangles"),l,new UI.Break),e.objectAdded.add(n),e.objectRemoved.add(n),e.geometryChanged.add(n),e.showCountsChanged.add(function(e){i.showCounts=e,a.dom.style.display=i.showCounts?"block":"none"}),t};var Command=function(e){this.id=-1,this.inMemory=!1,this.updatable=!1,this.type="",this.name="",void 0!==e&&(Command.editor=e),this.editor=Command.editor};Command.prototype.toJSON=function(){var e={};return e.type=this.type,e.id=this.id,e.name=this.name,e},Command.prototype.fromJSON=function(e){this.inMemory=!0,this.type=e.type,this.id=e.id,this.name=e.name};var AddObjectCommand=function(e){Command.call(this),this.type="AddObjectCommand",void 0!==(this.object=e)&&(this.name="Add Object: "+e.name)};AddObjectCommand.prototype={execute:function(){this.editor.addObject(this.object),this.editor.select(this.object)},undo:function(){this.editor.removeObject(this.object),this.editor.deselect()},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.object=this.object.toJSON(),e},fromJSON:function(e){if(Command.prototype.fromJSON.call(this,e),this.object=this.editor.objectByUuid(e.object.object.uuid),void 0===this.object){var t=new XDTHREE.ObjectLoader;this.object=t.parse(e.object)}}};var RemoveObjectCommand=function(e){Command.call(this),this.type="RemoveObjectCommand",this.name="Remove Object",this.object=e,this.parent=void 0!==e?e.parent:void 0,void 0!==this.parent&&(this.index=this.parent.children.indexOf(this.object))};RemoveObjectCommand.prototype={execute:function(){var t=this.editor;this.object.traverse(function(e){t.removeHelper(e)}),this.parent.remove(this.object),this.editor.select(this.parent),this.editor.signals.objectRemoved.dispatch(this.object),this.editor.signals.sceneGraphChanged.dispatch()},undo:function(){var t=this.editor;this.object.traverse(function(e){void 0!==e.geometry&&t.addGeometry(e.geometry),void 0!==e.material&&t.addMaterial(e.material),t.addHelper(e)}),this.parent.children.splice(this.index,0,this.object),this.object.parent=this.parent,this.editor.select(this.object),this.editor.signals.objectAdded.dispatch(this.object),this.editor.signals.sceneGraphChanged.dispatch()},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.object=this.object.toJSON(),e.index=this.index,e.parentUuid=this.parent.uuid,e},fromJSON:function(e){if(Command.prototype.fromJSON.call(this,e),this.parent=this.editor.objectByUuid(e.parentUuid),void 0===this.parent&&(this.parent=this.editor.scene),this.index=e.index,this.object=this.editor.objectByUuid(e.object.object.uuid),void 0===this.object){var t=new XDTHREE.ObjectLoader;this.object=t.parse(e.object)}}};var MoveObjectCommand=function(e,t,a){Command.call(this),this.type="MoveObjectCommand",this.name="Move Object",this.object=e,this.oldParent=void 0!==e?e.parent:void 0,this.oldIndex=void 0!==this.oldParent?this.oldParent.children.indexOf(this.object):void 0,this.newParent=t,this.newIndex=void 0!==a?void 0!==t?t.children.indexOf(a):void 0:void 0!==t?t.children.length:void 0,this.oldParent===this.newParent&&this.newIndex>this.oldIndex&&this.newIndex--,this.newBefore=a};MoveObjectCommand.prototype={execute:function(){this.oldParent.remove(this.object),this.newParent.children.splice(this.newIndex,0,this.object),this.object.parent=this.newParent,this.editor.signals.sceneGraphChanged.dispatch()},undo:function(){this.newParent.remove(this.object),this.oldParent.children.splice(this.oldIndex,0,this.object),this.object.parent=this.oldParent,this.editor.signals.sceneGraphChanged.dispatch()},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.newParentUuid=this.newParent.uuid,e.oldParentUuid=this.oldParent.uuid,e.newIndex=this.newIndex,e.oldIndex=this.oldIndex,e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldParent=this.editor.objectByUuid(e.oldParentUuid),void 0===this.oldParent&&(this.oldParent=this.editor.scene),this.newParent=this.editor.objectByUuid(e.newParentUuid),void 0===this.newParent&&(this.newParent=this.editor.scene),this.newIndex=e.newIndex,this.oldIndex=e.oldIndex}};var SetPositionCommand=function(e,t,a){Command.call(this),this.type="SetPositionCommand",this.name="Set Position",this.updatable=!0,void 0!==(this.object=e)&&void 0!==t&&(this.oldPosition=e.position.clone(),this.newPosition=t.clone()),void 0!==a&&(this.oldPosition=a.clone())};SetPositionCommand.prototype={execute:function(){this.object.position.copy(this.newPosition),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object)},undo:function(){this.object.position.copy(this.oldPosition),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object)},update:function(e){this.newPosition.copy(e.newPosition)},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.oldPosition=this.oldPosition.toArray(),e.newPosition=this.newPosition.toArray(),e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldPosition=(new XDTHREE.Vector3).fromArray(e.oldPosition),this.newPosition=(new XDTHREE.Vector3).fromArray(e.newPosition)}};var SetRotationCommand=function(e,t,a){Command.call(this),this.type="SetRotationCommand",this.name="Set Rotation",this.updatable=!0,void 0!==(this.object=e)&&void 0!==t&&(this.oldRotation=e.rotation.clone(),this.newRotation=t.clone()),void 0!==a&&(this.oldRotation=a.clone())};SetRotationCommand.prototype={execute:function(){this.object.rotation.copy(this.newRotation),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object)},undo:function(){this.object.rotation.copy(this.oldRotation),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object)},update:function(e){this.newRotation.copy(e.newRotation)},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.oldRotation=this.oldRotation.toArray(),e.newRotation=this.newRotation.toArray(),e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldRotation=(new XDTHREE.Euler).fromArray(e.oldRotation),this.newRotation=(new XDTHREE.Euler).fromArray(e.newRotation)}};var SetScaleCommand=function(e,t,a){Command.call(this),this.type="SetScaleCommand",this.name="Set Scale",this.updatable=!0,void 0!==(this.object=e)&&void 0!==t&&(this.oldScale=e.scale.clone(),this.newScale=t.clone()),void 0!==a&&(this.oldScale=a.clone())};SetScaleCommand.prototype={execute:function(){this.object.scale.copy(this.newScale),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object)},undo:function(){this.object.scale.copy(this.oldScale),this.object.updateMatrixWorld(!0),this.editor.signals.objectChanged.dispatch(this.object)},update:function(e){this.newScale.copy(e.newScale)},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.oldScale=this.oldScale.toArray(),e.newScale=this.newScale.toArray(),e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldScale=(new XDTHREE.Vector3).fromArray(e.oldScale),this.newScale=(new XDTHREE.Vector3).fromArray(e.newScale)}};var SetValueCommand=function(e,t,a){Command.call(this),this.type="SetValueCommand",this.name="Set "+t,this.updatable=!0,this.object=e,this.attributeName=t,this.oldValue=void 0!==e?e[t]:void 0,this.newValue=a};SetValueCommand.prototype={execute:function(){this.object[this.attributeName]=this.newValue,this.editor.signals.objectChanged.dispatch(this.object)},undo:function(){this.object[this.attributeName]=this.oldValue,this.editor.signals.objectChanged.dispatch(this.object)},update:function(e){this.newValue=e.newValue},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue,this.object=this.editor.objectByUuid(e.objectUuid)}};var SetUuidCommand=function(e,t){Command.call(this),this.type="SetUuidCommand",this.name="Update UUID",this.object=e,this.oldUuid=void 0!==e?e.uuid:void 0,this.newUuid=t};SetUuidCommand.prototype={execute:function(){this.object.uuid=this.newUuid,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.sceneGraphChanged.dispatch()},undo:function(){this.object.uuid=this.oldUuid,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.sceneGraphChanged.dispatch()},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.oldUuid=this.oldUuid,e.newUuid=this.newUuid,e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e),this.oldUuid=e.oldUuid,this.newUuid=e.newUuid,this.object=this.editor.objectByUuid(e.oldUuid),void 0===this.object&&(this.object=this.editor.objectByUuid(e.newUuid))}};var SetColorCommand=function(e,t,a){Command.call(this),this.type="SetColorCommand",this.name="Set "+t,this.updatable=!0,this.object=e,this.attributeName=t,this.oldValue=void 0!==e?this.object[this.attributeName].getHex():void 0,this.newValue=a};SetColorCommand.prototype={execute:function(){this.object[this.attributeName].setHex(this.newValue),this.editor.signals.objectChanged.dispatch(this.object)},undo:function(){this.object[this.attributeName].setHex(this.oldValue),this.editor.signals.objectChanged.dispatch(this.object)},update:function(e){this.newValue=e.newValue},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue}};var SetGeometryCommand=function(e,t){Command.call(this),this.type="SetGeometryCommand",this.name="Set Geometry",this.updatable=!0,this.object=e,this.oldGeometry=void 0!==e?e.geometry:void 0,this.newGeometry=t};SetGeometryCommand.prototype={execute:function(){this.object.geometry.dispose(),this.object.geometry=this.newGeometry,this.object.geometry.computeBoundingSphere(),this.editor.signals.geometryChanged.dispatch(this.object),this.editor.signals.sceneGraphChanged.dispatch()},undo:function(){this.object.geometry.dispose(),this.object.geometry=this.oldGeometry,this.object.geometry.computeBoundingSphere(),this.editor.signals.geometryChanged.dispatch(this.object),this.editor.signals.sceneGraphChanged.dispatch()},update:function(e){this.newGeometry=e.newGeometry},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.oldGeometry=this.object.geometry.toJSON(),e.newGeometry=this.newGeometry.toJSON(),e},fromJSON:function(e){function t(e){return(new XDTHREE.ObjectLoader).parseGeometries([e])[e.uuid]}Command.prototype.fromJSON.call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldGeometry=t(e.oldGeometry),this.newGeometry=t(e.newGeometry)}};var SetGeometryValueCommand=function(e,t,a){Command.call(this),this.type="SetGeometryValueCommand",this.name="Set Geometry."+t,this.object=e,this.attributeName=t,this.oldValue=void 0!==e?e.geometry[t]:void 0,this.newValue=a};SetGeometryValueCommand.prototype={execute:function(){this.object.geometry[this.attributeName]=this.newValue,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.geometryChanged.dispatch(),this.editor.signals.sceneGraphChanged.dispatch()},undo:function(){this.object.geometry[this.attributeName]=this.oldValue,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.geometryChanged.dispatch(),this.editor.signals.sceneGraphChanged.dispatch()},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue}};var MultiCmdsCommand=function(e){Command.call(this),this.type="MultiCmdsCommand",this.name="Multiple Changes",this.cmdArray=void 0!==e?e:[]};MultiCmdsCommand.prototype={execute:function(){this.editor.signals.sceneGraphChanged.active=!1;for(var e=0;e<this.cmdArray.length;e++)this.cmdArray[e].execute();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch()},undo:function(){this.editor.signals.sceneGraphChanged.active=!1;for(var e=this.cmdArray.length-1;0<=e;e--)this.cmdArray[e].undo();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch()},toJSON:function(){for(var e=Command.prototype.toJSON.call(this),t=[],a=0;a<this.cmdArray.length;a++)t.push(this.cmdArray[a].toJSON());return e.cmds=t,e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e);for(var t=e.cmds,a=0;a<t.length;a++){var n=new window[t[a].type];n.fromJSON(t[a]),this.cmdArray.push(n)}}};var AddScriptCommand=function(e,t){Command.call(this),this.type="AddScriptCommand",this.name="Add Script",this.object=e,this.script=t};AddScriptCommand.prototype={execute:function(){void 0===this.editor.scripts[this.object.uuid]&&(this.editor.scripts[this.object.uuid]=[]),this.editor.scripts[this.object.uuid].push(this.script),this.editor.signals.scriptAdded.dispatch(this.script)},undo:function(){if(void 0!==this.editor.scripts[this.object.uuid]){var e=this.editor.scripts[this.object.uuid].indexOf(this.script);-1!==e&&this.editor.scripts[this.object.uuid].splice(e,1),this.editor.signals.scriptRemoved.dispatch(this.script)}},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.script=this.script,e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e),this.script=e.script,this.object=this.editor.objectByUuid(e.objectUuid)}};var AddAnimationCommand=function(e,t){Command.call(this),this.type="AddAnimationCommand",this.name="Add Animation",this.object=e,this.tracks=t};AddAnimationCommand.prototype={execute:function(){this.editor.signals.animationAdded.dispatch(this.tracks)},undo:function(){if(void 0!==this.editor.tracks[this.object.uuid]){var e=this.editor.tracks[this.object.uuid].indexOf(this.tracks);-1!==e&&this.editor.tracks[this.object.uuid].splice(e,1),this.editor.signals.animationRemoved.dispatch(this.tracks)}},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.animations=JSON.stringify(this.tracks),e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e),this.tracks=e.tracks,this.object=this.editor.objectByUuid(e.objectUuid)}};var RemoveScriptCommand=function(e,t){Command.call(this),this.type="RemoveScriptCommand",this.name="Remove Script",this.object=e,this.script=t,this.object&&this.script&&null!=this.editor.scripts[this.object.uuid]&&(this.index=this.editor.scripts[this.object.uuid].indexOf(this.script))};RemoveScriptCommand.prototype={execute:function(){void 0!==this.editor.scripts[this.object.uuid]&&(-1!==this.index&&this.editor.scripts[this.object.uuid].splice(this.index,1),this.editor.signals.scriptRemoved.dispatch(this.script))},undo:function(){void 0===this.editor.scripts[this.object.uuid]&&(this.editor.scripts[this.object.uuid]=[]),this.editor.scripts[this.object.uuid].splice(this.index,0,this.script),this.editor.signals.scriptAdded.dispatch(this.script)},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.script=this.script,e.index=this.index,e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e),this.script=e.script,this.index=e.index,this.object=this.editor.objectByUuid(e.objectUuid)}};var RemoveScriptByNameCommand=function(e,t){Command.call(this),this.type="RemoveScriptByNameCommand",this.name="Remove Script By Name",this.object=e,this.name=t,this.script="",this.index=-1};RemoveScriptByNameCommand.prototype={execute:function(){if(void 0!==this.editor.scripts[this.object.uuid]){var e=this.editor.scripts[this.object.uuid];if(null!=e){for(var t=e.length-1;0<=t;--t){e[t].name===this.name&&(this.script=e.splice(t,1),this.index=t,this.editor.signals.scriptRemoved.dispatch(this.script))}0===e.length&&delete editor.scripts[this.object.uuid]}}},undo:function(){void 0===this.editor.scripts[this.object.uuid]&&(this.editor.scripts[this.object.uuid]=[]),this.editor.scripts[this.object.uuid].splice(this.index,0,this.script),this.editor.signals.scriptAdded.dispatch(this.script)},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.script=this.script,e.index=this.index,e.name=this.name,e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e),this.script=e.script,this.index=e.index,this.object=this.editor.objectByUuid(e.objectUuid),this.name=e.name}};var SetScriptValueCommand=function(e,t,a,n){Command.call(this),this.type="SetScriptValueCommand",this.name="Set Script."+a,this.updatable=!0,this.object=e,this.script=t,this.attributeName=a,this.oldValue=void 0!==t?t[this.attributeName]:void 0,this.newValue=n};SetScriptValueCommand.prototype={execute:function(){this.script[this.attributeName]=this.newValue,this.editor.signals.scriptChanged.dispatch()},undo:function(){this.script[this.attributeName]=this.oldValue,this.editor.signals.scriptChanged.dispatch()},update:function(e){this.newValue=e.newValue},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.index=this.editor.scripts[this.object.uuid].indexOf(this.script),e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e),this.oldValue=e.oldValue,this.newValue=e.newValue,this.attributeName=e.attributeName,this.object=this.editor.objectByUuid(e.objectUuid),this.script=this.editor.scripts[e.objectUuid][e.index]}};var SetMaterialCommand=function(e,t,a){Command.call(this),this.type="SetMaterialCommand",this.name="New Material",this.object=e,this.materialSlot=a,this.oldMaterial=this.editor.getObjectMaterial(e,a),this.newMaterial=t};SetMaterialCommand.prototype={execute:function(){this.editor.setObjectMaterial(this.object,this.materialSlot,this.newMaterial),this.editor.signals.materialChanged.dispatch(this.newMaterial)},undo:function(){this.editor.setObjectMaterial(this.object,this.materialSlot,this.oldMaterial),this.editor.signals.materialChanged.dispatch(this.oldMaterial)},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.oldMaterial=this.oldMaterial.toJSON(),e.newMaterial=this.newMaterial.toJSON(),e},fromJSON:function(e){function t(e){var t=new XDTHREE.ObjectLoader,a=t.parseImages(e.images),n=t.parseTextures(e.textures,a);return t.parseMaterials([e],n)[e.uuid]}Command.prototype.fromJSON.call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.oldMaterial=t(e.oldMaterial),this.newMaterial=t(e.newMaterial)}};var SetMaterialValueCommand=function(e,t,a,n){Command.call(this),this.type="SetMaterialValueCommand",this.name="Set Material."+t,this.updatable=!0,this.object=e,this.material=this.editor.getObjectMaterial(e,n),this.oldValue=void 0!==this.material?this.material[t]:void 0,this.newValue=a,this.attributeName=t};SetMaterialValueCommand.prototype={execute:function(){this.material[this.attributeName]=this.newValue,this.material.needsUpdate=!0,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.materialChanged.dispatch(this.material)},undo:function(){this.material[this.attributeName]=this.oldValue,this.material.needsUpdate=!0,this.editor.signals.objectChanged.dispatch(this.object),this.editor.signals.materialChanged.dispatch(this.material)},update:function(e){this.newValue=e.newValue},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue,this.object=this.editor.objectByUuid(e.objectUuid)}};var SetMaterialColorCommand=function(e,t,a,n){Command.call(this),this.type="SetMaterialColorCommand",this.name="Set Material."+t,this.updatable=!0,this.object=e,this.material=this.editor.getObjectMaterial(e,n),this.oldValue=void 0!==this.material?this.material[t].getHex():void 0,this.newValue=a,this.attributeName=t};SetMaterialColorCommand.prototype={execute:function(){this.material[this.attributeName].setHex(this.newValue),this.editor.signals.materialChanged.dispatch(this.material)},undo:function(){this.material[this.attributeName].setHex(this.oldValue),this.editor.signals.materialChanged.dispatch(this.material)},update:function(e){this.newValue=e.newValue},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.attributeName=this.attributeName,e.oldValue=this.oldValue,e.newValue=this.newValue,e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.attributeName=e.attributeName,this.oldValue=e.oldValue,this.newValue=e.newValue}};var SetMaterialMapCommand=function(e,t,a,n){Command.call(this),this.type="SetMaterialMapCommand",this.name="Set Material."+t,this.object=e,this.material=this.editor.getObjectMaterial(e,n),this.oldMap=void 0!==e?this.material[t]:void 0,this.newMap=a,this.mapName=t};SetMaterialMapCommand.prototype={execute:function(){this.material[this.mapName]=this.newMap,this.material.needsUpdate=!0,this.editor.signals.materialChanged.dispatch(this.material)},undo:function(){this.material[this.mapName]=this.oldMap,this.material.needsUpdate=!0,this.editor.signals.materialChanged.dispatch(this.material)},toJSON:function(){var e=Command.prototype.toJSON.call(this);return e.objectUuid=this.object.uuid,e.mapName=this.mapName,e.newMap=t(this.newMap),e.oldMap=t(this.oldMap),e;function t(e){if(null==e)return null;var t={geometries:{},materials:{},textures:{},images:{}},a=e.toJSON(t),n=function(e){var t=[];for(var a in e){var n=e[a];delete n.metadata,t.push(n)}return t}(t.images);return 0<n.length&&(a.images=n),a.sourceFile=e.sourceFile,a}},fromJSON:function(e){function t(e){var t=null;if(null!==e){var a=new XDTHREE.ObjectLoader,n=a.parseImages(e.images);(t=a.parseTextures([e],n)[e.uuid]).sourceFile=e.sourceFile}return t}Command.prototype.fromJSON.call(this,e),this.object=this.editor.objectByUuid(e.objectUuid),this.mapName=e.mapName,this.oldMap=t(e.oldMap),this.newMap=t(e.newMap)}};var SetSceneCommand=function(e){if(Command.call(this),this.type="SetSceneCommand",this.name="Set Scene",this.cmdArray=[],void 0!==e)for(this.cmdArray.push(new SetUuidCommand(this.editor.scene,e.uuid)),this.cmdArray.push(new SetValueCommand(this.editor.scene,"name",e.name)),this.cmdArray.push(new SetValueCommand(this.editor.scene,"userData",JSON.parse(JSON.stringify(e.userData))));0<e.children.length;){var t=e.children.pop();this.cmdArray.push(new AddObjectCommand(t))}};SetSceneCommand.prototype={execute:function(){this.editor.signals.sceneGraphChanged.active=!1;for(var e=0;e<this.cmdArray.length;e++)this.cmdArray[e].execute();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch()},undo:function(){this.editor.signals.sceneGraphChanged.active=!1;for(var e=this.cmdArray.length-1;0<=e;e--)this.cmdArray[e].undo();this.editor.signals.sceneGraphChanged.active=!0,this.editor.signals.sceneGraphChanged.dispatch()},toJSON:function(){for(var e=Command.prototype.toJSON.call(this),t=[],a=0;a<this.cmdArray.length;a++)t.push(this.cmdArray[a].toJSON());return e.cmds=t,e},fromJSON:function(e){Command.prototype.fromJSON.call(this,e);for(var t=e.cmds,a=0;a<t.length;a++){var n=new window[t[a].type];n.fromJSON(t[a]),this.cmdArray.push(n)}}},XDTHREE.RaytracingRenderer=function(a){console.log("THREE.RaytracingRenderer",XDTHREE.REVISION),a=a||{};var r,i,s=this,d=[],l=!1,n=document.createElement("canvas"),u=n.getContext("2d",{alpha:!0===a.alpha}),t=new XDTHREE.Color(0);this.domElement=n,this.autoClear=!0;var o=a.workers,c=a.blockSize||64;this.randomize=a.randomize;var h,p,m,g=[],w=0,f=0;function y(e){e.postMessage({init:[r,i],worker:e.id,blockSize:c})}function E(e){if(!g.length)return l=!1,s.dispatchEvent({type:"complete"});var t=g.pop(),a=t%p*c,n=(t/p|0)*c;e.postMessage({render:!0,x:a,y:n,sceneId:f}),u.fillStyle="#"+e.color,u.fillRect(a,n,c,c)}console.log("%cSpinning off "+o+" Workers ","font-size: 20px; background: black; color: white; font-family: monospace;"),this.setWorkers=function(e){for(o=e||navigator.hardwareConcurrency||4;d.length<o;){var t=new Worker(a.workerPath);t.id=w++,t.onmessage=function(e){var t=e.data;if(t&&t.blockSize&&f==t.sceneId){var a=new ImageData(new Uint8ClampedArray(t.data),t.blockSize,t.blockSize);if(u.putImageData(a,t.blockX,t.blockY),console.log("Worker "+this.id,t.time/1e3,(Date.now()-R)/1e3+" s"),d.length>o)return d.splice(d.indexOf(this),1),this.terminate();E(this)}},t.color=(new XDTHREE.Color).setHSL(Math.random(),.8,.8).getHexString(),d.push(t),y(t),l&&(t.postMessage({scene:v,camera:b,annex:x,sceneId:f}),E(t))}if(!l)for(;d.length>o;)d.pop().terminate()},this.setWorkers(o),this.setClearColor=function(e){t.set(e)},this.setPixelRatio=function(){},this.setSize=function(e,t){n.width=e,n.height=t,r=n.width,i=n.height,u.fillStyle="white",d.forEach(y)},this.setSize(n.width,n.height),this.clear=function(){};var v,b,R,x={},T={mirror:1,reflectivity:1,refractionRatio:1,glass:1};function C(e){var t=e.material;if(t&&!(t.uuid in x)){var a={};for(var n in T)void 0!==t[n]&&(a[n]=t[n]);x[t.uuid]=a}}this.render=function(e,t){(l=!0)===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),v=e.toJSON(),b=t.toJSON(),++f,e.traverse(C),d.forEach(function(e){e.postMessage({scene:v,camera:b,annex:x,sceneId:f})}),u.clearRect(0,0,r,i),R=Date.now(),p=Math.ceil(r/c),m=Math.ceil(i/c),h=p*m,g=[];for(var a=0;a<h;a++)g.push(a);if(s.randomize)for(a=0;a<h;a++){var n=Math.random()*h|0,o=g[n];g[n]=g[a],g[a]=o}d.forEach(E)}},Object.assign(XDTHREE.RaytracingRenderer.prototype,XDTHREE.EventDispatcher.prototype);var BLOCK=128,startX,startY,scene,camera,renderer,loader,sceneId;self.onmessage=function(e){var t=e.data;if(t){if(t.init){var a=t.init[0],n=t.init[1];BLOCK=t.blockSize,renderer||(renderer=new XDTHREE.RaytracingRendererWorker),loader||(loader=new XDTHREE.ObjectLoader),renderer.setSize(a,n)}if(t.scene){scene=loader.parse(t.scene),camera=loader.parse(t.camera);var o=t.annex;scene.traverse(function(e){e.isPointLight&&(e.physicalAttenuation=!0);var t=e.material;if(t){var a=o[t.uuid];for(var n in a)t[n]=a[n]}}),sceneId=t.sceneId}t.render&&scene&&camera&&(startX=t.x,startY=t.y,renderer.render(scene,camera))}},XDTHREE.RaytracingRendererWorker=function(){console.log("THREE.RaytracingRendererWorker",XDTHREE.REVISION);var a,n,r,i,s,G,d=new XDTHREE.Vector3,l=new XDTHREE.Vector3,u=new XDTHREE.Vector3,F=new XDTHREE.Raycaster(d,l),_=F.ray,z=new XDTHREE.Raycaster,J=z.ray,c=new XDTHREE.Matrix3,Y=[],K={};this.setSize=function(e,t){a=e,n=t,r=Math.floor(a/2),i=Math.floor(n/2)};var m,g,w,h,p,f,y=function(){for(var S=new XDTHREE.Color,M=new XDTHREE.Color,X=new XDTHREE.Color,H=new XDTHREE.Color,k=new XDTHREE.Color,j=new XDTHREE.Vector3,L=new XDTHREE.Vector3,O=new XDTHREE.Vector3,N=new XDTHREE.Vector3,P=new XDTHREE.Vector3,W=new XDTHREE.Vector3,A=new XDTHREE.Vector3,B=[],e=0;e<3;e++)B[e]=new XDTHREE.Color;return function e(t,a,n,o){if(n.setRGB(0,0,0),_.origin=t,_.direction=a,0!==(w=F.intersectObjects(G,!0)).length){var r=w[0],i=r.point,s=r.object,d=s.material,l=r.face,u=s.geometry.vertices,c=K[s.id];if(j.subVectors(_.origin,i).normalize(),d.isMeshLambertMaterial||d.isMeshPhongMaterial||d.isMeshBasicMaterial?S.copyGammaToLinear(d.color):S.setRGB(1,1,1),d.vertexColors===XDTHREE.FaceColors&&S.multiply(l.color),J.origin.copy(i),d.isMeshBasicMaterial)for(var h=0,p=Y.length;h<p;h++){var m=Y[h];L.setFromMatrixPosition(m.matrixWorld),L.sub(i),J.direction.copy(L).normalize(),0<(w=z.intersectObjects(G,!0)).length||n.add(S)}else if(d.isMeshLambertMaterial||d.isMeshPhongMaterial){var g=!1;for(h=0,p=Y.length;h<p;h++){var w;m=Y[h];if(L.setFromMatrixPosition(m.matrixWorld),L.sub(i),J.direction.copy(L).normalize(),!(0<(w=z.intersectObjects(G,!0)).length)){!1===g&&(P.copy(i).applyMatrix4(c.inverseMatrix),Z(O,P,d.flatShading,l,u),O.applyMatrix3(c.normalMatrix).normalize(),g=!0),X.copyGammaToLinear(m.color);var f=1;!0===m.physicalAttenuation&&(f=1/((f=L.length())*f)),L.normalize();var y=Math.max(O.dot(L),0)*m.intensity;if(k.copy(S),k.multiply(X),k.multiplyScalar(y*f),n.add(k),d.isMeshPhongMaterial){N.addVectors(L,j).normalize();var E=Math.max(O.dot(N),0),v=Math.max(Math.pow(E,d.shininess),0)*y,b=(d.shininess+2)/8;M.copyGammaToLinear(d.specular);var R=Math.pow(Math.max(1-L.dot(N),0),5);H.r=M.r+(1-M.r)*R,H.g=M.g+(1-M.g)*R,H.b=M.b+(1-M.b)*R,k.copy(H),k.multiply(X),k.multiplyScalar(b*v*f),n.add(k)}}}}var x=d.reflectivity;if((d.mirror||d.glass)&&0<x&&o<3){if(d.mirror)W.copy(a),W.reflect(O);else if(d.glass){var T=d.refractionRatio,C=a.dot(O),D=1-T*T*(1-C*C);if(D<0)W.set(0,0,0);else{W.copy(a),W.multiplyScalar(T);R=T*C+Math.sqrt(D);A.copy(O),A.multiplyScalar(R),W.sub(A)}}var I=Math.max(j.dot(O),0),U=x+(1-x)*Math.pow(1-I,5),V=B[o];e(i,W,V,o+1),void 0!==d.specular&&V.multiply(d.specular),V.multiplyScalar(U),n.multiplyScalar(1-U),n.add(V)}}}}(),Z=(m=new XDTHREE.Vector3,g=new XDTHREE.Vector3,w=new XDTHREE.Vector3,function(e,t,a,n,o){var r=n.normal,i=n.vertexNormals;if(!0===a)e.copy(r);else{var s=o[n.a],d=o[n.b],l=o[n.c];w.crossVectors(m.subVectors(d,s),g.subVectors(l,s));var u=r.dot(w);w.crossVectors(m.subVectors(d,t),g.subVectors(l,t));var c=r.dot(w)/u;w.crossVectors(m.subVectors(l,t),g.subVectors(s,t));var h=r.dot(w)/u,p=1-c-h;m.copy(i[0]),m.multiplyScalar(c),g.copy(i[1]),g.multiplyScalar(h),w.copy(i[2]),w.multiplyScalar(p),e.addVectors(m,g),e.add(w)}}),o=(h=BLOCK,p=new Uint8ClampedArray(h*h*4),f=new XDTHREE.Color,function(e,t){for(var a=0,n=0;n<h;n++)for(var o=0;o<h;o++,a+=4)d.copy(u),l.set(o+e-r,-(n+t-i),-s),l.applyMatrix3(c).normalize(),y(d,l,f,0),p[a+0]=255*Math.sqrt(f.r),p[a+1]=255*Math.sqrt(f.g),p[a+2]=255*Math.sqrt(f.b),p[a+3]=255;self.postMessage({data:p.buffer,blockX:e,blockY:t,blockSize:h,sceneId:sceneId,time:Date.now()},[p.buffer]),p=new Uint8ClampedArray(h*h*4)});this.render=function(e,t){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),u.setFromMatrixPosition(t.matrixWorld),c.getNormalMatrix(t.matrixWorld),s=.5/Math.tan(XDTHREE.Math.degToRad(.5*t.fov))*n,G=e.children,Y.length=0,e.traverse(function(e){e.isPointLight&&Y.push(e),void 0===K[e.id]&&(K[e.id]={normalMatrix:new XDTHREE.Matrix3,inverseMatrix:new XDTHREE.Matrix4});var t=K[e.id];t.normalMatrix.getNormalMatrix(e.matrixWorld),t.inverseMatrix.getInverse(e.matrixWorld)}),o(startX,startY)}},Object.assign(XDTHREE.RaytracingRendererWorker.prototype,XDTHREE.EventDispatcher.prototype);var XDTHREEx=XDTHREEx||{};XDTHREEx.Planets={};var xtrad_pluginUrl=xtradDirData.pluginurl,xtrad_uploadUrl=xtradDirData.uploadurl;XDTHREEx.Planets.baseURL=xtrad_pluginUrl+"/images/planets/",XDTHREEx.Planets.createSun=function(e){var t=new XDTHREE.SphereGeometry(e,32,32),a=(new XDTHREE.TextureLoader).load(XDTHREEx.Planets.baseURL+"images/sunmap.jpg"),n=new XDTHREE.MeshPhongMaterial({map:a,bumpMap:a,bumpScale:.05,shininess:5});return new XDTHREE.Mesh(t,n)},XDTHREEx.Planets.createMercury=function(e){var t=new XDTHREE.TextureLoader,a=new XDTHREE.SphereGeometry(e,32,32),n=new XDTHREE.MeshPhongMaterial({map:t.load(XDTHREEx.Planets.baseURL+"images/mercurymap.jpg"),bumpMap:t.load(XDTHREEx.Planets.baseURL+"images/mercurybump.jpg"),bumpScale:e/100});return new XDTHREE.Mesh(a,n)},XDTHREEx.Planets.createVenus=function(e){var t=new XDTHREE.TextureLoader,a=new XDTHREE.SphereGeometry(e,32,32),n=new XDTHREE.MeshPhongMaterial({map:t.load(XDTHREEx.Planets.baseURL+"images/venusmap.jpg"),bumpMap:t.load(XDTHREEx.Planets.baseURL+"images/venusbump.jpg"),bumpScale:e/100,shininess:5});return new XDTHREE.Mesh(a,n)},XDTHREEx.Planets.createEarth=function(e){var t=new XDTHREE.TextureLoader,a=new XDTHREE.SphereGeometry(e,32,32),n=new XDTHREE.MeshPhongMaterial({map:t.load(XDTHREEx.Planets.baseURL+"images/earthmap1k.jpg"),bumpMap:t.load(XDTHREEx.Planets.baseURL+"images/earthbump1k.jpg"),bumpScale:e/10,specularMap:t.load(XDTHREEx.Planets.baseURL+"images/earthspec1k.jpg"),specular:new XDTHREE.Color("grey"),shininess:5});return new XDTHREE.Mesh(a,n)},XDTHREEx.Planets.createEarthCloud=function(e){var t=document.createElement("canvas");t.width=1024,t.height=512;var c=t.getContext("2d"),h=new Image;h.addEventListener("load",function(){var s=document.createElement("canvas");s.width=h.width,s.height=h.height;var d=s.getContext("2d");d.drawImage(h,0,0);var l=d.getImageData(0,0,s.width,s.height),u=new Image;u.addEventListener("load",function(){var e=document.createElement("canvas");e.width=u.width,e.height=u.height;var t=e.getContext("2d");t.drawImage(u,0,0);for(var a=t.getImageData(0,0,e.width,e.height),n=d.createImageData(s.width,s.height),o=0,r=0;o<h.height;o++)for(var i=0;i<h.width;i++,r+=4)n.data[r+0]=l.data[r+0],n.data[r+1]=l.data[r+1],n.data[r+2]=l.data[r+2],n.data[r+3]=255-a.data[r+0];c.putImageData(n,0,0),p.map.needsUpdate=!0,e=s=null}),u.src=XDTHREEx.Planets.baseURL+"images/earthcloudmaptrans.jpg"},!1),h.src=XDTHREEx.Planets.baseURL+"images/earthcloudmap.jpg";var a=new XDTHREE.SphereGeometry(e+.02*e,32,32),p=new XDTHREE.MeshPhongMaterial({map:new XDTHREE.Texture(t),side:XDTHREE.DoubleSide,transparent:!0,opacity:.8});return new XDTHREE.Mesh(a,p)},XDTHREEx.Planets.createMoon=function(e){var t=new XDTHREE.TextureLoader,a=new XDTHREE.SphereGeometry(e,32,32),n=new XDTHREE.MeshPhongMaterial({map:t.load(XDTHREEx.Planets.baseURL+"images/moonmap1k.jpg"),bumpMap:t.load(XDTHREEx.Planets.baseURL+"images/moonbump1k.jpg"),bumpScale:e/250,shininess:5});return new XDTHREE.Mesh(a,n)},XDTHREEx.Planets.createMars=function(e){var t=new XDTHREE.TextureLoader,a=new XDTHREE.SphereGeometry(e,32,32),n=new XDTHREE.MeshPhongMaterial({map:t.load(XDTHREEx.Planets.baseURL+"images/marsmap1k.jpg"),bumpMap:t.load(XDTHREEx.Planets.baseURL+"images/marsbump1k.jpg"),bumpScale:e/10,shininess:5});return new XDTHREE.Mesh(a,n)},XDTHREEx.Planets.createJupiter=function(e){var t=new XDTHREE.TextureLoader,a=new XDTHREE.SphereGeometry(e,32,32),n=t.load(XDTHREEx.Planets.baseURL+"images/jupitermap.jpg"),o=new XDTHREE.MeshPhongMaterial({map:n,bumpMap:n,bumpScale:e/250,shininess:5});return new XDTHREE.Mesh(a,o)},XDTHREEx.Planets.createSaturn=function(e){var t=new XDTHREE.TextureLoader,a=new XDTHREE.SphereGeometry(e,32,32),n=t.load(XDTHREEx.Planets.baseURL+"images/saturnmap.jpg"),o=new XDTHREE.MeshPhongMaterial({map:n,bumpMap:n,bumpScale:e/10,shininess:5});return new XDTHREE.Mesh(a,o)},XDTHREEx.Planets.createSaturnRing=function(e){var u=document.createElement("canvas");u.width=915,u.height=64;var c=u.getContext("2d"),h=new Image;h.addEventListener("load",function(){var e=document.createElement("canvas");e.width=h.width,e.height=h.height;var s=e.getContext("2d");s.drawImage(h,0,0);var d=s.getImageData(0,0,e.width,e.height),l=new Image;l.addEventListener("load",function(){var e=document.createElement("canvas");e.width=l.width,e.height=l.height;var t=e.getContext("2d");t.drawImage(l,0,0);for(var a=t.getImageData(0,0,e.width,e.height),n=s.createImageData(u.width,u.height),o=0,r=0;o<h.height;o++)for(var i=0;i<h.width;i++,r+=4)n.data[r+0]=d.data[r+0],n.data[r+1]=d.data[r+1],n.data[r+2]=d.data[r+2],n.data[r+3]=255-a.data[r+0]/4;c.putImageData(n,0,0),p.map.needsUpdate=!0}),l.src=XDTHREEx.Planets.baseURL+"images/saturnringpattern.gif"},!1),h.src=XDTHREEx.Planets.baseURL+"images/saturnringcolor.jpg";var t=new XDTHREEx.Planets._RingGeometry(e+.1*e,e+50*e/100,64),p=new XDTHREE.MeshPhongMaterial({map:new XDTHREE.Texture(u),side:XDTHREE.DoubleSide,transparent:!0,opacity:.8}),a=new XDTHREE.Mesh(t,p);return a.lookAt(new XDTHREE.Vector3(.5,-4,1)),a},XDTHREEx.Planets.createUranus=function(e){var t=new XDTHREE.TextureLoader,a=new XDTHREE.SphereGeometry(e,32,32),n=t.load(XDTHREEx.Planets.baseURL+"images/uranusmap.jpg"),o=new XDTHREE.MeshPhongMaterial({map:n,bumpMap:n,bumpScale:e/10,shininess:5});return new XDTHREE.Mesh(a,o)},XDTHREEx.Planets.createUranusRing=function(e){var u=document.createElement("canvas");u.width=1024,u.height=72;var c=u.getContext("2d"),h=new Image;h.addEventListener("load",function(){var e=document.createElement("canvas");e.width=h.width,e.height=h.height;var s=e.getContext("2d");s.drawImage(h,0,0);var d=s.getImageData(0,0,e.width,e.height),l=new Image;l.addEventListener("load",function(){var e=document.createElement("canvas");e.width=l.width,e.height=l.height;var t=e.getContext("2d");t.drawImage(l,0,0);for(var a=t.getImageData(0,0,e.width,e.height),n=s.createImageData(u.width,u.height),o=0,r=0;o<h.height;o++)for(var i=0;i<h.width;i++,r+=4)n.data[r+0]=d.data[r+0],n.data[r+1]=d.data[r+1],n.data[r+2]=d.data[r+2],n.data[r+3]=255-a.data[r+0]/2;c.putImageData(n,0,0),p.map.needsUpdate=!0}),l.src=XDTHREEx.Planets.baseURL+"images/uranusringtrans.gif"},!1),h.src=XDTHREEx.Planets.baseURL+"images/uranusringcolour.jpg";var t=new XDTHREEx.Planets._RingGeometry(e+.1*e,e+50*e/100,64),p=new XDTHREE.MeshPhongMaterial({map:new XDTHREE.Texture(u),side:XDTHREE.DoubleSide,transparent:!0,opacity:.8}),a=new XDTHREE.Mesh(t,p);return a.lookAt(new XDTHREE.Vector3(.5,-4,1)),a},XDTHREEx.Planets.createNeptune=function(e){var t=new XDTHREE.TextureLoader,a=new XDTHREE.SphereGeometry(e,32,32),n=t.load(XDTHREEx.Planets.baseURL+"images/neptunemap.jpg"),o=new XDTHREE.MeshPhongMaterial({map:n,bumpMap:n,bumpScale:e/10,shininess:5});return new XDTHREE.Mesh(a,o)},XDTHREEx.Planets.createPluto=function(e){var t=new XDTHREE.TextureLoader,a=new XDTHREE.SphereGeometry(e,32,32),n=new XDTHREE.MeshPhongMaterial({map:t.load(XDTHREEx.Planets.baseURL+"images/plutomap1k.jpg"),bumpMap:t.load(XDTHREEx.Planets.baseURL+"images/plutobump1k.jpg"),bumpScale:e/100,shininess:5});return new XDTHREE.Mesh(a,n)},XDTHREEx.Planets.createStarfield=function(e){var t=(new XDTHREE.TextureLoader).load(XDTHREEx.Planets.baseURL+"images/"+e),a=new XDTHREE.MeshBasicMaterial({map:t,side:XDTHREE.BackSide}),n=new XDTHREE.SphereGeometry(100,32,32),o=new XDTHREE.Mesh(n,a);return o.name="Galaxy",o},XDTHREEx.Planets.createEarthAtmos=function(e,t){var a=new XDTHREE.Object3D;if(a.rotateY(90*Math.PI/180),a.position.z=0,a.name="ContainerEarth",t){var n=XDTHREEx.Planets.createMoon(10);n.position.set(15,15,15),n.scale.multiplyScalar(.2),n.receiveShadow=!0,n.castShadow=!0,n.name="Moon",a.add(n)}var o=XDTHREEx.Planets.createEarth(10);o.receiveShadow=!0,o.castShadow=!0,o.name="Earth",a.add(o);var r=new XDTHREE.SphereGeometry(10,32,32),i=XDTHREEx.createAtmosphereMaterial();i.uniforms.glowColor.value.set(46079),i.uniforms.coeficient.value=.8,i.uniforms.power.value=2;var s=new XDTHREE.Mesh(r,i);s.scale.multiplyScalar(1.01),s.name="Atmos1",a.add(s);var d=new XDTHREE.SphereGeometry(10,32,32),l=XDTHREEx.createAtmosphereMaterial();l.side=XDTHREE.BackSide,l.uniforms.glowColor.value.set(46079),l.uniforms.coeficient.value=.5,l.uniforms.power.value=4;var u=new XDTHREE.Mesh(d,l);u.scale.multiplyScalar(1.15),u.name="Atmos2",a.add(u);var c=XDTHREEx.Planets.createEarthCloud(10);c.receiveShadow=!0,c.castShadow=!0,c.name="Cloud",a.add(c),e.execute(new AddObjectCommand(a));var h={name:"earth",source:"function update( event ) {\nvar time = event.time * 0.001;\nvar delta = event.delta * 0.001;\nvar timer = 0.001 * Date.now();\nthis.rotation.y += 1/16 * delta;\n}"};e.execute(new AddScriptCommand(o,h));var p={name:"cloud",source:"function update( event ) {\nvar time = event.time * 0.001;\nvar delta = event.delta * 0.001;\nvar timer = 0.001 * Date.now();\nthis.rotation.y += 1/8 * delta;\n}"};e.execute(new AddScriptCommand(c,p))},XDTHREEx.Planets._RingGeometry=function(e,t,a){XDTHREE.Geometry.call(this),e=e||0,t=t||50,a=a||8;for(var n=new XDTHREE.Vector3(0,0,1),o=0;o<a;o++){var r=o/a*Math.PI*2,i=(o+1)/a*Math.PI*2,s=new XDTHREE.Vector3(e*Math.cos(r),e*Math.sin(r),0),d=new XDTHREE.Vector3(t*Math.cos(r),t*Math.sin(r),0),l=new XDTHREE.Vector3(e*Math.cos(i),e*Math.sin(i),0),u=new XDTHREE.Vector3(t*Math.cos(i),t*Math.sin(i),0);this.vertices.push(s),this.vertices.push(d),this.vertices.push(l),this.vertices.push(u);var c=4*o,h=new XDTHREE.Face3(c+0,c+1,c+2,n),p=[],m=new XDTHREE.Vector2(0,0);p.push(m);m=new XDTHREE.Vector2(1,0);p.push(m);m=new XDTHREE.Vector2(0,1);p.push(m),this.faces.push(h),this.faceVertexUvs[0].push(p);h=new XDTHREE.Face3(c+2,c+1,c+3,n),p=[],m=new XDTHREE.Vector2(0,1);p.push(m);m=new XDTHREE.Vector2(1,0);p.push(m);m=new XDTHREE.Vector2(1,1);p.push(m),this.faces.push(h),this.faceVertexUvs[0].push(p)}this.computeFaceNormals(),this.boundingSphere=new XDTHREE.Sphere(new XDTHREE.Vector3,t)},XDTHREEx.Planets._RingGeometry.prototype=Object.create(XDTHREE.Geometry.prototype);var XDTHREEx=XDTHREEx||{};XDTHREEx.createAtmosphereMaterial=function(){var e=["varying vec3\tvVertexWorldPosition;","varying vec3\tvVertexNormal;","void main(){","\tvVertexNormal\t= normalize(normalMatrix * normal);","\tvVertexWorldPosition\t= (modelMatrix * vec4(position, 1.0)).xyz;","\t// set gl_Position","\tgl_Position\t= projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),t=["uniform vec3\tglowColor;","uniform float\tcoeficient;","uniform float\tpower;","varying vec3\tvVertexNormal;","varying vec3\tvVertexWorldPosition;","void main(){","\tvec3 worldCameraToVertex= vVertexWorldPosition - cameraPosition;","\tvec3 viewCameraToVertex\t= (viewMatrix * vec4(worldCameraToVertex, 0.0)).xyz;","\tviewCameraToVertex\t= normalize(viewCameraToVertex);","\tfloat intensity\t\t= pow(coeficient + dot(vVertexNormal, viewCameraToVertex), power);","\tgl_FragColor\t\t= vec4(glowColor, intensity);","}"].join("\n");return new XDTHREE.ShaderMaterial({uniforms:{coeficient:{type:"f",value:1},power:{type:"f",value:2},glowColor:{type:"c",value:new XDTHREE.Color("pink")}},vertexShader:e,fragmentShader:t,transparent:!0,depthWrite:!1})};var XDTHREEx=XDTHREEx||{},xtrad_pluginUrl=xtradDirData.pluginurl,xtrad_uploadUrl=xtradDirData.uploadurl;XDTHREEx.ProceduralCity=function(e){var g=10,w=10,f=50,y=50,E=0;e.nBlockX&&(g=e.nBlockX),e.nBlockZ&&(w=e.nBlockZ),e.posY&&(E=e.posY),f*=10/g,y*=10/w;var t=new XDTHREE.CubeGeometry(1,1,1);t.applyMatrix((new XDTHREE.Matrix4).makeTranslation(0,.5,0));for(var a=0,n=t.faces.length;a<n;a++)(5===t.faces[a].a&&0===t.faces[a].b&&1===t.faces[a].c||4===t.faces[a].a&&5===t.faces[a].b&&1===t.faces[a].c)&&(t.faceVertexUvs[0][a][0].set(0,0),t.faceVertexUvs[0][a][1].set(0,0),t.faceVertexUvs[0][a][2].set(0,0));var i=new XDTHREE.Mesh(t);this.createBuilding=function(){return i};var s=new XDTHREE.Texture(function(){var e=document.createElement("canvas");e.width=32,e.height=64,(o=e.getContext("2d")).fillStyle="#ffffff",o.fillRect(0,0,32,64);for(var t=2;t<64;t+=2)for(var a=0;a<32;a+=2){var n=Math.floor(64*Math.random());o.fillStyle="rgb("+[n,n,n].join(",")+")",o.fillRect(a,t,2,1)}var o,r=document.createElement("canvas");return r.width=512,r.height=1024,(o=r.getContext("2d")).imageSmoothingEnabled=!1,o.webkitImageSmoothingEnabled=!1,o.drawImage(e,0,0,r.width,r.height),r}());s.anisotropy=16,s.needsUpdate=!0;var o=new XDTHREE.CubeGeometry(.1,3,.1);new XDTHREE.Mesh(o);this.createSquareGround=function(){var e=new XDTHREE.PlaneGeometry(1,1,1),t=new XDTHREE.MeshLambertMaterial({color:2236962}),a=new XDTHREE.Mesh(e,t);return a.lookAt(new XDTHREE.Vector3(0,1,0)),a.scale.x=w*y,a.scale.y=g*f,a.position.y=E,a.name="Ground",a},this.createSquareLamps=function(){var e=new XDTHREE.Object3D,t=new XDTHREE.CubeGeometry(1,1,1);t.applyMatrix((new XDTHREE.Matrix4).makeTranslation(0,.5,0));var n=new XDTHREE.Mesh(t);n.name="Lamps";for(var o=new XDTHREE.Geometry,r=new XDTHREE.Geometry,i=0;i<w;i++)for(var s=0;s<g;s++){function a(e){var t=e.clone();t.y=3.2,t.x+=(s+.5-g/2)*f,t.z+=(i+.5-w/2)*y,o.vertices.push(t),n.position.copy(e),n.position.y=E+.1+3,n.scale.set(.2,.2,.2);for(var a=0;a<n.geometry.faces.length;a++)n.geometry.faces[a].color.set("white");n.position.x+=(s+.5-g/2)*f,n.position.z+=(i+.5-w/2)*y,n.updateMatrix(),r.merge(n.geometry,n.matrix),n.position.copy(e),n.position.y+=.1,n.scale.set(.1,3,.1);for(a=0;a<n.geometry.faces.length;a++)n.geometry.faces[a].color.set("grey");n.position.x+=(s+.5-g/2)*f,n.position.z+=(i+.5-w/2)*y,n.updateMatrix(),r.merge(n.geometry,n.matrix),n.position.copy(e),n.position.y+=.1,n.scale.set(.12,.4,.12);for(a=0;a<n.geometry.faces.length;a++)n.geometry.faces[a].color.set("maroon");n.position.x+=(s+.5-g/2)*f,n.position.z+=(i+.5-w/2)*y,n.updateMatrix(),r.merge(n.geometry,n.matrix)}for(var d=new XDTHREE.Vector3,l=0;l<5;l++)d.x=(l/4-.5)*(f-8-2),d.z=-.5*(y-8-2),d.y=E,a(d);for(l=0;l<5;l++)d.x=(l/4-.5)*(f-8-2),d.z=.5*(y-8-2),d.y=E,a(d);for(l=1;l<4;l++)d.x=.5*(f-8-2),d.z=(l/4-.5)*(y-8-2),d.y=E,a(d);for(l=1;l<4;l++)d.x=-.5*(f-8-2),d.z=(l/4-.5)*(y-8-2),d.y=E,a(d)}var u=new XDTHREE.MeshLambertMaterial({vertexColors:XDTHREE.VertexColors}),c=new XDTHREE.Mesh(r,u);c.name="Lamps",e.add(c);var h=(new XDTHREE.TextureLoader).load(xtrad_pluginUrl+"/images/lensflare2_alpha.png"),p=(u=new XDTHREE.PointsMaterial({map:h,size:8,transparent:!0}),new XDTHREE.Points(o,u));return p.sortParticles=!0,p.name="LightParticles",p.position.y=E,e.add(p),e},this.createSquareCarLights=function(){var e=1,t=new XDTHREE.Geometry,a=new XDTHREE.Vector3;a.y=E+1;for(var n,o,r,i=new XDTHREE.Color("white"),s=new XDTHREE.Color("red"),d=0;d<g;d++)for(var l=0;l<w;l++){for(var u=0;u<5;u++)a.x=.5*f-2,a.z=(u/4-.5)*(y-8),r=o=void 0,(o=(n=a).clone()).x+=-e/2,o.x+=(d+.5-g/2)*f,o.z+=(l+.5-w/2)*y,t.vertices.push(o),t.colors.push(i),(r=n.clone()).x+=+e/2,r.x+=(d+.5-g/2)*f,r.z+=(l+.5-w/2)*y,t.vertices.push(r),t.colors.push(i),n.x=-n.x,(o=n.clone()).x+=-e/2,o.x+=(d+.5-g/2)*f,o.z+=(l+.5-w/2)*y,t.vertices.push(o),t.colors.push(s),(r=n.clone()).x+=+e/2,r.x+=(d+.5-g/2)*f,r.z+=(l+.5-w/2)*y,t.vertices.push(r),t.colors.push(s)}var c=new XDTHREE.Object3D,h=(new XDTHREE.TextureLoader).load(xtrad_pluginUrl+"/images/lensflare2_alpha.png"),p=new XDTHREE.PointsMaterial({map:h,size:6,transparent:!0,vertexColors:XDTHREE.VertexColors}),m=new XDTHREE.Points(t,p);return m.sortParticles=!0,m.name="Particles",c.add(m),c},this.createSquareSideWalks=function(){for(var e=this.createBuilding(),t=new XDTHREE.Geometry,a=0;a<w;a++)for(var n=0;n<g;n++)e.position.x=(n+.5-g/2)*f,e.position.z=(a+.5-w/2)*y,e.y=E,e.scale.x=f-8,e.scale.y=.1,e.scale.z=y-8,e.updateMatrix(),t.merge(e.geometry,e.matrix);var o=new XDTHREE.MeshLambertMaterial({color:4473924}),r=new XDTHREE.Mesh(t,o);return r.name="SideWalks",r},this.createSquareBuildings=function(){for(var e=this.createBuilding(),t=new XDTHREE.Geometry,a=0;a<w;a++)for(var n=0;n<g;n++)for(var o=0;o<20;o++)e.position.x=(Math.random()-.5)*(f-15-8-2),e.position.z=(Math.random()-.5)*(y-15-8-2),e.position.y=E,e.position.x+=(n+.5-g/2)*f,e.position.z+=(a+.5-w/2)*y,e.scale.x=Math.min(5*Math.random()+10,15),e.scale.y=Math.random()*Math.random()*e.scale.x*3+4,e.scale.z=Math.min(e.scale.x,15),this.colorifyBuilding(e),e.updateMatrix(),t.merge(e.geometry,e.matrix);var r=new XDTHREE.MeshLambertMaterial({map:s,vertexColors:XDTHREE.VertexColors}),i=new XDTHREE.Mesh(t,r);return i.name="City",i},this.createSquareCity=function(){var e=new XDTHREE.Object3D,t=this.createSquareCarLights();t.name="CarLights",e.add(t);var a=this.createSquareLamps();a.name="Lamps",e.add(a);var n=this.createSquareSideWalks();n.name="SideWalks",n.position.y=E,e.add(n);var o=this.createSquareBuildings();o.name="Buildings",i.position.y=E,e.add(o);var r=this.createSquareGround();return r.name="Ground",e.add(r),e},this.createMrDoobCity=function(){for(var e=this.createBuilding(),t=new XDTHREE.Geometry,a=0;a<2e4;a++)e.position.x=10*Math.floor(200*Math.random()-100),e.position.z=10*Math.floor(200*Math.random()-100),e.rotation.y=Math.random()*Math.PI*2,e.scale.x=Math.random()*Math.random()*Math.random()*Math.random()*50+10,e.scale.y=Math.random()*Math.random()*Math.random()*e.scale.x*8+8,e.scale.z=e.scale.x,this.colorifyBuilding(e),e.updateMatrix(),t.merge(e.geometry,e.matrix);var n=new XDTHREE.MeshLambertMaterial({map:s,vertexColors:XDTHREE.VertexColors});return new XDTHREE.Mesh(t,n)};var d=new XDTHREE.Color(16777215),l=new XDTHREE.Color(3158096);return void(this.colorifyBuilding=function(e){var t=1-Math.random()*Math.random(),a=(new XDTHREE.Color).setRGB(t+.1*Math.random(),t,t+.1*Math.random()),n=a.clone().multiply(d);1<n.r&&(n.r=.99),1<n.g&&(n.g=.99),1<n.b&&(n.b=.99);var o=a.clone().multiply(l);1<o.r&&(o.r=.99),1<o.g&&(o.g=.99),1<o.b&&(o.b=.99);for(var r=e.geometry,i=0,s=r.faces.length;i<s;i++)r.faces[i].vertexColors=[n,n,n],2===r.faces[i].a&&(r.faces[i].vertexColors[0]=o),2===r.faces[i].b&&(r.faces[i].vertexColors[1]=o),2===r.faces[i].c&&(r.faces[i].vertexColors[2]=o),3===r.faces[i].a&&(r.faces[i].vertexColors[0]=o),3===r.faces[i].b&&(r.faces[i].vertexColors[1]=o),3===r.faces[i].c&&(r.faces[i].vertexColors[2]=o),6===r.faces[i].a&&(r.faces[i].vertexColors[0]=o),6===r.faces[i].b&&(r.faces[i].vertexColors[1]=o),6===r.faces[i].c&&(r.faces[i].vertexColors[2]=o),7===r.faces[i].a&&(r.faces[i].vertexColors[0]=o),7===r.faces[i].b&&(r.faces[i].vertexColors[1]=o),7===r.faces[i].c&&(r.faces[i].vertexColors[2]=o)})},void 0===XDTHREE.LoaderSupport&&(XDTHREE.LoaderSupport={}),XDTHREE.LoaderSupport.Validator={isValid:function(e){return null!=e},verifyInput:function(e,t){return null==e?t:e}},XDTHREE.LoaderSupport.Callbacks=function(){this.onProgress=null,this.onReportError=null,this.onMeshAlter=null,this.onLoad=null,this.onLoadMaterials=null},XDTHREE.LoaderSupport.Callbacks.prototype={constructor:XDTHREE.LoaderSupport.Callbacks,setCallbackOnProgress:function(e){this.onProgress=XDTHREE.LoaderSupport.Validator.verifyInput(e,this.onProgress)},setCallbackOnReportError:function(e){this.onReportError=XDTHREE.LoaderSupport.Validator.verifyInput(e,this.onReportError)},setCallbackOnMeshAlter:function(e){this.onMeshAlter=XDTHREE.LoaderSupport.Validator.verifyInput(e,this.onMeshAlter)},setCallbackOnLoad:function(e){this.onLoad=XDTHREE.LoaderSupport.Validator.verifyInput(e,this.onLoad)},setCallbackOnLoadMaterials:function(e){this.onLoadMaterials=XDTHREE.LoaderSupport.Validator.verifyInput(e,this.onLoadMaterials)}},XDTHREE.LoaderSupport.LoadedMeshUserOverride=function(e,t){this.disregardMesh=!0===e,this.alteredMesh=!0===t,this.meshes=[]},XDTHREE.LoaderSupport.LoadedMeshUserOverride.prototype={constructor:XDTHREE.LoaderSupport.LoadedMeshUserOverride,addMesh:function(e){this.meshes.push(e),this.alteredMesh=!0},isDisregardMesh:function(){return this.disregardMesh},providesAlteredMeshes:function(){return this.alteredMesh}},XDTHREE.LoaderSupport.ResourceDescriptor=function(e,t){var a=e.split("/");this.path,this.resourcePath,this.name=e,this.url=e,2<=a.length&&(this.path=XDTHREE.LoaderSupport.Validator.verifyInput(a.slice(0,a.length-1).join("/")+"/",this.path),this.name=a[a.length-1],this.url=e),this.name=XDTHREE.LoaderSupport.Validator.verifyInput(this.name,"Unnamed_Resource"),this.extension=XDTHREE.LoaderSupport.Validator.verifyInput(t,"default"),this.extension=this.extension.trim(),this.content=null},XDTHREE.LoaderSupport.ResourceDescriptor.prototype={constructor:XDTHREE.LoaderSupport.ResourceDescriptor,setContent:function(e){this.content=XDTHREE.LoaderSupport.Validator.verifyInput(e,null)},setResourcePath:function(e){this.resourcePath=XDTHREE.LoaderSupport.Validator.verifyInput(e,this.resourcePath)}},XDTHREE.LoaderSupport.PrepData=function(e){this.logging={enabled:!0,debug:!1},this.modelName=XDTHREE.LoaderSupport.Validator.verifyInput(e,""),this.resources=[],this.callbacks=new XDTHREE.LoaderSupport.Callbacks},XDTHREE.LoaderSupport.PrepData.prototype={constructor:XDTHREE.LoaderSupport.PrepData,setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},getCallbacks:function(){return this.callbacks},addResource:function(e){this.resources.push(e)},clone:function(){var e,t,a=new XDTHREE.LoaderSupport.PrepData(this.modelName);for(e in a.logging.enabled=this.logging.enabled,a.logging.debug=this.logging.debug,a.resources=this.resources,a.callbacks=this.callbacks,this)t=this[e],a.hasOwnProperty(e)||"function"==typeof this[e]||(a[e]=t);return a},checkResourceDescriptorFiles:function(e,t){var a,n,o,r,i={};for(var s in e)if(a=e[s],r=!1,XDTHREE.LoaderSupport.Validator.isValid(a.name))if(XDTHREE.LoaderSupport.Validator.isValid(a.content)){for(o=0;o<t.length&&!r;o++)if(n=t[o],a.extension.toLowerCase()===n.ext.toLowerCase())if(n.ignore)r=!0;else if("ArrayBuffer"===n.type){if(!(a.content instanceof ArrayBuffer||a.content instanceof Uint8Array))throw"Provided content is not of type ArrayBuffer! Aborting...";i[n.ext]=a,r=!0}else if("String"===n.type){if(!("string"==typeof a.content||a.content instanceof String))throw"Provided  content is not of type String! Aborting...";i[n.ext]=a,r=!0}if(!r)throw'Unidentified resource "'+a.name+'": '+a.url}else{if(!("string"==typeof a.name||a.name instanceof String))throw"Provided file is not properly defined! Aborting...";for(o=0;o<t.length&&!r;o++)n=t[o],a.extension.toLowerCase()===n.ext.toLowerCase()&&(n.ignore||(i[n.ext]=a),r=!0);if(!r)throw'Unidentified resource "'+a.name+'": '+a.url}return i}},XDTHREE.LoaderSupport.MeshBuilder=function(){console.info("Using XDTHREE.LoaderSupport.MeshBuilder version: "+XDTHREE.LoaderSupport.MeshBuilder.LOADER_MESH_BUILDER_VERSION),this.validator=XDTHREE.LoaderSupport.Validator,this.logging={enabled:!0,debug:!1},this.callbacks=new XDTHREE.LoaderSupport.Callbacks,this.materials=[]},XDTHREE.LoaderSupport.MeshBuilder.LOADER_MESH_BUILDER_VERSION="1.3.0",XDTHREE.LoaderSupport.MeshBuilder.prototype={constructor:XDTHREE.LoaderSupport.MeshBuilder,setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},init:function(){var e=new XDTHREE.MeshStandardMaterial({color:14479871});e.name="defaultMaterial";var t=new XDTHREE.MeshStandardMaterial({color:14479871});t.name="defaultVertexColorMaterial",t.vertexColors=XDTHREE.VertexColors;var a=new XDTHREE.LineBasicMaterial;a.name="defaultLineMaterial";var n=new XDTHREE.PointsMaterial({size:1});n.name="defaultPointMaterial";var o={};o[e.name]=e,o[t.name]=t,o[a.name]=a,o[n.name]=n,this.updateMaterials({cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:o}})},setMaterials:function(e){var t={cmd:"materialData",materials:{materialCloneInstructions:null,serializedMaterials:null,runtimeMaterials:this.validator.isValid(this.callbacks.onLoadMaterials)?this.callbacks.onLoadMaterials(e):e}};this.updateMaterials(t)},_setCallbacks:function(e){this.validator.isValid(e.onProgress)&&this.callbacks.setCallbackOnProgress(e.onProgress),this.validator.isValid(e.onReportError)&&this.callbacks.setCallbackOnReportError(e.onReportError),this.validator.isValid(e.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(e.onMeshAlter),this.validator.isValid(e.onLoad)&&this.callbacks.setCallbackOnLoad(e.onLoad),this.validator.isValid(e.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(e.onLoadMaterials)},processPayload:function(e){return"meshData"===e.cmd?this.buildMeshes(e):"materialData"===e.cmd?(this.updateMaterials(e),null):void 0},buildMeshes:function(e){var t,a,n,o=e.params.meshName,r=new XDTHREE.BufferGeometry;r.addAttribute("position",new XDTHREE.BufferAttribute(new Float32Array(e.buffers.vertices),3)),this.validator.isValid(e.buffers.indices)&&r.setIndex(new XDTHREE.BufferAttribute(new Uint32Array(e.buffers.indices),1)),this.validator.isValid(e.buffers.colors)&&r.addAttribute("color",new XDTHREE.BufferAttribute(new Float32Array(e.buffers.colors),3)),this.validator.isValid(e.buffers.normals)?r.addAttribute("normal",new XDTHREE.BufferAttribute(new Float32Array(e.buffers.normals),3)):r.computeVertexNormals(),this.validator.isValid(e.buffers.uvs)&&r.addAttribute("uv",new XDTHREE.BufferAttribute(new Float32Array(e.buffers.uvs),2));var i=e.materials.materialNames,s=e.materials.multiMaterial,d=[];for(n in i)a=i[n],t=this.materials[a],s&&d.push(t);if(s){t=d;var l,u=e.materials.materialGroups;for(n in u)l=u[n],r.addGroup(l.start,l.count,l.index)}var c,h,p,m=[],g=this.callbacks.onMeshAlter,w=!0,f=this.validator.verifyInput(e.geometryType,0);if(this.validator.isValid(g)&&(h=g({detail:{meshName:o,bufferGeometry:r,material:t,geometryType:f}}),this.validator.isValid(h)))if(h.isDisregardMesh())w=!1;else if(h.providesAlteredMeshes()){for(var y in h.meshes)m.push(h.meshes[y]);w=!1}if(w&&(e.computeBoundingSphere&&r.computeBoundingSphere(),(c=0===f?new XDTHREE.Mesh(r,t):1===f?new XDTHREE.LineSegments(r,t):new XDTHREE.Points(r,t)).name=o,m.push(c)),this.validator.isValid(m)&&0<m.length){var E=[];for(var y in m)c=m[y],E[y]=c.name;p="Adding mesh(es) ("+E.length+": "+E+") from input mesh: "+o,p+=" ("+(100*e.progress.numericalValue).toFixed(2)+"%)"}else p="Not adding mesh: "+o,p+=" ("+(100*e.progress.numericalValue).toFixed(2)+"%)";var v=this.callbacks.onProgress;this.validator.isValid(v)&&v(new CustomEvent("MeshBuilderEvent",{detail:{type:"progress",modelName:e.params.meshName,text:p,numericalValue:e.progress.numericalValue}}));return m},updateMaterials:function(e){var t,a,n=e.materials.materialCloneInstructions;if(this.validator.isValid(n)){var o=n.materialNameOrg,r=this.materials[o];if(this.validator.isValid(o)){t=r.clone(),a=n.materialName,t.name=a;var i=n.materialProperties;for(var s in i)t.hasOwnProperty(s)&&i.hasOwnProperty(s)&&(t[s]=i[s]);this.materials[a]=t}else console.warn('Requested material "'+o+'" is not available!')}var d=e.materials.serializedMaterials;if(this.validator.isValid(d)&&0<Object.keys(d).length){var l,u=new XDTHREE.MaterialLoader;for(a in d)l=d[a],this.validator.isValid(l)&&(t=u.parse(l),this.logging.enabled&&console.info('De-serialized material with name "'+a+'" will be added.'),this.materials[a]=t)}if(d=e.materials.runtimeMaterials,this.validator.isValid(d)&&0<Object.keys(d).length)for(a in d)t=d[a],this.logging.enabled&&console.info('Material with name "'+a+'" will be added.'),this.materials[a]=t},getMaterialsJSON:function(){var e,t={};for(var a in this.materials)e=this.materials[a],t[a]=e.toJSON();return t},getMaterials:function(){return this.materials}},XDTHREE.LoaderSupport.WorkerSupport=function(){console.info("Using XDTHREE.LoaderSupport.WorkerSupport version: "+XDTHREE.LoaderSupport.WorkerSupport.WORKER_SUPPORT_VERSION),this.logging={enabled:!0,debug:!1},this.loaderWorker="undefined"!=typeof window?new XDTHREE.LoaderSupport.WorkerSupport.LoaderWorker:new XDTHREE.LoaderSupport.WorkerSupport.NodeLoaderWorker},XDTHREE.LoaderSupport.WorkerSupport.WORKER_SUPPORT_VERSION="2.3.0",XDTHREE.LoaderSupport.WorkerSupport.prototype={constructor:XDTHREE.LoaderSupport.WorkerSupport,setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t,this.loaderWorker.setLogging(this.logging.enabled,this.logging.debug)},setForceWorkerDataCopy:function(e){this.loaderWorker.setForceCopy(e)},validate:function(e,t,a,n,o){if(!XDTHREE.LoaderSupport.Validator.isValid(this.loaderWorker.worker)){this.logging.enabled&&(console.info("WorkerSupport: Building worker code..."),console.time("buildWebWorkerCode")),XDTHREE.LoaderSupport.Validator.isValid(o)?this.logging.enabled&&console.info('WorkerSupport: Using "'+o.runnerName+'" as Runner class for worker.'):"undefined"!=typeof window?(o=XDTHREE.LoaderSupport.WorkerRunnerRefImpl,this.logging.enabled&&console.info('WorkerSupport: Using DEFAULT "THREE.LoaderSupport.WorkerRunnerRefImpl" as Runner class for worker.')):(o=XDTHREE.LoaderSupport.NodeWorkerRunnerRefImpl,this.logging.enabled&&console.info('WorkerSupport: Using DEFAULT "THREE.LoaderSupport.NodeWorkerRunnerRefImpl" as Runner class for worker.'));var r=e(XDTHREE.LoaderSupport.WorkerSupport.CodeSerializer);r+="var Parser = "+t+";\n\n",r+=XDTHREE.LoaderSupport.WorkerSupport.CodeSerializer.serializeClass(o.runnerName,o),r+="new "+o.runnerName+"();\n\n";var i=this;if(XDTHREE.LoaderSupport.Validator.isValid(a)&&0<a.length){var s="",d=function(t,a){if(0===a.length)i.loaderWorker.initWorker(s+r,o.runnerName),i.logging.enabled&&console.timeEnd("buildWebWorkerCode");else{var e=new XDTHREE.FileLoader;e.setPath(t),e.setResponseType("text"),e.load(a[0],function(e){s+=e,d(t,a)}),a.shift()}};d(n,a)}else this.loaderWorker.initWorker(r,o.runnerName),this.logging.enabled&&console.timeEnd("buildWebWorkerCode")}},setCallbacks:function(e,t){this.loaderWorker.setCallbacks(e,t)},run:function(e){this.loaderWorker.run(e)},setTerminateRequested:function(e){this.loaderWorker.setTerminateRequested(e)}},XDTHREE.LoaderSupport.WorkerSupport.LoaderWorker=function(){this._reset()},XDTHREE.LoaderSupport.WorkerSupport.LoaderWorker.prototype={constructor:XDTHREE.LoaderSupport.WorkerSupport.LoaderWorker,_reset:function(){this.logging={enabled:!0,debug:!1},this.worker=null,this.runnerImplName=null,this.callbacks={meshBuilder:null,onLoad:null},this.terminateRequested=!1,this.queuedMessage=null,this.started=!1,this.forceCopy=!1},checkSupport:function(){return void 0===window.Worker?"This browser does not support web workers!":void 0===window.Blob?"This browser does not support Blob!":"function"!=typeof window.URL.createObjectURL?"This browser does not support Object creation from URL!":void 0},setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},setForceCopy:function(e){this.forceCopy=!0===e},initWorker:function(e,t){var a=this.checkSupport();if(a)throw a;this.runnerImplName=t;var n=new Blob([e],{type:"application/javascript"});this.worker=new Worker(window.URL.createObjectURL(n)),this.worker.onmessage=this._receiveWorkerMessage,(this.worker.runtimeRef=this)._postMessage()},_receiveWorkerMessage:function(e){var t=e.data;switch(t.cmd){case"meshData":case"materialData":case"imageData":this.runtimeRef.callbacks.meshBuilder(t);break;case"complete":this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(t.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run is complete. Terminating application on request!"),this.runtimeRef._terminate());break;case"error":console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Reported error: "+t.msg),this.runtimeRef.queuedMessage=null,this.started=!1,this.runtimeRef.callbacks.onLoad(t.msg),this.runtimeRef.terminateRequested&&(this.runtimeRef.logging.enabled&&console.info("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Run reported error. Terminating application on request!"),this.runtimeRef._terminate());break;default:console.error("WorkerSupport ["+this.runtimeRef.runnerImplName+"]: Received unknown command: "+t.cmd)}},setCallbacks:function(e,t){this.callbacks.meshBuilder=XDTHREE.LoaderSupport.Validator.verifyInput(e,this.callbacks.meshBuilder),this.callbacks.onLoad=XDTHREE.LoaderSupport.Validator.verifyInput(t,this.callbacks.onLoad)},run:function(e){if(XDTHREE.LoaderSupport.Validator.isValid(this.queuedMessage))console.warn("Already processing message. Rejecting new run instruction");else{if(this.queuedMessage=e,this.started=!0,!XDTHREE.LoaderSupport.Validator.isValid(this.callbacks.meshBuilder))throw'Unable to run as no "MeshBuilder" callback is set.';if(!XDTHREE.LoaderSupport.Validator.isValid(this.callbacks.onLoad))throw'Unable to run as no "onLoad" callback is set.';"run"!==e.cmd&&(e.cmd="run"),XDTHREE.LoaderSupport.Validator.isValid(e.logging)?(e.logging.enabled=!0===e.logging.enabled,e.logging.debug=!0===e.logging.debug):e.logging={enabled:!0,debug:!1},this._postMessage()}},_postMessage:function(){var e;XDTHREE.LoaderSupport.Validator.isValid(this.queuedMessage)&&XDTHREE.LoaderSupport.Validator.isValid(this.worker)&&(this.queuedMessage.data.input instanceof ArrayBuffer?(e=this.forceCopy?this.queuedMessage.data.input.slice(0):this.queuedMessage.data.input,this.worker.postMessage(this.queuedMessage,[e])):this.worker.postMessage(this.queuedMessage))},setTerminateRequested:function(e){this.terminateRequested=!0===e,this.terminateRequested&&XDTHREE.LoaderSupport.Validator.isValid(this.worker)&&!XDTHREE.LoaderSupport.Validator.isValid(this.queuedMessage)&&this.started&&(this.logging.enabled&&console.info("Worker is terminated immediately as it is not running!"),this._terminate())},_terminate:function(){this.worker.terminate(),this._reset()}},XDTHREE.LoaderSupport.WorkerSupport.CodeSerializer={serializeObject:function(e,t){var a,n=e+" = {\n\n";for(var o in t)"string"==typeof(a=t[o])||a instanceof String?n+="\t"+o+': "'+(a=(a=a.replace("\n","\\n")).replace("\r","\\r"))+'",\n':a instanceof Array?n+="\t"+o+": ["+a+"],\n":n+="object"==typeof a?"\t"+o+": {},\n":"\t"+o+": "+a+",\n";return n+="}\n\n"},serializeClass:function(e,t,a,n,o,r,i){var s,d,l,u,c,h=[],p=[],m=[],g=null!=n;for(var w in Array.isArray(o)||(o=[]),Array.isArray(r)||(r=null),Array.isArray(i)||(i=[]),t.prototype)s=(d=t.prototype[w]).toString(),"constructor"===w?l=e+" = "+s+";\n\n":"function"==typeof d&&o.indexOf(w)<0&&(null===r||0<=r.indexOf(w))&&((c=i[w])&&c.fullName===e+".prototype."+w&&(s=c.code),g?h.push(e+".prototype."+w+" = "+s+";\n\n"):h.push("\t"+w+": "+s+",\n\n"));for(var w in t)"function"==typeof(d=t[w])?o.indexOf(w)<0&&(null===r||0<=r.indexOf(w))&&(s=(c=i[w])&&c.fullName===e+"."+w?c.code:d.toString(),m.push(e+"."+w+" = "+s+";\n\n")):(s="string"==typeof d||d instanceof String?'"'+d.toString()+'"':"object"==typeof d?"{}":d,p.push(e+"."+w+" = "+s+";\n"));null==l&&"function"==typeof t.prototype.constructor&&(l=e+" = "+t.prototype.constructor.toString().replace(a,""));var f=l+"\n\n";for(g&&(f+=e+".prototype = Object.create( "+n+".prototype );\n"),f+=e+".prototype.constructor = "+e+";\n",f+="\n\n",u=0;u<p.length;u++)f+=p[u];for(f+="\n\n",u=0;u<m.length;u++)f+=m[u];if(f+="\n\n",g)for(u=0;u<h.length;u++)f+=h[u];else{for(f+=e+".prototype = {\n\n",u=0;u<h.length;u++)f+=h[u];f+="\n};"}return f+="\n\n"}},XDTHREE.LoaderSupport.WorkerRunnerRefImpl=function(){this.getParentScope().addEventListener("message",function(e){this.processMessage(e.data)}.bind(this))},XDTHREE.LoaderSupport.WorkerRunnerRefImpl.runnerName="XDTHREE.LoaderSupport.WorkerRunnerRefImpl",XDTHREE.LoaderSupport.WorkerRunnerRefImpl.prototype={constructor:XDTHREE.LoaderSupport.WorkerRunnerRefImpl,getParentScope:function(){return self},applyProperties:function(e,t){var a,n,o;for(a in t)n="set"+a.substring(0,1).toLocaleUpperCase()+a.substring(1),o=t[a],"function"==typeof e[n]?e[n](o):e.hasOwnProperty(a)&&(e[a]=o)},processMessage:function(t){if("run"===t.cmd){var a=this.getParentScope(),e={callbackMeshBuilder:function(e){a.postMessage(e)},callbackProgress:function(e){t.logging.enabled&&t.logging.debug&&console.debug("WorkerRunner: progress: "+e)}},n=new Parser;"function"==typeof n.setLogging&&n.setLogging(t.logging.enabled,t.logging.debug),this.applyProperties(n,t.params),this.applyProperties(n,t.materials),this.applyProperties(n,e),n.workerScope=a,n.parse(t.data.input,t.data.options),t.logging.enabled&&console.log("WorkerRunner: Run complete!"),e.callbackMeshBuilder({cmd:"complete",msg:"WorkerRunner completed run."})}else console.error("WorkerRunner: Received unknown command: "+t.cmd)}},XDTHREE.LoaderSupport.NodeWorkerRunnerRefImpl=function(){this.runnerName="XDTHREE.LoaderSupport.NodeWorkerRunnerRefImpl",this.getParentScope().onmessage=this.processMessage.bind(this)},XDTHREE.LoaderSupport.NodeWorkerRunnerRefImpl.prototype=Object.create(XDTHREE.LoaderSupport.WorkerRunnerRefImpl.prototype),XDTHREE.LoaderSupport.NodeWorkerRunnerRefImpl.prototype.constructor=XDTHREE.LoaderSupport.NodeWorkerRunnerRefImpl,XDTHREE.LoaderSupport.NodeWorkerRunnerRefImpl.runnerName="XDTHREE.LoaderSupport.NodeWorkerRunnerRefImpl",XDTHREE.LoaderSupport.NodeWorkerRunnerRefImpl.prototype={getParentScope:function(){var _require=eval("require");return _require("worker_threads").parentPort}},XDTHREE.LoaderSupport.WorkerSupport.NodeLoaderWorker=function(){XDTHREE.LoaderSupport.WorkerSupport.LoaderWorker.call(this)},XDTHREE.LoaderSupport.WorkerSupport.NodeLoaderWorker.prototype=Object.create(XDTHREE.LoaderSupport.WorkerSupport.LoaderWorker.prototype),XDTHREE.LoaderSupport.WorkerSupport.NodeLoaderWorker.prototype.constructor=XDTHREE.LoaderSupport.WorkerSupport.NodeLoaderWorker,XDTHREE.LoaderSupport.WorkerSupport.NodeLoaderWorker.checkSupport=function(){try{var _require=eval("require");_require.resolve("worker_threads")}catch(e){return"This version of Node does not support web workers!"}},XDTHREE.LoaderSupport.WorkerSupport.NodeLoaderWorker.prototype.initWorker=function(code,runnerImplName){var supportError=this.checkSupport();if(supportError)throw supportError;this.runnerImplName=runnerImplName;var _require=eval("require"),Worker=_require("worker_threads").Worker;this.worker=new Worker(code,{eval:!0}),this.worker.onmessage=this._receiveWorkerMessage,this.worker.runtimeRef=this,this._postMessage()},XDTHREE.LoaderSupport.WorkerDirector=function(e){if(console.info("Using XDTHREE.LoaderSupport.WorkerDirector version: "+XDTHREE.LoaderSupport.WorkerDirector.LOADER_WORKER_DIRECTOR_VERSION),this.logging={enabled:!0,debug:!1},this.maxQueueSize=XDTHREE.LoaderSupport.WorkerDirector.MAX_QUEUE_SIZE,this.maxWebWorkers=XDTHREE.LoaderSupport.WorkerDirector.MAX_WEB_WORKER,this.crossOrigin=null,!XDTHREE.LoaderSupport.Validator.isValid(e))throw"Provided invalid classDef: "+e;this.workerDescription={classDef:e,globalCallbacks:{},workerSupports:{},forceWorkerDataCopy:!0},this.objectsCompleted=0,this.instructionQueue=[],this.instructionQueuePointer=0,this.callbackOnFinishedProcessing=null},XDTHREE.LoaderSupport.WorkerDirector.LOADER_WORKER_DIRECTOR_VERSION="2.3.0",XDTHREE.LoaderSupport.WorkerDirector.MAX_WEB_WORKER=16,XDTHREE.LoaderSupport.WorkerDirector.MAX_QUEUE_SIZE=2048,XDTHREE.LoaderSupport.WorkerDirector.prototype={constructor:XDTHREE.LoaderSupport.WorkerDirector,setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},getMaxQueueSize:function(){return this.maxQueueSize},getMaxWebWorkers:function(){return this.maxWebWorkers},setCrossOrigin:function(e){this.crossOrigin=e},setForceWorkerDataCopy:function(e){this.workerDescription.forceWorkerDataCopy=!0===e},prepareWorkers:function(e,t,a){XDTHREE.LoaderSupport.Validator.isValid(e)&&(this.workerDescription.globalCallbacks=e),this.maxQueueSize=Math.min(t,XDTHREE.LoaderSupport.WorkerDirector.MAX_QUEUE_SIZE),this.maxWebWorkers=Math.min(a,XDTHREE.LoaderSupport.WorkerDirector.MAX_WEB_WORKER),this.maxWebWorkers=Math.min(this.maxWebWorkers,this.maxQueueSize),this.objectsCompleted=0,this.instructionQueue=[];for(var n=this.instructionQueuePointer=0;n<this.maxWebWorkers;n++){var o=new XDTHREE.LoaderSupport.WorkerSupport;o.setLogging(this.logging.enabled,this.logging.debug),o.setForceWorkerDataCopy(this.workerDescription.forceWorkerDataCopy),this.workerDescription.workerSupports[n]={instanceNo:n,inUse:!1,terminateRequested:!1,workerSupport:o,loader:null}}},enqueueForRun:function(e){this.instructionQueue.length<this.maxQueueSize&&this.instructionQueue.push(e)},isRunning:function(){var e=Object.keys(this.workerDescription.workerSupports);return 0<this.instructionQueue.length&&this.instructionQueuePointer<this.instructionQueue.length||0<e.length},processQueue:function(){var e,t;for(var a in this.workerDescription.workerSupports)(t=this.workerDescription.workerSupports[a]).inUse||(this.instructionQueuePointer<this.instructionQueue.length?(e=this.instructionQueue[this.instructionQueuePointer],this._kickWorkerRun(e,t),this.instructionQueuePointer++):this._deregister(t));this.isRunning()||null===this.callbackOnFinishedProcessing||(this.callbackOnFinishedProcessing(),this.callbackOnFinishedProcessing=null)},_kickWorkerRun:function(e,a){a.inUse=!0,a.workerSupport.setTerminateRequested(a.terminateRequested),this.logging.enabled&&console.info("\nAssigning next item from queue to worker (queue length: "+this.instructionQueue.length+")\n\n");var n=XDTHREE.LoaderSupport.Validator,o=this,r=e.getCallbacks(),i=this.workerDescription.globalCallbacks;a.loader=this._buildLoader(a.instanceNo);var t=new XDTHREE.LoaderSupport.Callbacks;t.setCallbackOnLoad(function(e){n.isValid(i.onLoad)&&i.onLoad(e),n.isValid(r.onLoad)&&r.onLoad(e),o.objectsCompleted++,a.inUse=!1,o.processQueue()}),t.setCallbackOnProgress(function(e){n.isValid(i.onProgress)&&i.onProgress(e),n.isValid(r.onProgress)&&r.onProgress(e)}),t.setCallbackOnReportError(function(e){var t=!0;n.isValid(i.onReportError)&&(t=i.onReportError(a,e)),n.isValid(r.onReportError)&&(t=r.onReportError(a,e)),n.isValid(i.onReportError)||n.isValid(r.onReportError)||(console.error("Loader reported an error: "),console.error(e)),t&&(a.inUse=!1,o.processQueue())}),t.setCallbackOnMeshAlter(function(e,t){return n.isValid(i.onMeshAlter)&&(t=i.onMeshAlter(e,t)),n.isValid(r.onMeshAlter)&&(t=i.onMeshAlter(e,t)),t}),t.setCallbackOnLoadMaterials(function(e){return n.isValid(i.onLoadMaterials)&&(e=i.onLoadMaterials(e)),n.isValid(r.onLoadMaterials)&&(e=r.onLoadMaterials(e)),e}),e.callbacks=t,a.loader.run(e,a.workerSupport)},_buildLoader:function(e){var t=this.workerDescription.classDef,a=Object.create(t.prototype);if(t.call(a,XDTHREE.DefaultLoadingManager),!a.hasOwnProperty("instanceNo"))throw t.name+' has no property "instanceNo".';if(a.instanceNo=e,!a.hasOwnProperty("workerSupport"))throw t.name+' has no property "workerSupport".';if("function"!=typeof a.run)throw t.name+' has no function "run".';return a.hasOwnProperty("callbacks")&&XDTHREE.LoaderSupport.Validator.isValid(a.callbacks)||(console.warn(t.name+' has an invalid property "callbacks". Will change to "THREE.LoaderSupport.Callbacks"'),a.callbacks=new XDTHREE.LoaderSupport.Callbacks),a},_deregister:function(e){if(XDTHREE.LoaderSupport.Validator.isValid(e)){e.workerSupport.setTerminateRequested(!0),this.logging.enabled&&console.info("Requested termination of worker #"+e.instanceNo+".");var t=e.loader.callbacks;XDTHREE.LoaderSupport.Validator.isValid(t.onProgress)&&t.onProgress({detail:{text:""}}),delete this.workerDescription.workerSupports[e.instanceNo]}},tearDown:function(e){for(var t in this.logging.enabled&&console.info("WorkerDirector received the deregister call. Terminating all workers!"),this.instructionQueuePointer=this.instructionQueue.length,this.callbackOnFinishedProcessing=XDTHREE.LoaderSupport.Validator.verifyInput(e,null),this.workerDescription.workerSupports)this.workerDescription.workerSupports[t].terminateRequested=!0}},XDTHREE.MTLLoader=function(e){this.manager=void 0!==e?e:XDTHREE.DefaultLoadingManager},XDTHREE.MTLLoader.prototype={constructor:XDTHREE.MTLLoader,load:function(e,t,a,n,o){var r=this,i=void 0===this.path?XDTHREE.LoaderUtils.extractUrlBase(e):this.path,s=new XDTHREE.FileLoader(this.manager);s.setPath(this.path),s.load(e,function(e){a(r.parse(e,i,t))},n,o)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setTexturePath:function(e){return console.warn("XDTHREE.MTLLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setMaterialOptions:function(e,t){return this.materialOptions=e,this.textures=t,this},parse:function(e,t,a){for(var n=e.split("\n"),o={},r=/\s+/,i={},s=0;s<n.length;s++){var d=n[s];if(0!==(d=d.trim()).length&&"#"!==d.charAt(0)){var l=d.indexOf(" "),u=0<=l?d.substring(0,l):d;u=u.toLowerCase();var c=0<=l?d.substring(l+1):"";if(c=c.trim(),"newmtl"===u)o={name:c},i[c]=o;else if("ka"===u||"kd"===u||"ks"===u||"ke"===u){var h=c.split(r,3);o[u]=[parseFloat(h[0]),parseFloat(h[1]),parseFloat(h[2])]}else o[u]=c}}var p=new XDTHREE.MTLLoader.MaterialCreator(this.resourcePath||t,this.materialOptions);return p.setCrossOrigin(this.crossOrigin),p.setManager(this.manager),p.setMaterials(i,a),p}},XDTHREE.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:XDTHREE.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:XDTHREE.RepeatWrapping},XDTHREE.MTLLoader.MaterialCreator.prototype={constructor:XDTHREE.MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e,t){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={},this.textures=t},convert:function(e){if(!this.options)return e;var t={};for(var a in e){var n=e[a],o={};for(var r in t[a]=o,n){var i=!0,s=n[r],d=r.toLowerCase();switch(d){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(s=[s[0]/255,s[1]/255,s[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===s[0]&&0===s[1]&&0===s[2]&&(i=!1)}i&&(o[d]=s)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e,t){return void 0===this.materials[e]&&this.createMaterial_(e,t),this.materials[e]},createMaterial_:function(e){var o=this,t=this.materialsInfo[e],r={name:e,side:this.side};function i(e,t){return"string"!=typeof t||""===t?"":/^https?:\/\//i.test(t)?t:e+t}function a(e,t){if(!r[e]){var a=null,n=o.getTextureParams(t,r);(a=null!=o.textures&&null!=o.textures[n.url]?o.textures[n.url]:o.loadTexture(i(o.baseUrl,n.url))).repeat.copy(n.scale),a.offset.copy(n.offset),a.wrapS=o.wrap,a.wrapT=o.wrap,r[e]=a}}for(var n in t){var s,d=t[n];if(""!==d)switch(n.toLowerCase()){case"kd":r.color=(new XDTHREE.Color).fromArray(d);break;case"ks":r.specular=(new XDTHREE.Color).fromArray(d);break;case"ke":r.emissive=(new XDTHREE.Color).fromArray(d);break;case"map_kd":a("map",d);break;case"map_ks":a("specularMap",d,textures);break;case"map_ke":a("emissiveMap",d,textures);break;case"norm":a("normalMap",d,textures);break;case"map_bump":case"bump":a("bumpMap",d,textures);break;case"map_d":a("alphaMap",d,textures),r.transparent=!0;break;case"ns":r.shininess=parseFloat(d);break;case"d":(s=parseFloat(d))<1&&(r.opacity=s,r.transparent=!0);break;case"tr":s=parseFloat(d),this.options&&this.options.invertTrProperty&&(s=1-s),0<s&&(r.opacity=1-s,r.transparent=!0)}}return this.materials[e]=new XDTHREE.MeshPhongMaterial(r),this.materials[e]},getTextureParams:function(e,t){var a,n={scale:new XDTHREE.Vector2(1,1),offset:new XDTHREE.Vector2(0,0)},o=e.split(/\s+/);return 0<=(a=o.indexOf("-bm"))&&(t.bumpScale=parseFloat(o[a+1]),o.splice(a,2)),0<=(a=o.indexOf("-s"))&&(n.scale.set(parseFloat(o[a+1]),parseFloat(o[a+2])),o.splice(a,4)),0<=(a=o.indexOf("-o"))&&(n.offset.set(parseFloat(o[a+1]),parseFloat(o[a+2])),o.splice(a,4)),n.url=o.join(" ").trim(),n},loadTexture:function(e,t,a,n,o){var r,i=XDTHREE.Loader.Handlers.get(e),s=void 0!==this.manager?this.manager:XDTHREE.DefaultLoadingManager;return null===i&&(i=new XDTHREE.TextureLoader(s)),i.setCrossOrigin&&i.setCrossOrigin(this.crossOrigin),r=i.load(e,a,n,o),void 0!==t&&(r.mapping=t),r}},XDTHREE.OBJLoader=function(){var F=/^[og]\s*(.+)?/,_=/^mtllib /,z=/^usemtl /;function J(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var a=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var a=this._finalize(!1);a&&(a.inherited||a.groupCount<=0)&&this.materials.splice(a.index,1);var n={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&0<t.length?t[t.length-1]:"",smooth:void 0!==a?a.smooth:this.smooth,groupStart:void 0!==a?a.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(n),n},currentMaterial:function(){if(0<this.materials.length)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&1<this.materials.length)for(var a=this.materials.length-1;0<=a;a--)this.materials[a].groupCount<=0&&this.materials.splice(a,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},a&&a.name&&"function"==typeof a.clone){var n=a.clone(0);n.inherited=!0,this.object.materials.push(n)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var a=parseInt(e,10);return 3*(0<=a?a-1:a+t/3)},parseNormalIndex:function(e,t){var a=parseInt(e,10);return 3*(0<=a?a-1:a+t/3)},parseUVIndex:function(e,t){var a=parseInt(e,10);return 2*(0<=a?a-1:a+t/2)},addVertex:function(e,t,a){var n=this.vertices,o=this.object.geometry.vertices;o.push(n[e+0],n[e+1],n[e+2]),o.push(n[t+0],n[t+1],n[t+2]),o.push(n[a+0],n[a+1],n[a+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,a){var n=this.normals,o=this.object.geometry.normals;o.push(n[e+0],n[e+1],n[e+2]),o.push(n[t+0],n[t+1],n[t+2]),o.push(n[a+0],n[a+1],n[a+2])},addColor:function(e,t,a){var n=this.colors,o=this.object.geometry.colors;o.push(n[e+0],n[e+1],n[e+2]),o.push(n[t+0],n[t+1],n[t+2]),o.push(n[a+0],n[a+1],n[a+2])},addUV:function(e,t,a){var n=this.uvs,o=this.object.geometry.uvs;o.push(n[e+0],n[e+1]),o.push(n[t+0],n[t+1]),o.push(n[a+0],n[a+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,a,n,o,r,i,s,d){var l=this.vertices.length,u=this.parseVertexIndex(e,l),c=this.parseVertexIndex(t,l),h=this.parseVertexIndex(a,l);if(this.addVertex(u,c,h),void 0!==n&&""!==n){var p=this.uvs.length;u=this.parseUVIndex(n,p),c=this.parseUVIndex(o,p),h=this.parseUVIndex(r,p),this.addUV(u,c,h)}if(void 0!==i&&""!==i){var m=this.normals.length;u=this.parseNormalIndex(i,m),c=i===s?u:this.parseNormalIndex(s,m),h=i===d?u:this.parseNormalIndex(d,m),this.addNormal(u,c,h)}0<this.colors.length&&this.addColor(u,c,h)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,a=0,n=e.length;a<n;a++)this.addVertexPoint(this.parseVertexIndex(e[a],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var a=this.vertices.length,n=this.uvs.length,o=0,r=e.length;o<r;o++)this.addVertexLine(this.parseVertexIndex(e[o],a));var i=0;for(r=t.length;i<r;i++)this.addUVLine(this.parseUVIndex(t[i],n))}};return e.startObject("",!1),e}function e(e){this.manager=void 0!==e?e:XDTHREE.DefaultLoadingManager,this.materials=null}return e.prototype={constructor:e,load:function(e,t,a,n){var o=this,r=new XDTHREE.FileLoader(o.manager);r.setPath(this.path),r.load(e,function(e){t(o.parse(e))},a,n)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(e){console.time("OBJLoader");var t=new J;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));for(var a=e.split("\n"),n="",o="",r=[],i="function"==typeof"".trimLeft,s=0,d=a.length;s<d;s++)if(n=a[s],0!==(n=i?n.trimLeft():n.trim()).length&&"#"!==(o=n.charAt(0)))if("v"===o){var l=n.split(/\s+/);switch(l[0]){case"v":t.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3])),8===l.length&&t.colors.push(parseFloat(l[4]),parseFloat(l[5]),parseFloat(l[6]));break;case"vn":t.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));break;case"vt":t.uvs.push(parseFloat(l[1]),parseFloat(l[2]))}}else if("f"===o){for(var u=n.substr(1).trim().split(/\s+/),c=[],h=0,p=u.length;h<p;h++){var m=u[h];if(0<m.length){var g=m.split("/");c.push(g)}}var w=c[0];for(h=1,p=c.length-1;h<p;h++){var f=c[h],y=c[h+1];t.addFace(w[0],f[0],y[0],w[1],f[1],y[1],w[2],f[2],y[2])}}else if("l"===o){var E=n.substring(1).trim().split(" "),v=[],b=[];if(-1===n.indexOf("/"))v=E;else for(var R=0,x=E.length;R<x;R++){var T=E[R].split("/");""!==T[0]&&v.push(T[0]),""!==T[1]&&b.push(T[1])}t.addLineGeometry(v,b)}else if("p"===o){var C=n.substr(1).trim().split(" ");t.addPointGeometry(C)}else if(null!==(r=F.exec(n))){var D=(" "+r[0].substr(1).trim()).substr(1);t.startObject(D)}else if(z.test(n))t.object.startMaterial(n.substring(7).trim(),t.materialLibraries);else if(_.test(n))t.materialLibraries.push(n.substring(7).trim());else{if("s"!==o){if("\0"===n)continue;throw new Error('XDTHREE.OBJLoader: Unexpected line: "'+n+'"')}if(1<(r=n.split(" ")).length){var I=r[1].trim().toLowerCase();t.object.smooth="0"!==I&&"off"!==I}else t.object.smooth=!0;(A=t.object.currentMaterial())&&(A.smooth=t.object.smooth)}t.finalize();var U=new XDTHREE.Group;U.materialLibraries=[].concat(t.materialLibraries);for(s=0,d=t.objects.length;s<d;s++){var V=t.objects[s],S=V.geometry,M=V.materials,X="Line"===S.type,H="Points"===S.type,k=!1;if(0!==S.vertices.length){var j=new XDTHREE.BufferGeometry;j.addAttribute("position",new XDTHREE.Float32BufferAttribute(S.vertices,3)),0<S.normals.length?j.addAttribute("normal",new XDTHREE.Float32BufferAttribute(S.normals,3)):j.computeVertexNormals(),0<S.colors.length&&(k=!0,j.addAttribute("color",new XDTHREE.Float32BufferAttribute(S.colors,3))),0<S.uvs.length&&j.addAttribute("uv",new XDTHREE.Float32BufferAttribute(S.uvs,2));for(var L,O=[],N=0,P=M.length;N<P;N++){var W=M[N],A=void 0;if(null!==this.materials)if(A=this.materials.create(W.name),!X||!A||A instanceof XDTHREE.LineBasicMaterial){if(H&&A&&!(A instanceof XDTHREE.PointsMaterial)){var B=new XDTHREE.PointsMaterial({size:10,sizeAttenuation:!1});XDTHREE.Material.prototype.copy.call(B,A),B.color.copy(A.color),B.map=A.map,B.lights=!1,A=B}}else{var G=new XDTHREE.LineBasicMaterial;XDTHREE.Material.prototype.copy.call(G,A),G.color.copy(A.color),G.lights=!1,A=G}A||((A=X?new XDTHREE.LineBasicMaterial:H?new XDTHREE.PointsMaterial({size:1,sizeAttenuation:!1}):new XDTHREE.MeshPhongMaterial).name=W.name),A.flatShading=!W.smooth,A.vertexColors=k?XDTHREE.VertexColors:XDTHREE.NoColors,O.push(A)}if(1<O.length){for(N=0,P=M.length;N<P;N++){W=M[N];j.addGroup(W.groupStart,W.groupCount,N)}L=X?new XDTHREE.LineSegments(j,O):H?new XDTHREE.Points(j,O):new XDTHREE.Mesh(j,O)}else L=X?new XDTHREE.LineSegments(j,O[0]):H?new XDTHREE.Points(j,O[0]):new XDTHREE.Mesh(j,O[0]);L.name=V.name,U.add(L)}}return console.timeEnd("OBJLoader"),U}},e}(),void 0===XDTHREE.OBJLoader2&&(XDTHREE.OBJLoader2={}),void 0===XDTHREE.LoaderSupport&&console.error('"THREE.LoaderSupport" is not available. "THREE.OBJLoader2" requires it. Please include "LoaderSupport.js" in your HTML.'),XDTHREE.OBJLoader2=function(e){console.info("Using XDTHREE.OBJLoader2 version: "+XDTHREE.OBJLoader2.OBJLOADER2_VERSION),this.manager=XDTHREE.LoaderSupport.Validator.verifyInput(e,XDTHREE.DefaultLoadingManager),this.logging={enabled:!0,debug:!1},this.modelName="",this.instanceNo=0,this.path,this.resourcePath,this.useIndices=!1,this.disregardNormals=!1,this.materialPerSmoothingGroup=!1,this.useOAsMesh=!1,this.loaderRootNode=new XDTHREE.Group,this.meshBuilder=new XDTHREE.LoaderSupport.MeshBuilder,this.callbacks=new XDTHREE.LoaderSupport.Callbacks,this.workerSupport=new XDTHREE.LoaderSupport.WorkerSupport,this.terminateWorkerOnLoad=!0},XDTHREE.OBJLoader2.OBJLOADER2_VERSION="2.5.0",XDTHREE.OBJLoader2.prototype={constructor:XDTHREE.OBJLoader2,setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t,this.meshBuilder.setLogging(this.logging.enabled,this.logging.debug)},setModelName:function(e){this.modelName=XDTHREE.LoaderSupport.Validator.verifyInput(e,this.modelName)},setPath:function(e){this.path=XDTHREE.LoaderSupport.Validator.verifyInput(e,this.path)},setResourcePath:function(e){this.resourcePath=XDTHREE.LoaderSupport.Validator.verifyInput(e,this.resourcePath)},setStreamMeshesTo:function(e){this.loaderRootNode=XDTHREE.LoaderSupport.Validator.verifyInput(e,this.loaderRootNode)},setMaterials:function(e){this.meshBuilder.setMaterials(e)},setUseIndices:function(e){this.useIndices=!0===e},setDisregardNormals:function(e){this.disregardNormals=!0===e},setMaterialPerSmoothingGroup:function(e){this.materialPerSmoothingGroup=!0===e},setUseOAsMesh:function(e){this.useOAsMesh=!0===e},_setCallbacks:function(e){XDTHREE.LoaderSupport.Validator.isValid(e.onProgress)&&this.callbacks.setCallbackOnProgress(e.onProgress),XDTHREE.LoaderSupport.Validator.isValid(e.onReportError)&&this.callbacks.setCallbackOnReportError(e.onReportError),XDTHREE.LoaderSupport.Validator.isValid(e.onMeshAlter)&&this.callbacks.setCallbackOnMeshAlter(e.onMeshAlter),XDTHREE.LoaderSupport.Validator.isValid(e.onLoad)&&this.callbacks.setCallbackOnLoad(e.onLoad),XDTHREE.LoaderSupport.Validator.isValid(e.onLoadMaterials)&&this.callbacks.setCallbackOnLoadMaterials(e.onLoadMaterials),this.meshBuilder._setCallbacks(this.callbacks)},onProgress:function(e,t,a){var n=XDTHREE.LoaderSupport.Validator.isValid(t)?t:"",o={detail:{type:e,modelName:this.modelName,instanceNo:this.instanceNo,text:n,numericalValue:a}};XDTHREE.LoaderSupport.Validator.isValid(this.callbacks.onProgress)&&this.callbacks.onProgress(o),this.logging.enabled&&this.logging.debug&&console.debug(n)},_onError:function(e){var t="Error occurred while downloading!";e.currentTarget&&null!==e.currentTarget.statusText&&(t+="\nurl: "+e.currentTarget.responseURL+"\nstatus: "+e.currentTarget.statusText),this.onProgress("error",t,-1),this._throwError(t)},_throwError:function(e){if(!XDTHREE.LoaderSupport.Validator.isValid(this.callbacks.onReportError))throw e;this.callbacks.onReportError(e)},load:function(e,t,a,n,o,r){var i=new XDTHREE.LoaderSupport.ResourceDescriptor(e,"OBJ");this._loadObj(i,t,a,n,o,r)},_loadObj:function(a,n,e,t,o,r){var i=this;XDTHREE.LoaderSupport.Validator.isValid(t)||(t=function(e){i._onError(e)}),XDTHREE.LoaderSupport.Validator.isValid(a)||t("An invalid ResourceDescriptor was provided. Unable to continue!");var s=function(e){if(a.content=e,r)i.parseAsync(e,n);else{var t=new XDTHREE.LoaderSupport.Callbacks;t.setCallbackOnMeshAlter(o),i._setCallbacks(t),n({detail:{loaderRootNode:i.parse(e),modelName:i.modelName,instanceNo:i.instanceNo}})}};if(this.setPath(a.path),this.setResourcePath(a.resourcePath),!XDTHREE.LoaderSupport.Validator.isValid(a.url)||XDTHREE.LoaderSupport.Validator.isValid(a.content))s(XDTHREE.LoaderSupport.Validator.isValid(a.content)?a.content:null);else{if(!XDTHREE.LoaderSupport.Validator.isValid(e)){var d=0,l=0;e=function(e){if(e.lengthComputable&&(l=e.loaded/e.total,d<l)){d=l;var t='Download of "'+a.url+'": '+(100*l).toFixed(2)+"%";i.onProgress("progressLoad",t,l)}}}var u=new XDTHREE.FileLoader(this.manager);u.setPath(this.path||this.resourcePath),u.setResponseType("arraybuffer"),u.load(a.name,s,e,t)}},run:function(t,e){this._applyPrepData(t);var a=t.checkResourceDescriptorFiles(t.resources,[{ext:"obj",type:"ArrayBuffer",ignore:!1},{ext:"mtl",type:"String",ignore:!1},{ext:"zip",type:"String",ignore:!0}]);XDTHREE.LoaderSupport.Validator.isValid(e)&&(this.terminateWorkerOnLoad=!1,this.workerSupport=e,this.logging.enabled=this.workerSupport.logging.enabled,this.logging.debug=this.workerSupport.logging.debug);var n=this;this._loadMtl(a.mtl,function(e){null!==e&&n.meshBuilder.setMaterials(e),n._loadObj(a.obj,n.callbacks.onLoad,null,null,n.callbacks.onMeshAlter,t.useAsync)},null,null,t.crossOrigin,t.materialOptions)},_applyPrepData:function(e){XDTHREE.LoaderSupport.Validator.isValid(e)&&(this.setLogging(e.logging.enabled,e.logging.debug),this.setModelName(e.modelName),this.setStreamMeshesTo(e.streamMeshesTo),this.meshBuilder.setMaterials(e.materials),this.setUseIndices(e.useIndices),this.setDisregardNormals(e.disregardNormals),this.setMaterialPerSmoothingGroup(e.materialPerSmoothingGroup),this.setUseOAsMesh(e.useOAsMesh),this._setCallbacks(e.getCallbacks()))},parse:function(e){if(!XDTHREE.LoaderSupport.Validator.isValid(e))return console.warn("Provided content is not a valid ArrayBuffer or String."),this.loaderRootNode;this.logging.enabled&&console.time("OBJLoader2 parse: "+this.modelName),this.meshBuilder.init();var t=new XDTHREE.OBJLoader2.Parser;t.setLogging(this.logging.enabled,this.logging.debug),t.setMaterialPerSmoothingGroup(this.materialPerSmoothingGroup),t.setUseOAsMesh(this.useOAsMesh),t.setUseIndices(this.useIndices),t.setDisregardNormals(this.disregardNormals),t.setMaterials(this.meshBuilder.getMaterials());var o=this;t.setCallbackMeshBuilder(function(e){var t,a=o.meshBuilder.processPayload(e);for(var n in a)t=a[n],o.loaderRootNode.add(t)});return t.setCallbackProgress(function(e,t){o.onProgress("progressParse",e,t)}),e instanceof ArrayBuffer||e instanceof Uint8Array?(this.logging.enabled&&console.info("Parsing arrayBuffer..."),t.parse(e)):"string"==typeof e||e instanceof String?(this.logging.enabled&&console.info("Parsing text..."),t.parseText(e)):this._throwError("Provided content was neither of type String nor Uint8Array! Aborting..."),this.logging.enabled&&console.timeEnd("OBJLoader2 parse: "+this.modelName),this.loaderRootNode},parseAsync:function(e,t){var o=this,a=!1,n=function(){t({detail:{loaderRootNode:o.loaderRootNode,modelName:o.modelName,instanceNo:o.instanceNo}}),a&&o.logging.enabled&&console.timeEnd("OBJLoader2 parseAsync: "+o.modelName)};XDTHREE.LoaderSupport.Validator.isValid(e)?a=!0:(console.warn("Provided content is not a valid ArrayBuffer."),n()),a&&this.logging.enabled&&console.time("OBJLoader2 parseAsync: "+this.modelName),this.meshBuilder.init();this.workerSupport.validate(function(e){var t="";return t+="/**\n",t+="  * This code was constructed by OBJLoader2 buildCode.\n",t+="  */\n\n",t+="THREE = { LoaderSupport: {}, OBJLoader2: {} };\n\n",t+=e.serializeObject("THREE.LoaderSupport.Validator",XDTHREE.LoaderSupport.Validator),t+=e.serializeClass("THREE.OBJLoader2.Parser",XDTHREE.OBJLoader2.Parser)},"THREE.OBJLoader2.Parser"),this.workerSupport.setCallbacks(function(e){var t,a=o.meshBuilder.processPayload(e);for(var n in a)t=a[n],o.loaderRootNode.add(t)},n),o.terminateWorkerOnLoad&&this.workerSupport.setTerminateRequested(!0);var r={},i=this.meshBuilder.getMaterials();for(var s in i)r[s]=s;this.workerSupport.run({params:{useAsync:!0,materialPerSmoothingGroup:this.materialPerSmoothingGroup,useOAsMesh:this.useOAsMesh,useIndices:this.useIndices,disregardNormals:this.disregardNormals},logging:{enabled:this.logging.enabled,debug:this.logging.debug},materials:{materials:r},data:{input:e,options:null}})},loadMtl:function(e,t,a,n,o,r,i,s){var d=new XDTHREE.LoaderSupport.ResourceDescriptor(e,"MTL");d.setContent(t),this._loadMtl(d,a,n,o,r,i,s)},_loadMtl:function(n,a,o,e,t,r,i){void 0===XDTHREE.MTLLoader&&console.error('"THREE.MTLLoader" is not available. "THREE.OBJLoader2" requires it for loading MTL files.'),XDTHREE.LoaderSupport.Validator.isValid(n)&&this.logging.enabled&&console.time("Loading MTL: "+n.name);var s=[],d=this,l=function(e){var t=[];if(XDTHREE.LoaderSupport.Validator.isValid(e))for(var a in e.preload(),t=e.materials)t.hasOwnProperty(a)&&(s[a]=t[a]);XDTHREE.LoaderSupport.Validator.isValid(n)&&d.logging.enabled&&console.timeEnd("Loading MTL: "+n.name),o(s,e)};if(XDTHREE.LoaderSupport.Validator.isValid(n)&&(XDTHREE.LoaderSupport.Validator.isValid(n.content)||XDTHREE.LoaderSupport.Validator.isValid(n.url))){var u=new XDTHREE.MTLLoader(this.manager);r=XDTHREE.LoaderSupport.Validator.verifyInput(r,"anonymous"),u.setCrossOrigin(r),u.setResourcePath(n.resourcePath||n.path),XDTHREE.LoaderSupport.Validator.isValid(i)&&u.setMaterialOptions(i,a);var c=function(e){var t=e;"string"==typeof e||e instanceof String||(0<e.length||0<e.byteLength?t=XDTHREE.LoaderUtils.decodeText(e):this._throwError("Unable to parse mtl as it it seems to be neither a String, an Array or an ArrayBuffer!")),l(u.parse(t,"",a))};if(XDTHREE.LoaderSupport.Validator.isValid(n.content))c(n.content);else if(XDTHREE.LoaderSupport.Validator.isValid(n.url)){var h=new XDTHREE.FileLoader(this.manager);if(XDTHREE.LoaderSupport.Validator.isValid(t)||(t=function(e){d._onError(e)}),!XDTHREE.LoaderSupport.Validator.isValid(e)){var p=0,m=0;e=function(e){if(e.lengthComputable&&(m=e.loaded/e.total,p<m)){p=m;var t='Download of "'+n.url+'": '+(100*m).toFixed(2)+"%";d.onProgress("progressLoad",t,m)}}}h.load(n.url,c,e,t)}}else l()}},XDTHREE.OBJLoader2.Parser=function(){this.callbackProgress=null,this.callbackMeshBuilder=null,this.contentRef=null,this.legacyMode=!1,this.materials={},this.useAsync=!1,this.materialPerSmoothingGroup=!1,this.useOAsMesh=!1,this.useIndices=!1,this.disregardNormals=!1,this.vertices=[],this.colors=[],this.normals=[],this.uvs=[],this.rawMesh={objectName:"",groupName:"",activeMtlName:"",mtllibName:"",faceType:-1,subGroups:[],subGroupInUse:null,smoothingGroup:{splitMaterials:!1,normalized:-1,real:-1},counts:{doubleIndicesCount:0,faceCount:0,mtlCount:0,smoothingGroupCount:0}},this.inputObjectCount=1,this.outputObjectCount=1,this.globalCounts={vertices:0,faces:0,doubleIndicesCount:0,lineByte:0,currentByte:0,totalBytes:0},this.logging={enabled:!0,debug:!1}},XDTHREE.OBJLoader2.Parser.prototype={constructor:XDTHREE.OBJLoader2.Parser,resetRawMesh:function(){this.rawMesh.subGroups=[],this.rawMesh.subGroupInUse=null,this.rawMesh.smoothingGroup.normalized=-1,this.rawMesh.smoothingGroup.real=-1,this.pushSmoothingGroup(1),this.rawMesh.counts.doubleIndicesCount=0,this.rawMesh.counts.faceCount=0,this.rawMesh.counts.mtlCount=0,this.rawMesh.counts.smoothingGroupCount=0},setUseAsync:function(e){this.useAsync=e},setMaterialPerSmoothingGroup:function(e){this.materialPerSmoothingGroup=e},setUseOAsMesh:function(e){this.useOAsMesh=e},setUseIndices:function(e){this.useIndices=e},setDisregardNormals:function(e){this.disregardNormals=e},setMaterials:function(e){this.materials=XDTHREE.LoaderSupport.Validator.verifyInput(e,this.materials),this.materials=XDTHREE.LoaderSupport.Validator.verifyInput(this.materials,{})},setCallbackMeshBuilder:function(e){XDTHREE.LoaderSupport.Validator.isValid(e)||this._throwError('Unable to run as no "MeshBuilder" callback is set.'),this.callbackMeshBuilder=e},setCallbackProgress:function(e){this.callbackProgress=e},setLogging:function(e,t){this.logging.enabled=!0===e,this.logging.debug=!0===t},configure:function(){if(this.pushSmoothingGroup(1),this.logging.enabled){var e=Object.keys(this.materials),t="OBJLoader2.Parser configuration:"+(0<e.length?"\n\tmaterialNames:\n\t\t- "+e.join("\n\t\t- "):"\n\tmaterialNames: None")+"\n\tuseAsync: "+this.useAsync+"\n\tmaterialPerSmoothingGroup: "+this.materialPerSmoothingGroup+"\n\tuseOAsMesh: "+this.useOAsMesh+"\n\tuseIndices: "+this.useIndices+"\n\tdisregardNormals: "+this.disregardNormals+"\n\tcallbackMeshBuilderName: "+this.callbackMeshBuilder.name+"\n\tcallbackProgressName: "+this.callbackProgress.name;console.info(t)}},parse:function(e){this.logging.enabled&&console.time("OBJLoader2.Parser.parse"),this.configure();var t=new Uint8Array(e),a=(this.contentRef=t).byteLength;this.globalCounts.totalBytes=a;for(var n,o=new Array(128),r="",i=0,s=0,d=0;d<a;d++)switch(n=t[d]){case 32:0<r.length&&(o[i++]=r),r="";break;case 47:0<r.length&&(o[i++]=r),s++,r="";break;case 10:0<r.length&&(o[i++]=r),r="",this.globalCounts.lineByte=this.globalCounts.currentByte,this.globalCounts.currentByte=d,this.processLine(o,i,s),s=i=0;break;case 13:break;default:r+=String.fromCharCode(n)}this.finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2.Parser.parse")},parseText:function(e){this.logging.enabled&&console.time("OBJLoader2.Parser.parseText"),this.configure(),this.legacyMode=!0;var t=(this.contentRef=e).length;this.globalCounts.totalBytes=t;for(var a,n=new Array(128),o="",r=0,i=0,s=0;s<t;s++)switch(a=e[s]){case" ":0<o.length&&(n[r++]=o),o="";break;case"/":0<o.length&&(n[r++]=o),i++,o="";break;case"\n":0<o.length&&(n[r++]=o),o="",this.globalCounts.lineByte=this.globalCounts.currentByte,this.globalCounts.currentByte=s,this.processLine(n,r,i),i=r=0;break;case"\r":break;default:o+=a}this.finalizeParsing(),this.logging.enabled&&console.timeEnd("OBJLoader2.Parser.parseText")},processLine:function(e,t,a){if(!(t<1)){var n,o,r,i,s=function(e,t,a,n){var o="";if(a<n){var r;if(t)for(r=a;r<n;r++)o+=e[r];else for(r=a;r<n;r++)o+=String.fromCharCode(e[r]);o=o.trim()}return o};switch(i=e[0]){case"v":this.vertices.push(parseFloat(e[1])),this.vertices.push(parseFloat(e[2])),this.vertices.push(parseFloat(e[3])),4<t&&(this.colors.push(parseFloat(e[4])),this.colors.push(parseFloat(e[5])),this.colors.push(parseFloat(e[6])));break;case"vt":this.uvs.push(parseFloat(e[1])),this.uvs.push(parseFloat(e[2]));break;case"vn":this.normals.push(parseFloat(e[1])),this.normals.push(parseFloat(e[2])),this.normals.push(parseFloat(e[3]));break;case"f":if(n=t-1,0===a)for(this.checkFaceType(0),r=2,o=n;r<o;r++)this.buildFace(e[1]),this.buildFace(e[r]),this.buildFace(e[r+1]);else if(n===2*a)for(this.checkFaceType(1),r=3,o=n-2;r<o;r+=2)this.buildFace(e[1],e[2]),this.buildFace(e[r],e[r+1]),this.buildFace(e[r+2],e[r+3]);else if(2*n==3*a)for(this.checkFaceType(2),r=4,o=n-3;r<o;r+=3)this.buildFace(e[1],e[2],e[3]),this.buildFace(e[r],e[r+1],e[r+2]),this.buildFace(e[r+3],e[r+4],e[r+5]);else for(this.checkFaceType(3),r=3,o=n-2;r<o;r+=2)this.buildFace(e[1],void 0,e[2]),this.buildFace(e[r],void 0,e[r+1]),this.buildFace(e[r+2],void 0,e[r+3]);break;case"l":case"p":if((n=t-1)===2*a)for(this.checkFaceType(4),o=n+(r=1);r<o;r+=2)this.buildFace(e[r],e[r+1]);else for(this.checkFaceType("l"===i?5:6),o=n+(r=1);r<o;r++)this.buildFace(e[r]);break;case"s":this.pushSmoothingGroup(e[1]);break;case"g":this.processCompletedMesh(),this.rawMesh.groupName=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"o":this.useOAsMesh&&this.processCompletedMesh(),this.rawMesh.objectName=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+2,this.globalCounts.currentByte);break;case"mtllib":this.rawMesh.mtllibName=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);break;case"usemtl":var d=s(this.contentRef,this.legacyMode,this.globalCounts.lineByte+7,this.globalCounts.currentByte);""!==d&&this.rawMesh.activeMtlName!==d&&(this.rawMesh.activeMtlName=d,this.rawMesh.counts.mtlCount++,this.checkSubGroup())}}},pushSmoothingGroup:function(e){var t=parseInt(e);isNaN(t)&&(t="off"===e?0:1);var a=this.rawMesh.smoothingGroup.normalized;this.rawMesh.smoothingGroup.normalized=this.rawMesh.smoothingGroup.splitMaterials?t:0===t?0:1,a!==(this.rawMesh.smoothingGroup.real=t)&&(this.rawMesh.counts.smoothingGroupCount++,this.checkSubGroup())},checkFaceType:function(e){this.rawMesh.faceType!==e&&(this.processCompletedMesh(),this.rawMesh.faceType=e,this.checkSubGroup())},checkSubGroup:function(){var e=this.rawMesh.activeMtlName+"|"+this.rawMesh.smoothingGroup.normalized;this.rawMesh.subGroupInUse=this.rawMesh.subGroups[e],XDTHREE.LoaderSupport.Validator.isValid(this.rawMesh.subGroupInUse)||(this.rawMesh.subGroupInUse={index:e,objectName:this.rawMesh.objectName,groupName:this.rawMesh.groupName,materialName:this.rawMesh.activeMtlName,smoothingGroup:this.rawMesh.smoothingGroup.normalized,vertices:[],indexMappingsCount:0,indexMappings:[],indices:[],colors:[],uvs:[],normals:[]},this.rawMesh.subGroups[e]=this.rawMesh.subGroupInUse)},buildFace:function(c,h,p){this.disregardNormals&&(p=void 0);var m=this,e=function(){var e=parseInt(c),t=3*(0<e?e-1:e+m.vertices.length/3),a=0<m.colors.length?t:null,n=m.rawMesh.subGroupInUse.vertices;if(n.push(m.vertices[t++]),n.push(m.vertices[t++]),n.push(m.vertices[t]),null!==a){var o=m.rawMesh.subGroupInUse.colors;o.push(m.colors[a++]),o.push(m.colors[a++]),o.push(m.colors[a])}if(h){var r=parseInt(h),i=2*(0<r?r-1:r+m.uvs.length/2),s=m.rawMesh.subGroupInUse.uvs;s.push(m.uvs[i++]),s.push(m.uvs[i])}if(p){var d=parseInt(p),l=3*(0<d?d-1:d+m.normals.length/3),u=m.rawMesh.subGroupInUse.normals;u.push(m.normals[l++]),u.push(m.normals[l++]),u.push(m.normals[l])}};if(this.useIndices){var t=c+(h?"_"+h:"_n")+(p?"_"+p:"_n"),a=this.rawMesh.subGroupInUse.indexMappings[t];XDTHREE.LoaderSupport.Validator.isValid(a)?this.rawMesh.counts.doubleIndicesCount++:(a=this.rawMesh.subGroupInUse.vertices.length/3,e(),this.rawMesh.subGroupInUse.indexMappings[t]=a,this.rawMesh.subGroupInUse.indexMappingsCount++),this.rawMesh.subGroupInUse.indices.push(a)}else e();this.rawMesh.counts.faceCount++},createRawMeshReport:function(e){return"Input Object number: "+e+"\n\tObject name: "+this.rawMesh.objectName+"\n\tGroup name: "+this.rawMesh.groupName+"\n\tMtllib name: "+this.rawMesh.mtllibName+"\n\tVertex count: "+this.vertices.length/3+"\n\tNormal count: "+this.normals.length/3+"\n\tUV count: "+this.uvs.length/2+"\n\tSmoothingGroup count: "+this.rawMesh.counts.smoothingGroupCount+"\n\tMaterial count: "+this.rawMesh.counts.mtlCount+"\n\tReal MeshOutputGroup count: "+this.rawMesh.subGroups.length},finalizeRawMesh:function(){var e,t,a=[],n=0,o=0,r=0,i=0,s=0,d=0;for(var l in this.rawMesh.subGroups)if(0<(e=this.rawMesh.subGroups[l]).vertices.length){if(0<(t=e.indices).length&&0<o)for(var u in t)t[u]=t[u]+o;a.push(e),n+=e.vertices.length,o+=e.indexMappingsCount,r+=e.indices.length,i+=e.colors.length,d+=e.uvs.length,s+=e.normals.length}var c=null;return 0<a.length&&(c={name:""!==this.rawMesh.groupName?this.rawMesh.groupName:this.rawMesh.objectName,subGroups:a,absoluteVertexCount:n,absoluteIndexCount:r,absoluteColorCount:i,absoluteNormalCount:s,absoluteUvCount:d,faceCount:this.rawMesh.counts.faceCount,doubleIndicesCount:this.rawMesh.counts.doubleIndicesCount}),c},processCompletedMesh:function(){var e=this.finalizeRawMesh();if(XDTHREE.LoaderSupport.Validator.isValid(e)){0<this.colors.length&&this.colors.length!==this.vertices.length&&this._throwError("Vertex Colors were detected, but vertex count and color count do not match!"),this.logging.enabled&&this.logging.debug&&console.debug(this.createRawMeshReport(this.inputObjectCount)),this.inputObjectCount++,this.buildMesh(e);var t=this.globalCounts.currentByte/this.globalCounts.totalBytes;return this.callbackProgress("Completed [o: "+this.rawMesh.objectName+" g:"+this.rawMesh.groupName+"] Total progress: "+(100*t).toFixed(2)+"%",t),this.resetRawMesh(),!0}return!1},buildMesh:function(e){var t=e.subGroups,a=new Float32Array(e.absoluteVertexCount);this.globalCounts.vertices+=e.absoluteVertexCount/3,this.globalCounts.faces+=e.faceCount,this.globalCounts.doubleIndicesCount+=e.doubleIndicesCount;var n,o,r,i,s,d,l,u=0<e.absoluteIndexCount?new Uint32Array(e.absoluteIndexCount):null,c=0<e.absoluteColorCount?new Float32Array(e.absoluteColorCount):null,h=0<e.absoluteNormalCount?new Float32Array(e.absoluteNormalCount):null,p=0<e.absoluteUvCount?new Float32Array(e.absoluteUvCount):null,m=XDTHREE.LoaderSupport.Validator.isValid(c),g=[],w=1<t.length,f=0,y=[],E=[],v=0,b=0,R=0,x=0,T=0,C=0,D=0;for(var I in t)if(t.hasOwnProperty(I)){if(l=(n=t[I]).materialName,d=this.rawMesh.faceType<4?l+(m?"_vertexColor":"")+(0===n.smoothingGroup?"_flat":""):6===this.rawMesh.faceType?"defaultPointMaterial":"defaultLineMaterial",i=this.materials[l],s=this.materials[d],!XDTHREE.LoaderSupport.Validator.isValid(i)&&!XDTHREE.LoaderSupport.Validator.isValid(s)){var U=m?"defaultVertexColorMaterial":"defaultMaterial";i=this.materials[U],this.logging.enabled&&console.warn('object_group "'+n.objectName+"_"+n.groupName+'" was defined with unresolvable material "'+l+'"! Assigning "'+U+'".'),(l=U)===d&&(s=i,d=U)}if(!XDTHREE.LoaderSupport.Validator.isValid(s)){var V={materialNameOrg:l,materialName:d,materialProperties:{vertexColors:m?2:0,flatShading:0===n.smoothingGroup}},S={cmd:"materialData",materials:{materialCloneInstructions:V}};this.callbackMeshBuilder(S),this.useAsync&&(this.materials[d]=V)}if(w?((o=y[d])||(o=f,y[d]=f,g.push(d),f++),r={start:C,count:D=this.useIndices?n.indices.length:n.vertices.length/3,index:o},E.push(r),C+=D):g.push(d),a.set(n.vertices,v),v+=n.vertices.length,u&&(u.set(n.indices,b),b+=n.indices.length),c&&(c.set(n.colors,R),R+=n.colors.length),h&&(h.set(n.normals,x),x+=n.normals.length),p&&(p.set(n.uvs,T),T+=n.uvs.length),this.logging.enabled&&this.logging.debug){var M=XDTHREE.LoaderSupport.Validator.isValid(o)?"\n\t\tmaterialIndex: "+o:"",X="\tOutput Object no.: "+this.outputObjectCount+"\n\t\tgroupName: "+n.groupName+"\n\t\tIndex: "+n.index+"\n\t\tfaceType: "+this.rawMesh.faceType+"\n\t\tmaterialName: "+n.materialName+"\n\t\tsmoothingGroup: "+n.smoothingGroup+M+"\n\t\tobjectName: "+n.objectName+"\n\t\t#vertices: "+n.vertices.length/3+"\n\t\t#indices: "+n.indices.length+"\n\t\t#colors: "+n.colors.length/3+"\n\t\t#uvs: "+n.uvs.length/2+"\n\t\t#normals: "+n.normals.length/3;console.debug(X)}}this.outputObjectCount++,this.callbackMeshBuilder({cmd:"meshData",progress:{numericalValue:this.globalCounts.currentByte/this.globalCounts.totalBytes},params:{meshName:e.name},materials:{multiMaterial:w,materialNames:g,materialGroups:E},buffers:{vertices:a,indices:u,colors:c,normals:h,uvs:p},geometryType:this.rawMesh.faceType<4?0:6===this.rawMesh.faceType?2:1},[a.buffer],XDTHREE.LoaderSupport.Validator.isValid(u)?[u.buffer]:null,XDTHREE.LoaderSupport.Validator.isValid(c)?[c.buffer]:null,XDTHREE.LoaderSupport.Validator.isValid(h)?[h.buffer]:null,XDTHREE.LoaderSupport.Validator.isValid(p)?[p.buffer]:null)},finalizeParsing:function(){if(this.logging.enabled&&console.info("Global output object count: "+this.outputObjectCount),this.processCompletedMesh()&&this.logging.enabled){var e="Overall counts: \n\tVertices: "+this.globalCounts.vertices+"\n\tFaces: "+this.globalCounts.faces+"\n\tMultiple definitions: "+this.globalCounts.doubleIndicesCount;console.info(e)}}};